<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">







<meta name="description" content="Protect FileUpload Against Malicious File on the main website for The OWASP Foundation. OWASP is a nonprofit foundation that works to improve the security of software.">
<meta property="og:description" content="Protect FileUpload Against Malicious File on the main website for The OWASP Foundation. OWASP is a nonprofit foundation that works to improve the security of software.">
<meta propery="og:title" content="cheat sheets | Protect FileUpload Against Malicious File | OWASP Foundation">
<meta property="og:url" content="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Protect_FileUpload_Against_Malicious_File.html">
<meta property="og:locale" content="en_US">

<!-- should probably look at using article at some point for www-community at least -->
<meta property="og:type" content="website" />
<meta property="og:image" content="https://owasp.org/www--site-theme/favicon.ico" />
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="X-XSS-Protection" content="1; mode=block">


<link rel="canonical" href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Protect_FileUpload_Against_Malicious_File" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=UA-4531126-1"></script> -->
<!-- <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-4531126-1');
</script> -->
<!-- Google Analytics -->


<script src="https://owasp.org/www--site-theme/assets/js/js.cookie.js"></script>
<script>
  if(Cookies.get('cookies-ok') == 'true' && window.ga === undefined)
  {
    window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
    ga('create', 'UA-4531126-1', 'auto');
    ga('send', 'pageview');
  }
  else if (Cookies.get('cookies-ok') == 'true')
  {
    ga('send', 'pageview');
  }

  function handleOutboundLinkClicks(event) {
    var href = '';
    if(event.target.href == undefined)
      href = event.target.parentElement.href;
    else
      href = event.target.href
  if(Cookies.get('cookies-ok') == 'true'){  
    
    ga('send', 'event', {
      eventCategory: 'Outbound Link',
      eventAction: 'click',
      eventLabel: href,
      transport: 'beacon'
    });
  }
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<!-- End Google Analytics -->
<link rel="stylesheet" href="https://owasp.org/www--site-theme/assets/css/styles.css">
<link rel="shortcut icon" type="images/x-icon" href="https://owasp.org/www--site-theme/favicon.ico">

<script src="https://owasp.org/www--site-theme/assets/js/jquery-3.4.1.min.js"></script>
<script src="https://owasp.org/www--site-theme/assets/js/util.js"></script>
<script src="https://owasp.org/www--site-theme/assets/js/yaml.min.js"></script>
<script src="https://owasp.org/www--site-theme/assets/js/luxon.min.js"></script>
<title>Protect FileUpload Against Malicious File | OWASP</title>

    <script type="text/javascript">
      $(function(){
        var baseurl = "https://github.com/OWASP/www-chapter-ankara/blob/master/";
        var path = "cheatsheets/Protect_FileUpload_Against_Malicious_File.md";
        $('.repo').html('<a href=' + baseurl + path + '><div class="reset-3c756112--menuItemIcon-206eb252" style="float: left;"><svg preserveAspectRatio="xMidYMid meet" height="1em" width="1em" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 438.549 438.549" stroke="none" class="icon-7f6730be--text-3f89f380"><g><path d="M409.132 114.573c-19.608-33.596-46.205-60.194-79.798-79.8-33.598-19.607-70.277-29.408-110.063-29.408-39.781 0-76.472 9.804-110.063 29.408-33.596 19.605-60.192 46.204-79.8 79.8C9.803 148.168 0 184.854 0 224.63c0 47.78 13.94 90.745 41.827 128.906 27.884 38.164 63.906 64.572 108.063 79.227 5.14.954 8.945.283 11.419-1.996 2.475-2.282 3.711-5.14 3.711-8.562 0-.571-.049-5.708-.144-15.417a2549.81 2549.81 0 0 1-.144-25.406l-6.567 1.136c-4.187.767-9.469 1.092-15.846 1-6.374-.089-12.991-.757-19.842-1.999-6.854-1.231-13.229-4.086-19.13-8.559-5.898-4.473-10.085-10.328-12.56-17.556l-2.855-6.57c-1.903-4.374-4.899-9.233-8.992-14.559-4.093-5.331-8.232-8.945-12.419-10.848l-1.999-1.431c-1.332-.951-2.568-2.098-3.711-3.429-1.142-1.331-1.997-2.663-2.568-3.997-.572-1.335-.098-2.43 1.427-3.289 1.525-.859 4.281-1.276 8.28-1.276l5.708.853c3.807.763 8.516 3.042 14.133 6.851 5.614 3.806 10.229 8.754 13.846 14.842 4.38 7.806 9.657 13.754 15.846 17.847 6.184 4.093 12.419 6.136 18.699 6.136 6.28 0 11.704-.476 16.274-1.423 4.565-.952 8.848-2.383 12.847-4.285 1.713-12.758 6.377-22.559 13.988-29.41-10.848-1.14-20.601-2.857-29.264-5.14-8.658-2.286-17.605-5.996-26.835-11.14-9.235-5.137-16.896-11.516-22.985-19.126-6.09-7.614-11.088-17.61-14.987-29.979-3.901-12.374-5.852-26.648-5.852-42.826 0-23.035 7.52-42.637 22.557-58.817-7.044-17.318-6.379-36.732 1.997-58.24 5.52-1.715 13.706-.428 24.554 3.853 10.85 4.283 18.794 7.952 23.84 10.994 5.046 3.041 9.089 5.618 12.135 7.708 17.705-4.947 35.976-7.421 54.818-7.421s37.117 2.474 54.823 7.421l10.849-6.849c7.419-4.57 16.18-8.758 26.262-12.565 10.088-3.805 17.802-4.853 23.134-3.138 8.562 21.509 9.325 40.922 2.279 58.24 15.036 16.18 22.559 35.787 22.559 58.817 0 16.178-1.958 30.497-5.853 42.966-3.9 12.471-8.941 22.457-15.125 29.979-6.191 7.521-13.901 13.85-23.131 18.986-9.232 5.14-18.182 8.85-26.84 11.136-8.662 2.286-18.415 4.004-29.263 5.146 9.894 8.562 14.842 22.077 14.842 40.539v60.237c0 3.422 1.19 6.279 3.572 8.562 2.379 2.279 6.136 2.95 11.276 1.995 44.163-14.653 80.185-41.062 108.068-79.226 27.88-38.161 41.825-81.126 41.825-128.906-.01-39.771-9.818-76.454-29.414-110.049z"></path></g></svg><span style="padding-left:8px;">Edit on GitHub</span></div></a>');
      });
    </script>
    <script async defer src="https://buttons.github.io/buttons.js"></script>
  </head>
  <body class="base-grid col-sidebar">

    <div id="blocker"></div>

    <noscript>For full functionality of this site it is necessary to enable JavaScript. Here are the <a href="https://www.enable-javascript.com/"> instructions how to enable JavaScript in your web browser</a>.</noscript>
    <header role="banner">
  <div id="banner" class="notice" aria-label="announcement">
  <!--
	<p>Consider <a href="/membership">becoming a Member</a> of the OWASP Foundation. It's affordable and your contributions make a difference.</p>
  -->
 
	<p>Please support the OWASP mission to improve sofware security through open source initiatives and community education. <a href="https://owasp.org/donate/">Donate Now!</a></p>
	
	<a href="#" id="close-banner" aria-label="close announcement">
          <i class="fa fa-times"></i>
       </a>	  
</div>

<style>
  #banner img {
    max-width: 30em;
  }

  @media (max-width: 1131px) {
    #banner img{
      max-width: 30em;
    }
	}

@media (max-width: 800px) {
	#banner img{
      max-width: 20em;
    }
}

@media (max-width: 600px) {
	#banner img{
      max-width: 20em;
    }
}

@media (max-width: 450px) {
	#banner img{
      max-width: 250px;
  }
}
</style>

  <div class="header-wrapper" aria-label="main navigation">
    <nav class="alt-nav">
      <a href="#" class="menu-toggler" aria-hidden="true">
        <i class="fa fa-bars"></i>
      </a>
      <a href="/" class="alt-logo" aria-label="go to homepage">
          <img src="/assets/images/logo.png" alt="OWASP logo">
      </a>
      <div id="overlay" class="remove-el">

      </div>
      <!-- jekyll menu stuff -->
    </nav>
    
    <nav class="top-nav" role="navigation" aria-label="primary navigation">
      <a href="/" class="desktop-logo" aria-label="go to homepage">
        <img src="/assets/images/logo.png" alt="">
      </a>
      <!-- jekyll menu stuff -->
      
      <div class="interactive-wrapper">
        <form role="search" method="get" action="/search">   
          <div class='search-div'>
            <input id="searchString" name="searchString" class="search-bar" type="search" placeholder="Search OWASP.org" required="true">
            <button id="search-button" type="submit" class="fa fa-search">
                <!--<span id="search-icon" tabindex="0"><i class="fa fa-search"></i></span>-->
            </button>
          </div>  
        </form>
        <div class="nav-button" aria-label="donate to or join OWASP">
        
          <a href="/donate?reponame=www-chapter-ankara&title=Protect+FileUpload+Against+Malicious+File" class="cta-button green">Donate</a>
          <a href="/membership" class="cta-button">Join</a>
        </div>
      </div>
    </nav>
    <div id='disclaimer-container'>
<div id="disclaimer">
    <p>This website uses cookies to analyze our traffic and only share that information with our analytics partners.</p><a class="disclaimerOK">Accept</a>
</div>
<div id="close-disclaimer">x</div>
</div>
  </div>
  



<script type="text/javascript">
  $(function(){
      
      url = $(location).attr('href');
      if(url.includes('www2'))
      {
        url = url.replace(/www2./, '');
        $(location).attr('href',url);
        return;
      }
    // this works to get data from a json file NOT in data
      $.getJSON("https://owasp.org/www--site-theme/assets/sitedata/menus.json", function(data) {
         var listr = "<ul aria-label='header menu'>";
         
         var mlistr = "<ul class='mobile-menu hide-el' role='navigation' aria-label='mobile primary navigation'>";

          mlistr += "<li><a href='#' class='menu-toggler' aria-hidden='true'><i class='fa fa-times'></i></a></li>";
          mlistr += "<li>";
          mlistr += "<form role='search' method='get' action='/search'>";   
          mlistr += "<div class='search-div'>";
          mlistr += "<input id='searchString' aria-label='search input' name='searchString' class='search-bar' type='search' placeholder='Search OWASP.org' required='true'>";
          mlistr += "<button id='search-button' aria-label='search button' type='submit' class='fa fa-search' style='padding-left: 8px;'></button></div></form>";
          mlistr += "</li>";
          $.each(data.menus, function (ndx, menu){
              listr += "<li><a href='" + menu.url + "'>" + menu.title + "</a>";

              if(!menu.items)
              {
                  mlistr += "<li><a href='" + menu.url + "'>" + menu.title + "</a>";
              }
              
              if(menu.items){
                  listr += "<ul class='dropdown-menu'>";
                  mlistr += "<button class='accordion'>" + menu.title + "</button>";
                  mlistr += "<div class='panel'>";
                  mlistr += "<ul>";
                $.each(menu.items, function(ndx, item){
                
                  if(item.separator)
                  {
                      listr += "<li class='separator'>";
                      mlistr += "<li class='separator'>";
                  }
                  else
                  {
                      listr += "<li>";
                      mlistr += "<li>";
                  }
                  listr += "<a href='" + item.url + "'";
                  mlistr += "<a href='" + item.url + "'";
                  if(item.opentab)
                  {
                    listr += " target='_blank' rel='noopener noreferrer'";
                    mlistr += " target='_blank' rel='noopener noreferrer'";
                  }

                  listr += ">" + item.title + "</a></li>";
                  mlistr += ">" + item.title + "</a></li>";
                });
                listr += "</ul>";
                mlistr += "</ul>";
                mlistr += "</div>"
              }
              
              listr += "</li>";
              mlistr += "</li>";
          });
          listr += "</ul>";
          mlistr += "<li><a href='/donate'>MAKE A DONATION</a></li>";
          mlistr += "<li><a href='/membership'>BECOME A MEMBER</a></li>";
          mlistr += "<li><a href='/sitemap'>SITEMAP</a></li>";
          mlistr += "</ul>";
          
          $('.desktop-logo').after(listr);
          $('#overlay').after(mlistr);

          $(".accordion").click(function () {
              $(this).toggleClass("active");
              if($(this).next('.panel').css('display') == 'block'){
                $(this).next('.panel').css('display', 'none');
              }
              else {
                $(this).next('.panel').css('display', 'block');
              }
            });
            $(".menu-toggler").click(function() {
              $(".mobile-menu").toggleClass('hide-el');
            });
      });
    });
  </script>
</header>


    <main role="main">
      <div class="main-wrapper document">
        
  
  
  
  
  
  
  




                




    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
        
        
        <div id="main" class="page-body tab" role="tabpanel" aria-labelledby="main-link" tabindex="0">
          <div class="doc-title">cheat sheets</div>
          <h1 class="page-title">Protect FileUpload Against Malicious File</h1>
          
          <nav role="navigation" aria-label="navigate page">
              <ol>
              
                
                <li class='page previous'><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Pinning_Cheat_Sheet"><span style="font-size: 3em; color: lightgray; vertical-align:middle;">
                    <i class="fas fa-angle-left"></i>
                  </span>Pinning Cheat Sheet</a></li>
              
              
                
                <li class='page next'><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Query_Parameterization_Cheat_Sheet">Query Parameterization Cheat Sheet<span style="font-size: 3em; color: lightgray; vertical-align:middle;">
                    <i class="fas fa-angle-right"></i>
                  </span></a></li>
              
              </ol>
          </nav>
          
          <section id='div-main' class='page-body tab'>
          <h1 id="introduction">Introduction</h1>

<p>This article propose a way to protect a file upload feature against submission of file containing malicious code.</p>

<h1 id="context">Context</h1>

<p>Into web applications, when we expect upload of working documents from users, we can expose the application to submission of documents that we can categorize as <em>malicious</em>.</p>

<p>We use the term “malicious” here to refer to documents that embed <em>malicious code</em> that will be executed when another user (admin, back office operator…) will open the document with the associated application reader.</p>

<p>Usually, when an application expect his user to upload a document, the application expect to receive a document for which the intended use will be for reading/printing/archiving. The document should not alter is content at opening time and should be in a final rendered state.</p>

<p>The most common file types used to transmit <em>malicious code</em> into file upload feature are the following:</p>

<ul>
  <li>Microsoft Office document: Word/Excel/PowerPoint using <a href="https://en.wikipedia.org/wiki/Visual_Basic_for_Applications">VBA Macro</a> and <a href="https://en.wikipedia.org/wiki/Object_Linking_and_Embedding">OLE package</a>.</li>
  <li>Adobe PDF document: Insert malicious code as attachment.</li>
  <li>Images: Malicious code embedded into the file or use of binary file with image file extension.</li>
</ul>

<h1 id="approaches">Approaches</h1>

<p>Based on this context, the goals here are:</p>

<ul>
  <li>For Word/Excel/PowerPoint/Pdf documents: Detect when a document contains “code”/OLE package, if it’s the case then block the upload process.</li>
  <li>For Images document: Sanitize incoming image using re-writing approach and then disable/remove any “code” present (this approach also handle case in which the file sent is not an image).</li>
</ul>

<p>Remarks:</p>

<ul>
  <li>It’s technically possible to perform sanitizing on Word/Excel/PowerPoint/PDF documents but we have chosen here the option to block them in order to avoid the risk of missing any evasion techniques and then let pass one evil document. The following <a href="https://www.greyhathacker.net/?p=872">site</a> show how many way exists to embed Macro into a Microsoft Office documents.</li>
  <li>The other reason why we have chosen the blocking way is that for Word/Excel/PowerPoint, changing document format (for example by saving any document to <code class="language-plaintext highlighter-rouge">DOCX/XSLX/PPTX/PPSX</code> formats in order to be sure that no Macro can be executed) can have impacts or cause issues on document structure/rendering depending on the API used.</li>
</ul>

<h1 id="cases">Cases</h1>

<h2 id="common-codes">Common codes</h2>

<p>The following codes are shared by the code snippets proposed into the rest of this article.</p>

<p>Interfaces:</p>

<p><em>DocumentDetector</em></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>

<span class="cm">/**
 * Interface to define detection methods.
 *
 */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">DocumentDetector</span> <span class="o">{</span>
    <span class="cm">/**
     * Method to verify if the specified file contains a document that:&lt;br&gt;
     * &lt;ul&gt;
     * &lt;li&gt;Do not contains potential malicious content&lt;/li&gt;
     * &lt;li&gt;Is part of the supported accepted format&lt;/li&gt;
     * &lt;/ul&gt;
     *
     * @param f File to validate
     *
     * @return TRUE only if the file fill the 2 rules above
     */</span>
    <span class="kt">boolean</span> <span class="nf">isSafe</span><span class="o">(</span><span class="nc">File</span> <span class="n">f</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><em>DocumentSanitizer</em></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>

<span class="cm">/**
 * Interface to define sanitize methods.
 *
 */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">DocumentSanitizer</span> <span class="o">{</span>
    <span class="cm">/**
     * Method to try to (sanitize) disable any code contained into the specified file 
     * by using re-writing approach.
     *
     * @param f File to made safe
     *
     * @return TRUE only if the specified file has been successfully made safe.
     */</span>
    <span class="kt">boolean</span> <span class="nf">madeSafe</span><span class="o">(</span><span class="nc">File</span> <span class="n">f</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="case-n1-word--excel--powerpoint">Case n°1: Word / Excel / PowerPoint</h2>

<p>The reason why Aspose API have been used here are the following:</p>

<ul>
  <li>There many way to embed Macro into a Microsoft Office document and, instead of manually support all the way that exists on the wild (they evolve every days), we prefer to use features from a company that perform R&amp;D on these formats, precisely DOC/XLS/PPT native formats that are proprietary.</li>
  <li>The open source API POI for <a href="https://poi.apache.org/overview.html">DOC native format is limited</a>.</li>
  <li>The open source API JEXCELAPI for XLS native format is not often maintained (last publishing date from <a href="https://sourceforge.net/projects/jexcelapi/files/jexcelapi/">2009</a>).</li>
</ul>

<p>Detector for Word document:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.aspose.words.Document</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.aspose.words.FileFormatInfo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.aspose.words.FileFormatUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.aspose.words.NodeCollection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.aspose.words.NodeType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.aspose.words.Shape</span><span class="o">;</span>

<span class="cm">/**
 * Implementation of the detector for Microsoft Word document.
 *
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WordDocumentDetectorImpl</span> <span class="kd">implements</span> <span class="nc">DocumentDetector</span> <span class="o">{</span>

    <span class="cm">/** LOGGER */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="no">LOG</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">WordDocumentDetectorImpl</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="cm">/**
     * List of allowed Word format (WML = Word ML (Word 2003 XML)).&lt;br&gt;
     * Allow also DOCM because it can exists without macro inside.&lt;br&gt;
     * Allow also DOT/DOTM because both can exists without macro inside.&lt;br&gt;
     * We reject MHTML file because:&lt;br&gt;
     * &lt;ul&gt;
     * &lt;li&gt;API cannot detect macro into this format&lt;/li&gt;
     * &lt;li&gt;Is not normal to use this format to represent a Word file 
     *     (there plenty of others supported format)&lt;/li&gt;
     * &lt;/ul&gt;
     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="no">ALLOWED_FORMAT</span> <span class="o">=</span> 
                         <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">[]</span> <span class="o">{</span> <span class="s">"doc"</span><span class="o">,</span> <span class="s">"docx"</span><span class="o">,</span> <span class="s">"docm"</span><span class="o">,</span> <span class="s">"wml"</span><span class="o">,</span> <span class="s">"dot"</span><span class="o">,</span> <span class="s">"dotm"</span> <span class="o">});</span>

    <span class="cm">/**
     * {@inheritDoc}
     */</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"rawtypes"</span><span class="o">)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isSafe</span><span class="o">(</span><span class="nc">File</span> <span class="n">f</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">boolean</span> <span class="n">safeState</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">((</span><span class="n">f</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">f</span><span class="o">.</span><span class="na">exists</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">f</span><span class="o">.</span><span class="na">canRead</span><span class="o">())</span> <span class="o">{</span>
                <span class="c1">// Perform a first check on Word document format</span>
                <span class="nc">FileFormatInfo</span> <span class="n">formatInfo</span> <span class="o">=</span> <span class="nc">FileFormatUtil</span><span class="o">.</span><span class="na">detectFileFormat</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">());</span>
                <span class="nc">String</span> <span class="n">formatExtension</span> <span class="o">=</span> <span class="nc">FileFormatUtil</span><span class="o">.</span><span class="na">loadFormatToExtension</span><span class="o">(</span><span class="n">formatInfo</span><span class="o">.</span><span class="na">getLoadFormat</span><span class="o">());</span>
                <span class="k">if</span> <span class="o">((</span><span class="n">formatExtension</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> 
                <span class="o">&amp;&amp;</span> <span class="no">ALLOWED_FORMAT</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">formatExtension</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(</span><span class="nc">Locale</span><span class="o">.</span><span class="na">US</span><span class="o">).</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"\\."</span><span class="o">,</span> <span class="s">""</span><span class="o">)))</span> <span class="o">{</span>
                    <span class="c1">// Load the file into the Word document parser</span>
                    <span class="nc">Document</span> <span class="n">document</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Document</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">());</span>
                    <span class="c1">// Get safe state from Macro presence</span>
                    <span class="n">safeState</span> <span class="o">=</span> <span class="o">!</span><span class="n">document</span><span class="o">.</span><span class="na">hasMacros</span><span class="o">();</span>
                    <span class="c1">// If document is safe then we pass to OLE objects analysis</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">safeState</span><span class="o">)</span> <span class="o">{</span>
                        <span class="c1">// Get all shapes of the document</span>
                        <span class="nc">NodeCollection</span> <span class="n">shapes</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">(</span><span class="nc">NodeType</span><span class="o">.</span><span class="na">SHAPE</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
                        <span class="nc">Shape</span> <span class="n">shape</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                        <span class="c1">// Search OLE objects in all shapes</span>
                        <span class="kt">int</span> <span class="n">totalOLEObjectCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
                        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">shapes</span><span class="o">.</span><span class="na">getCount</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                            <span class="n">shape</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Shape</span><span class="o">)</span> <span class="n">shapes</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                            <span class="c1">// Check if the current shape has OLE object</span>
                            <span class="k">if</span> <span class="o">(</span><span class="n">shape</span><span class="o">.</span><span class="na">getOleFormat</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                                <span class="n">totalOLEObjectCount</span><span class="o">++;</span>
                            <span class="o">}</span>
                        <span class="o">}</span>
                        <span class="c1">// Update safe status flag according to number of OLE object found</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">totalOLEObjectCount</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">safeState</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                        <span class="o">}</span>

                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">safeState</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
            <span class="no">LOG</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">"Error during Word file analysis !"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">safeState</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>Detector for Excel document:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.aspose.cells.FileFormatInfo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.aspose.cells.FileFormatUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.aspose.cells.MsoDrawingType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.aspose.cells.OleObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.aspose.cells.Workbook</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.aspose.cells.Worksheet</span><span class="o">;</span>

<span class="cm">/**
 * Implementation of the detector for Microsoft Excel workbook.
 *
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExcelDocumentDetectorImpl</span> <span class="kd">implements</span> <span class="nc">DocumentDetector</span> <span class="o">{</span>

    <span class="cm">/** LOGGER */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="no">LOG</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">ExcelDocumentDetectorImpl</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="cm">/**
     * List of allowed Excel format&lt;br&gt;
     * Allow also XLSM/XSLB because both can exists without macro inside.&lt;br&gt;
     * Allow also XLT/XLTM because both can exists without macro inside.&lt;br&gt;
     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="no">ALLOWED_FORMAT</span> <span class="o">=</span> 
                    <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">[]</span> <span class="o">{</span> <span class="s">"xls"</span><span class="o">,</span> <span class="s">"xlsx"</span><span class="o">,</span> <span class="s">"xlsm"</span><span class="o">,</span> <span class="s">"xlsb"</span><span class="o">,</span> <span class="s">"xlt"</span><span class="o">,</span> <span class="s">"xltm"</span> <span class="o">});</span>

    <span class="cm">/**
     * {@inheritDoc}
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isSafe</span><span class="o">(</span><span class="nc">File</span> <span class="n">f</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">boolean</span> <span class="n">safeState</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">((</span><span class="n">f</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">f</span><span class="o">.</span><span class="na">exists</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">f</span><span class="o">.</span><span class="na">canRead</span><span class="o">())</span> <span class="o">{</span>
                <span class="c1">// Perform a first check on Excel document format</span>
                <span class="nc">FileFormatInfo</span> <span class="n">formatInfo</span> <span class="o">=</span> <span class="nc">FileFormatUtil</span><span class="o">.</span><span class="na">detectFileFormat</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">());</span>
                <span class="nc">String</span> <span class="n">formatExtension</span> <span class="o">=</span> <span class="nc">FileFormatUtil</span><span class="o">.</span><span class="na">loadFormatToExtension</span><span class="o">(</span><span class="n">formatInfo</span><span class="o">.</span><span class="na">getLoadFormat</span><span class="o">());</span>
                <span class="k">if</span> <span class="o">((</span><span class="n">formatExtension</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> 
                <span class="o">&amp;&amp;</span> <span class="no">ALLOWED_FORMAT</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">formatExtension</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(</span><span class="nc">Locale</span><span class="o">.</span><span class="na">US</span><span class="o">).</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"\\."</span><span class="o">,</span> <span class="s">""</span><span class="o">)))</span> <span class="o">{</span>
                    <span class="c1">// Load the file into the Excel document parser</span>
                    <span class="nc">Workbook</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Workbook</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">());</span>
                    <span class="c1">// Get safe state from Macro presence</span>
                    <span class="n">safeState</span> <span class="o">=</span> <span class="o">!</span><span class="n">book</span><span class="o">.</span><span class="na">hasMacro</span><span class="o">();</span>
                    <span class="c1">// If document is safe then we pass to OLE objects analysis</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">safeState</span><span class="o">)</span> <span class="o">{</span>
                        <span class="c1">// Search OLE objects in all workbook sheets</span>
                        <span class="nc">Worksheet</span> <span class="n">sheet</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                        <span class="nc">OleObject</span> <span class="n">oleObject</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                        <span class="kt">int</span> <span class="n">totalOLEObjectCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
                        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">book</span><span class="o">.</span><span class="na">getWorksheets</span><span class="o">().</span><span class="na">getCount</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                            <span class="n">sheet</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="na">getWorksheets</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">sheet</span><span class="o">.</span><span class="na">getOleObjects</span><span class="o">().</span><span class="na">getCount</span><span class="o">();</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
                                <span class="n">oleObject</span> <span class="o">=</span> <span class="n">sheet</span><span class="o">.</span><span class="na">getOleObjects</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">j</span><span class="o">);</span>
                                <span class="k">if</span> <span class="o">(</span><span class="n">oleObject</span><span class="o">.</span><span class="na">getMsoDrawingType</span><span class="o">()</span> <span class="o">==</span> <span class="nc">MsoDrawingType</span><span class="o">.</span><span class="na">OLE_OBJECT</span><span class="o">)</span> <span class="o">{</span>
                                    <span class="n">totalOLEObjectCount</span><span class="o">++;</span>
                                <span class="o">}</span>
                            <span class="o">}</span>
                        <span class="o">}</span>
                        <span class="c1">// Update safe status flag according to number of OLE object found</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">totalOLEObjectCount</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">safeState</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">safeState</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
            <span class="no">LOG</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">"Error during Excel file analysis !"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">safeState</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>Detector for PowerPoint document:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">com.aspose.slides.IOleObjectFrame</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.aspose.slides.IShape</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.aspose.slides.ISlide</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.aspose.slides.Presentation</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>

<span class="cm">/**
 * Implementation of the detector for Microsoft PowerPoint document.
 *
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PowerPointDocumentDetectorImpl</span> <span class="kd">implements</span> <span class="nc">DocumentDetector</span> <span class="o">{</span>

    <span class="cm">/**
     * LOGGER
     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="no">LOG</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">PowerPointDocumentDetectorImpl</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="cm">/**
     * {@inheritDoc}
     */</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"rawtypes"</span><span class="o">)</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isSafe</span><span class="o">(</span><span class="nc">File</span> <span class="n">f</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">boolean</span> <span class="n">safeState</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">((</span><span class="n">f</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">f</span><span class="o">.</span><span class="na">exists</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">f</span><span class="o">.</span><span class="na">canRead</span><span class="o">())</span> <span class="o">{</span>
                <span class="c1">// Load the file into the PowerPoint document parser</span>
                <span class="nc">Presentation</span> <span class="n">presentation</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Presentation</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">());</span>
                <span class="c1">// First check on PowerPoint format skipped because:</span>
                <span class="c1">// FileFormatInfo class is not provided for Aspose Slides API</span>
                <span class="c1">// PresentationFactory.getInstance().getPresentationInfo() can be used </span>
                <span class="c1">// but the LoadFormat class miss format like POT or PPT XML</span>
                <span class="c1">// Aspose API do not support PPT XML format</span>
                <span class="c1">// Get safe state from presence of a VBA project in the presentation</span>
                <span class="n">safeState</span> <span class="o">=</span> <span class="o">(</span><span class="n">presentation</span><span class="o">.</span><span class="na">getVbaProject</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">);</span>
                <span class="c1">// If presentation is safe then we pass to OLE objects analysis</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">safeState</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">//Parse all slides of the presentation</span>
                    <span class="kt">int</span> <span class="n">totalOLEObjectCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
                    <span class="k">for</span> <span class="o">(</span><span class="nc">ISlide</span> <span class="n">slide</span> <span class="o">:</span> <span class="n">presentation</span><span class="o">.</span><span class="na">getSlides</span><span class="o">())</span> <span class="o">{</span>
                        <span class="k">for</span> <span class="o">(</span><span class="nc">IShape</span> <span class="n">shape</span> <span class="o">:</span> <span class="n">slide</span><span class="o">.</span><span class="na">getShapes</span><span class="o">())</span> <span class="o">{</span>
                            <span class="c1">//Check if the current shape is an OLE object</span>
                            <span class="k">if</span> <span class="o">(</span><span class="n">shape</span> <span class="k">instanceof</span> <span class="nc">IOleObjectFrame</span><span class="o">)</span> <span class="o">{</span>
                                <span class="n">totalOLEObjectCount</span><span class="o">++;</span>
                            <span class="o">}</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                    <span class="c1">// Update safe status flag according to number of OLE object found</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">totalOLEObjectCount</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">safeState</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                    <span class="o">}</span>
                <span class="o">}</span>

            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">safeState</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
            <span class="no">LOG</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">"Error during PowerPoint file analysis !"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">safeState</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="case-n2-pdf">Case n°2: PDF</h2>

<p>Detector for PDF document:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.itextpdf.text.pdf.PdfArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.itextpdf.text.pdf.PdfDictionary</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.itextpdf.text.pdf.PdfName</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.itextpdf.text.pdf.PdfReader</span><span class="o">;</span>

<span class="cm">/**
 * Implementation of the detector for Adobe PDF document.
 *
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PdfDocumentDetectorImpl</span> <span class="kd">implements</span> <span class="nc">DocumentDetector</span> <span class="o">{</span>

    <span class="cm">/** LOGGER */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="no">LOG</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">PdfDocumentDetectorImpl</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="cm">/**
     * {@inheritDoc}
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isSafe</span><span class="o">(</span><span class="nc">File</span> <span class="n">f</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">boolean</span> <span class="n">safeState</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">((</span><span class="n">f</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">f</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
                <span class="c1">// Load stream in PDF parser</span>
                <span class="c1">// If the stream is not a PDF then exception will be throwed</span>
                <span class="c1">// here and safe state will be set to FALSE</span>
                <span class="nc">PdfReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PdfReader</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">());</span>
                <span class="c1">// Check 1:</span>
                <span class="c1">// Detect if the document contains any JavaScript code</span>
                <span class="nc">String</span> <span class="n">jsCode</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">getJavaScript</span><span class="o">();</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">jsCode</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">// OK no JS code then when pass to check 2:</span>
                    <span class="c1">// Detect if the document has any embedded files</span>
                    <span class="nc">PdfDictionary</span> <span class="n">root</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">getCatalog</span><span class="o">();</span>
                    <span class="nc">PdfDictionary</span> <span class="n">names</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="na">getAsDict</span><span class="o">(</span><span class="nc">PdfName</span><span class="o">.</span><span class="na">NAMES</span><span class="o">);</span>
                    <span class="nc">PdfArray</span> <span class="n">namesArray</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">names</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                        <span class="nc">PdfDictionary</span> <span class="n">embeddedFiles</span> <span class="o">=</span> <span class="n">names</span><span class="o">.</span><span class="na">getAsDict</span><span class="o">(</span><span class="nc">PdfName</span><span class="o">.</span><span class="na">EMBEDDEDFILES</span><span class="o">);</span>
                        <span class="n">namesArray</span> <span class="o">=</span> <span class="n">embeddedFiles</span><span class="o">.</span><span class="na">getAsArray</span><span class="o">(</span><span class="nc">PdfName</span><span class="o">.</span><span class="na">NAMES</span><span class="o">);</span>
                    <span class="o">}</span>
                    <span class="c1">// Get safe state from number of embedded files</span>
                    <span class="n">safeState</span> <span class="o">=</span> <span class="o">((</span><span class="n">namesArray</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">||</span> <span class="n">namesArray</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">());</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">safeState</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
            <span class="no">LOG</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">"Error during Pdf file analysis !"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">safeState</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<h2 id="case-n3-images">Case n°3: Images</h2>

<p>Sanitizer for Images files:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.apache.commons.imaging.ImageInfo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.imaging.ImageParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.imaging.Imaging</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.imaging.formats.bmp.BmpImageParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.imaging.formats.gif.GifImageParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.imaging.formats.pcx.PcxImageParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.imaging.formats.dcx.DcxImageParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.imaging.formats.png.PngImageParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.imaging.formats.tiff.TiffImageParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.imaging.formats.wbmp.WbmpImageParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.imaging.formats.xbm.XbmImageParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.imaging.formats.xpm.XpmImageParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.imageio.ImageIO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.imageio.ImageReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.imageio.stream.ImageInputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.Graphics</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.Image</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.image.BufferedImage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.OutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.file.Files</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.file.StandardOpenOption</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Iterator</span><span class="o">;</span>

<span class="cm">/**
 * Implementation of the sanitizer for Image file.
 * &lt;p&gt;
 * Use Java built-in API in complement of Apache Commons Imaging 
 * for format not supported by the built-in API.
 *
 * @see "http://commons.apache.org/proper/commons-imaging/"
 * @see "http://commons.apache.org/proper/commons-imaging/formatsupport.html"
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ImageDocumentSanitizerImpl</span> <span class="kd">implements</span> <span class="nc">DocumentSanitizer</span> <span class="o">{</span>

    <span class="cm">/**
     * LOGGER
     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="no">LOG</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">ImageDocumentSanitizerImpl</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>


    <span class="cm">/**
     * {@inheritDoc}
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">madeSafe</span><span class="o">(</span><span class="nc">File</span> <span class="n">f</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">boolean</span> <span class="n">safeState</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="kt">boolean</span> <span class="n">fallbackOnApacheCommonsImaging</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">((</span><span class="n">f</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">f</span><span class="o">.</span><span class="na">exists</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">f</span><span class="o">.</span><span class="na">canRead</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">f</span><span class="o">.</span><span class="na">canWrite</span><span class="o">())</span> <span class="o">{</span>
                <span class="c1">//Get the image format</span>
                <span class="nc">String</span> <span class="n">formatName</span><span class="o">;</span>
                <span class="k">try</span> <span class="o">(</span><span class="nc">ImageInputStream</span> <span class="n">iis</span> <span class="o">=</span> <span class="nc">ImageIO</span><span class="o">.</span><span class="na">createImageInputStream</span><span class="o">(</span><span class="n">f</span><span class="o">))</span> <span class="o">{</span>
                    <span class="nc">Iterator</span><span class="o">&lt;</span><span class="nc">ImageReader</span><span class="o">&gt;</span> <span class="n">imageReaderIterator</span> <span class="o">=</span> <span class="nc">ImageIO</span><span class="o">.</span><span class="na">getImageReaders</span><span class="o">(</span><span class="n">iis</span><span class="o">);</span>
                    <span class="c1">//If there not ImageReader instance found so it's means that the current </span>
                    <span class="c1">// format is not supported by the Java built-in API</span>
                    <span class="k">if</span> <span class="o">(!</span><span class="n">imageReaderIterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
                        <span class="nc">ImageInfo</span> <span class="n">imageInfo</span> <span class="o">=</span> <span class="nc">Imaging</span><span class="o">.</span><span class="na">getImageInfo</span><span class="o">(</span><span class="n">f</span><span class="o">);</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">imageInfo</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">imageInfo</span><span class="o">.</span><span class="na">getFormat</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span> 
                        <span class="o">&amp;&amp;</span> <span class="n">imageInfo</span><span class="o">.</span><span class="na">getFormat</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">formatName</span> <span class="o">=</span> <span class="n">imageInfo</span><span class="o">.</span><span class="na">getFormat</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
                            <span class="n">fallbackOnApacheCommonsImaging</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IOException</span><span class="o">(</span><span class="s">"Format of the original image is "</span> <span class="o">+</span> 
                                                <span class="s">"not supported for read operation !"</span><span class="o">);</span>
                        <span class="o">}</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="nc">ImageReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="n">imageReaderIterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
                        <span class="n">formatName</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">getFormatName</span><span class="o">();</span>
                        <span class="n">fallbackOnApacheCommonsImaging</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                    <span class="o">}</span>
                <span class="o">}</span>

                <span class="c1">// Load the image</span>
                <span class="nc">BufferedImage</span> <span class="n">originalImage</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">(!</span><span class="n">fallbackOnApacheCommonsImaging</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">originalImage</span> <span class="o">=</span> <span class="nc">ImageIO</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">f</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="n">originalImage</span> <span class="o">=</span> <span class="nc">Imaging</span><span class="o">.</span><span class="na">getBufferedImage</span><span class="o">(</span><span class="n">f</span><span class="o">);</span>
                <span class="o">}</span>

                <span class="c1">// Check that image has been successfully loaded</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">originalImage</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">IOException</span><span class="o">(</span><span class="s">"Cannot load the original image !"</span><span class="o">);</span>
                <span class="o">}</span>

                <span class="c1">// Get current Width and Height of the image</span>
                <span class="kt">int</span> <span class="n">originalWidth</span> <span class="o">=</span> <span class="n">originalImage</span><span class="o">.</span><span class="na">getWidth</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">originalHeight</span> <span class="o">=</span> <span class="n">originalImage</span><span class="o">.</span><span class="na">getHeight</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>


                <span class="c1">// Resize the image by removing 1px on Width and Height</span>
                <span class="nc">Image</span> <span class="n">resizedImage</span> <span class="o">=</span> <span class="n">originalImage</span><span class="o">.</span><span class="na">getScaledInstance</span><span class="o">(</span><span class="n">originalWidth</span> <span class="o">-</span> <span class="mi">1</span><span class="o">,</span> 
                                                                     <span class="n">originalHeight</span> <span class="o">-</span> <span class="mi">1</span><span class="o">,</span> 
                                                                     <span class="nc">Image</span><span class="o">.</span><span class="na">SCALE_SMOOTH</span><span class="o">);</span>

                <span class="c1">// Resize the resized image by adding 1px on Width and Height</span>
                <span class="c1">// In fact set image to is initial size</span>
                <span class="nc">Image</span> <span class="n">initialSizedImage</span> <span class="o">=</span> <span class="n">resizedImage</span><span class="o">.</span><span class="na">getScaledInstance</span><span class="o">(</span><span class="n">originalWidth</span><span class="o">,</span> 
                                                                         <span class="n">originalHeight</span><span class="o">,</span>
                                                                         <span class="nc">Image</span><span class="o">.</span><span class="na">SCALE_SMOOTH</span><span class="o">);</span>

                <span class="c1">// Save image by overwriting the provided source file content</span>
                <span class="nc">BufferedImage</span> <span class="n">sanitizedImage</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedImage</span><span class="o">(</span><span class="n">initialSizedImage</span><span class="o">.</span><span class="na">getWidth</span><span class="o">(</span><span class="kc">null</span><span class="o">),</span> 
                                                                 <span class="n">initialSizedImage</span><span class="o">.</span><span class="na">getHeight</span><span class="o">(</span><span class="kc">null</span><span class="o">),</span> 
                                                                 <span class="nc">BufferedImage</span><span class="o">.</span><span class="na">TYPE_INT_RGB</span><span class="o">);</span>
                <span class="nc">Graphics</span> <span class="n">bg</span> <span class="o">=</span> <span class="n">sanitizedImage</span><span class="o">.</span><span class="na">getGraphics</span><span class="o">();</span>
                <span class="n">bg</span><span class="o">.</span><span class="na">drawImage</span><span class="o">(</span><span class="n">initialSizedImage</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
                <span class="n">bg</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
                <span class="k">try</span> <span class="o">(</span><span class="nc">OutputStream</span> <span class="n">fos</span> <span class="o">=</span> <span class="nc">Files</span><span class="o">.</span><span class="na">newOutputStream</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">toPath</span><span class="o">(),</span> <span class="nc">StandardOpenOption</span><span class="o">.</span><span class="na">WRITE</span><span class="o">))</span> <span class="o">{</span>
                    <span class="k">if</span> <span class="o">(!</span><span class="n">fallbackOnApacheCommonsImaging</span><span class="o">)</span> <span class="o">{</span>
                        <span class="nc">ImageIO</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">sanitizedImage</span><span class="o">,</span> <span class="n">formatName</span><span class="o">,</span> <span class="n">fos</span><span class="o">);</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="nc">ImageParser</span> <span class="n">imageParser</span><span class="o">;</span>
                        <span class="c1">//Handle only formats for which Apache Commons Imaging can successfully write </span>
                        <span class="c1">// (YES in Write column of the reference link) the image format</span>
                        <span class="c1">//See reference link in the class header</span>
                        <span class="k">switch</span> <span class="o">(</span><span class="n">formatName</span><span class="o">)</span> <span class="o">{</span>
                            <span class="k">case</span> <span class="s">"TIFF"</span><span class="o">:</span> <span class="o">{</span>
                                <span class="n">imageParser</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TiffImageParser</span><span class="o">();</span>
                                <span class="k">break</span><span class="o">;</span>
                            <span class="o">}</span>
                            <span class="k">case</span> <span class="s">"PCX"</span><span class="o">:</span> <span class="o">{</span>
                                <span class="n">imageParser</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PcxImageParser</span><span class="o">();</span>
                                <span class="k">break</span><span class="o">;</span>
                            <span class="o">}</span>
                            <span class="k">case</span> <span class="s">"DCX"</span><span class="o">:</span> <span class="o">{</span>
                                <span class="n">imageParser</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DcxImageParser</span><span class="o">();</span>
                                <span class="k">break</span><span class="o">;</span>
                            <span class="o">}</span>
                            <span class="k">case</span> <span class="s">"BMP"</span><span class="o">:</span> <span class="o">{</span>
                                <span class="n">imageParser</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BmpImageParser</span><span class="o">();</span>
                                <span class="k">break</span><span class="o">;</span>
                            <span class="o">}</span>
                            <span class="k">case</span> <span class="s">"GIF"</span><span class="o">:</span> <span class="o">{</span>
                                <span class="n">imageParser</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GifImageParser</span><span class="o">();</span>
                                <span class="k">break</span><span class="o">;</span>
                            <span class="o">}</span>
                            <span class="k">case</span> <span class="s">"PNG"</span><span class="o">:</span> <span class="o">{</span>
                                <span class="n">imageParser</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PngImageParser</span><span class="o">();</span>
                                <span class="k">break</span><span class="o">;</span>
                            <span class="o">}</span>
                            <span class="k">case</span> <span class="s">"WBMP"</span><span class="o">:</span> <span class="o">{</span>
                                <span class="n">imageParser</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">WbmpImageParser</span><span class="o">();</span>
                                <span class="k">break</span><span class="o">;</span>
                            <span class="o">}</span>
                            <span class="k">case</span> <span class="s">"XBM"</span><span class="o">:</span> <span class="o">{</span>
                                <span class="n">imageParser</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">XbmImageParser</span><span class="o">();</span>
                                <span class="k">break</span><span class="o">;</span>
                            <span class="o">}</span>
                            <span class="k">case</span> <span class="s">"XPM"</span><span class="o">:</span> <span class="o">{</span>
                                <span class="n">imageParser</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">XpmImageParser</span><span class="o">();</span>
                                <span class="k">break</span><span class="o">;</span>
                            <span class="o">}</span>
                            <span class="k">default</span><span class="o">:</span> <span class="o">{</span>
                                <span class="k">throw</span> <span class="k">new</span> <span class="nf">IOException</span><span class="o">(</span><span class="s">"Format of the original image is not"</span> <span class="o">+</span> 
                                                      <span class="s">" supported for write operation !"</span><span class="o">);</span>
                            <span class="o">}</span>

                        <span class="o">}</span>
                        <span class="n">imageParser</span><span class="o">.</span><span class="na">writeImage</span><span class="o">(</span><span class="n">sanitizedImage</span><span class="o">,</span> <span class="n">fos</span><span class="o">,</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;());</span>
                    <span class="o">}</span>

                <span class="o">}</span>

                <span class="c1">// Set state flag</span>
                <span class="n">safeState</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">safeState</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
            <span class="no">LOG</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">"Error during Image file processing !"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">safeState</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h1 id="sources-of-the-prototype">Sources of the prototype</h1>

<p>GitHub <a href="https://github.com/righettod/document-upload-protection">repository</a></p>

          </section>
          

          
          
          
          
          
          
          

          <nav role="navigation" aria-label="navigate page">
            <ol>
            
            
              <li class='page previous'><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Pinning_Cheat_Sheet"><span style="font-size: 3em; color: lightgray; vertical-align:middle;">
                  <i class="fas fa-angle-left"></i>
                </span>Pinning Cheat Sheet</a></li>
            
            
            
              <li class='page next'><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Query_Parameterization_Cheat_Sheet">Query Parameterization Cheat Sheet<span style="font-size: 3em; color: lightgray; vertical-align:middle;">
                  <i class="fas fa-angle-right"></i>
                </span></a></li>
            
            </ol>
        </nav>
       </div>
       <hr>
       <div class="repo">
       </div>

          <div class="github-buttons">
    <a class="github-button" href="https://github.com/owasp/www-chapter-ankara/subscription" data-icon="octicon-eye" data-size="large" data-show-count="true" aria-label="Watch on GitHub">Watch</a>
    <a class="github-button" href="https://github.com/owasp/www-chapter-ankara" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star on GitHub">Star</a>
 </div>

          <div class="sidebar" role="complementary">
    

    
    
       



  
  <div class='owasp-sidebar-top'>
    <strong>The OWASP<sup>&reg;</sup> Foundation</strong> works to improve the security of software through its community-led open source software projects, 
     hundreds of chapters worldwide, tens of thousands of members, and by hosting local and global conferences.
</div>


  
  
  
<ul>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/AJAX_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">AJAX Security 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Abuse_Case_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Abuse Case 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Access_Control_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Access Control 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Attack_Surface_Analysis_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Attack Surface Analysis 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Authentication_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Authentication 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Authorization_Testing_Automation.html">
<span style="font-size:smaller;text-decoration:none;">Authorization Testing Automation
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Bean_Validation_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Bean Validation 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/C-Based_Toolchain_Hardening.html">
<span style="font-size:smaller;text-decoration:none;">C-Based Toolchain Hardening
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/C-Based_Toolchain_Hardening_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">C-Based Toolchain Hardening 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Choosing_and_Using_Security_Questions_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Choosing and Using Security Questions 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Clickjacking Defense 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Content_Security_Policy_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Content Security Policy 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Credential_Stuffing_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Credential Stuffing Prevention 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Cross-Site Request Forgery Prevention 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Cross Site Scripting Prevention 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Cryptographic Storage 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/DOM_based_XSS_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">DOM based XSS Prevention 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Denial_of_Service_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Denial of Service 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Deserialization_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Deserialization 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Docker_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Docker Security 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/DotNet_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">DotNet Security 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Error_Handling_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Error Handling 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Forgot_Password_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Forgot Password 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/HTML5_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">HTML5 Security 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/HTTP_Strict_Transport_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">HTTP Strict Transport Security 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Injection_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Injection Prevention 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Injection_Prevention_Cheat_Sheet_in_Java.html">
<span style="font-size:smaller;text-decoration:none;">Injection Prevention  in Java
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Input_Validation_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Input Validation 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Insecure_Direct_Object_Reference_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Insecure Direct Object Reference Prevention 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/JAAS_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">JAAS 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/JSON_Web_Token_Cheat_Sheet_for_Java.html">
<span style="font-size:smaller;text-decoration:none;">JSON Web Token  for Java
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Key_Management_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Key Management 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/LDAP_Injection_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">LDAP Injection Prevention 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Logging_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Logging 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Mass_Assignment_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Mass Assignment 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Microservices_based_Security_Arch_Doc_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Microservices based Security Arch Doc 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Multifactor_Authentication_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Multifactor Authentication 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Nodejs_security_cheat_sheet.html">
<span style="font-size:smaller;text-decoration:none;">Nodejs security cheat sheet
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">OS Command Injection Defense 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/PHP_Configuration_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">PHP Configuration 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Password_Storage_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Password Storage 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Pinning_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Pinning 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Protect_FileUpload_Against_Malicious_File.html">
<span style="font-size:normal;text-decoration:none;font-weight: bold;">Protect FileUpload Against Malicious File
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Query_Parameterization_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Query Parameterization 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/REST_Assessment_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">REST Assessment 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/REST_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">REST Security 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Ruby_on_Rails_Cheatsheet.html">
<span style="font-size:smaller;text-decoration:none;">Ruby on Rails 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/SAML_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">SAML Security 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">SQL Injection Prevention 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Securing_Cascading_Style_Sheets_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Securing Cascading Style Sheets 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Server Side Request Forgery Prevention 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Session_Management_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Session Management 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/TLS_Cipher_String_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">TLS Cipher String 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Third_Party_Javascript_Management_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Third Party Javascript Management 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Threat_Modeling_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Threat Modeling 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Transaction_Authorization_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Transaction Authorization 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Transport_Layer_Protection_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Transport Layer Protection 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Unvalidated Redirects and Forwards 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/User_Privacy_Protection_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">User Privacy Protection 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Virtual_Patching_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Virtual Patching 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Vulnerability_Disclosure_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Vulnerability Disclosure 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Vulnerable_Dependency_Management_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Vulnerable Dependency Management 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/Web_Service_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Web Service Security 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">XML External Entity Prevention 
</span></a></li>

<li><a href="https://github.com/pages/OWASP/www-chapter-ankara/cheatsheets/XML_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">XML Security 
</span></a></li>

</ul>

  
  
  

  <div class='owasp-sidebar-bottom'>
<h3>Upcoming Global Events</h3>
   <ul>
      <li><a href="https://appsecdays.org/?utm_source=owasp-web&utm_medium=right-col&utm_campaign=www-chapter-ankara" target="_blank" rel="noopener">Virtual AppSec Days, Summer</a></li>
      <li><a href="https://sf.globalappsec.org/?utm_source=owasp-web&utm_medium=right-col&utm_campaign=www-chapter-ankara" target="_blank" rel="noopener">Global AppSec SF October 19th-23rd</a></li>
     <li><a href="https://dublin.globalappsec.org/?utm_source=owasp-web&utm_medium=right-col&utm_campaign=www-chapter-ankara" target="_blank" rel="noopener">Global AppSec Dublin February 15-19th, 2021</a></li>
   </ul>
</div>


  <!--<div>
    <h3>OWASP News & Opinions</h3>
    <ul>
    	
    </ul>	
  </div>-->
</div>

      </div>
    </main>
    <footer>
  
  <section class="member">

  <script type="text/javascript">
    var members = [];
    $(function() {
      
      corp_members = YAML.load('https://owasp.org/assets/sitedata/corp_members.yml');
      $.each(corp_members, function (index) {
        members.push(this);
        });
        var randomIndexUsed = [];
        var counter = 0;
        var numberOfImages = 9;
        if(members.length > 0)
        {
          var htmlstring = "";
          while (counter < numberOfImages)
          {
              var randomIndex;
              var img;

              randomIndex = Math.floor(Math.random() * members.length);

              if (randomIndexUsed.indexOf(randomIndex) == "-1")
              {
                  counter++;
                  htmlstring += '<a href="'+ members[randomIndex]["url"] + '" class="member-logo" rel="sponsored noopener noreferrer" target="_blank" onclick="handleOutboundLinkClicks(event);"><img src="https://owasp.org' + members[randomIndex]["image"] + '" alt="image"/></a>';
                  
                  randomIndexUsed.push(randomIndex);
              }
          }

          $("#corp_member_div").html(htmlstring);
         
          var randi = Math.floor(Math.random() * members.length);
          htmlstring = '<h2>Spotlight: ' + members[randi]["name"] + '</h2>';
          htmlstring += '<a href="'+ members[randi]["url"] + '" rel="sponsored nopener noreferrer" target="_blank" onclick="handleOutboundLinkClicks(event);"><img src="https://owasp.org' + members[randi]["image"] + '" alt="image" /></a>';
          htmlstring += '<p>' + members[randi]["description"] + '</p>';
          $(".member-spotlight").html(htmlstring);
        }
    });
  </script>
  <div class="member-wrapper">
    <section class="member-spotlight">
    </section>
    <section class="member-list">
      <h2>Corporate Supporters</h2>
      <div id="corp_member_div">
      </div>
      <div class="member-cta">
        <a class="callout-link" href="/supporters">Become a corporate supporter</a>
      </div>
    </section>
  </div>
</section>

  
  <section class="footer-wrapper">
    <section class="social">
<a href="https://owasp-slack.herokuapp.com" aria-label="slack group" target="_blank" rel="noopener noreferrer"><i class="fa fa-lg fa-slack"></i></a>
<a href="https://www.facebook.com/OWASPFoundation" aria-label="facebook group" target="_blank" rel="noopener noreferrer"><i class="fa fa-lg fa-facebook-square"></i></a>
<a href="https://twitter.com/owasp" aria-label="twitter account" target="_blank" rel="noopener noreferrer"><i class="fa fa-lg fa-twitter"></i></a>
<a href="https://www.linkedin.com/company/owasp/" aria-label="linkedin account" target="_blank" rel="noopener noreferrer"><i class="fa fa-lg fa-linkedin"></i></a>
<a href="https://www.youtube.com/user/OWASPGLOBAL" aria-label="youtube account" target="_blank" rel="noopener noreferrer"><i class="fa fa-lg fa-youtube-square"></i></a>
</section>
    <nav class="bot-nav" role="navigation" aria-label="secondary navigation">
      <ul>
        <li><a href="/">HOME</a></li>
        <li><a href="/projects/">PROJECTS</a></li>
        <li><a href="/chapters/">CHAPTERS</a></li>
        <li><a href="/events/">EVENTS</a></li>
        <li><a href="/about/">ABOUT</a></li>
        <li><a href="/www-policy/operational/privacy">PRIVACY</a></li>
        <li><a href="/sitemap/">SITEMAP</a></li>
        <li><a href="/contact/">CONTACT</a></li>
      </ul>
    </nav>
    <p class="disclaimer">
        OWASP, Open Web Application Security Project, and Global AppSec are registered trademarks and AppSec Days, AppSec California, AppSec Cali, SnowFROC, LASCON, and the OWASP logo are trademarks of the OWASP Foundation, Inc. Unless otherwise specified, all content on the site is Creative Commons Attribution-ShareAlike v4.0 and provided without warranty of service or accuracy. For more information, please refer to our <a href="/www-policy/operational/general-disclaimer.html">General Disclaimer</a>. OWASP does not endorse or recommend commercial products or services, allowing our community to remain vendor neutral with the collective wisdom of the best minds in software security worldwide. Copyright 2020, OWASP Foundation, Inc.      
    </p>
  </section>
</footer>

  </body>
</html>


