<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">







<meta name="description" content="C-Based Toolchain Hardening on the main website for The OWASP Foundation. OWASP is a nonprofit foundation that works to improve the security of software.">
<meta property="og:description" content="C-Based Toolchain Hardening on the main website for The OWASP Foundation. OWASP is a nonprofit foundation that works to improve the security of software.">
<meta propery="og:title" content="cheat sheets | C-Based Toolchain Hardening | OWASP Foundation">
<meta property="og:url" content="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/C-Based_Toolchain_Hardening.html">
<meta property="og:locale" content="en_US">

<!-- should probably look at using article at some point for www-community at least -->
<meta property="og:type" content="website" />
<meta property="og:image" content="https://owasp.org/www--site-theme/favicon.ico" />
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="X-XSS-Protection" content="1; mode=block">


<link rel="canonical" href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/C-Based_Toolchain_Hardening" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=UA-4531126-1"></script> -->
<!-- <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-4531126-1');
</script> -->
<!-- Google Analytics -->


<script src="https://owasp.org/www--site-theme/assets/js/js.cookie.js"></script>
<script>
  if(Cookies.get('cookies-ok') == 'true' && window.ga === undefined)
  {
    window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
    ga('create', 'UA-4531126-1', 'auto');
    ga('send', 'pageview');
  }
  else if (Cookies.get('cookies-ok') == 'true')
  {
    ga('send', 'pageview');
  }

  function handleOutboundLinkClicks(event) {
    var href = '';
    if(event.target.href == undefined)
      href = event.target.parentElement.href;
    else
      href = event.target.href
  if(Cookies.get('cookies-ok') == 'true'){  
    
    ga('send', 'event', {
      eventCategory: 'Outbound Link',
      eventAction: 'click',
      eventLabel: href,
      transport: 'beacon'
    });
  }
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<!-- End Google Analytics -->
<link rel="stylesheet" href="https://owasp.org/www--site-theme/assets/css/styles.css">
<link rel="shortcut icon" type="images/x-icon" href="https://owasp.org/www--site-theme/favicon.ico">

<script src="https://owasp.org/www--site-theme/assets/js/jquery-3.4.1.min.js"></script>
<script src="https://owasp.org/www--site-theme/assets/js/util.js"></script>
<script src="https://owasp.org/www--site-theme/assets/js/yaml.min.js"></script>
<script src="https://owasp.org/www--site-theme/assets/js/luxon.min.js"></script>
<title>C-Based Toolchain Hardening | OWASP</title>

    <script type="text/javascript">
      $(function(){
        var baseurl = "https://github.com/owaspankara/www-chapter-ankara/blob/master/";
        var path = "cheatsheets/C-Based_Toolchain_Hardening.md";
        $('.repo').html('<a href=' + baseurl + path + '><div class="reset-3c756112--menuItemIcon-206eb252" style="float: left;"><svg preserveAspectRatio="xMidYMid meet" height="1em" width="1em" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 438.549 438.549" stroke="none" class="icon-7f6730be--text-3f89f380"><g><path d="M409.132 114.573c-19.608-33.596-46.205-60.194-79.798-79.8-33.598-19.607-70.277-29.408-110.063-29.408-39.781 0-76.472 9.804-110.063 29.408-33.596 19.605-60.192 46.204-79.8 79.8C9.803 148.168 0 184.854 0 224.63c0 47.78 13.94 90.745 41.827 128.906 27.884 38.164 63.906 64.572 108.063 79.227 5.14.954 8.945.283 11.419-1.996 2.475-2.282 3.711-5.14 3.711-8.562 0-.571-.049-5.708-.144-15.417a2549.81 2549.81 0 0 1-.144-25.406l-6.567 1.136c-4.187.767-9.469 1.092-15.846 1-6.374-.089-12.991-.757-19.842-1.999-6.854-1.231-13.229-4.086-19.13-8.559-5.898-4.473-10.085-10.328-12.56-17.556l-2.855-6.57c-1.903-4.374-4.899-9.233-8.992-14.559-4.093-5.331-8.232-8.945-12.419-10.848l-1.999-1.431c-1.332-.951-2.568-2.098-3.711-3.429-1.142-1.331-1.997-2.663-2.568-3.997-.572-1.335-.098-2.43 1.427-3.289 1.525-.859 4.281-1.276 8.28-1.276l5.708.853c3.807.763 8.516 3.042 14.133 6.851 5.614 3.806 10.229 8.754 13.846 14.842 4.38 7.806 9.657 13.754 15.846 17.847 6.184 4.093 12.419 6.136 18.699 6.136 6.28 0 11.704-.476 16.274-1.423 4.565-.952 8.848-2.383 12.847-4.285 1.713-12.758 6.377-22.559 13.988-29.41-10.848-1.14-20.601-2.857-29.264-5.14-8.658-2.286-17.605-5.996-26.835-11.14-9.235-5.137-16.896-11.516-22.985-19.126-6.09-7.614-11.088-17.61-14.987-29.979-3.901-12.374-5.852-26.648-5.852-42.826 0-23.035 7.52-42.637 22.557-58.817-7.044-17.318-6.379-36.732 1.997-58.24 5.52-1.715 13.706-.428 24.554 3.853 10.85 4.283 18.794 7.952 23.84 10.994 5.046 3.041 9.089 5.618 12.135 7.708 17.705-4.947 35.976-7.421 54.818-7.421s37.117 2.474 54.823 7.421l10.849-6.849c7.419-4.57 16.18-8.758 26.262-12.565 10.088-3.805 17.802-4.853 23.134-3.138 8.562 21.509 9.325 40.922 2.279 58.24 15.036 16.18 22.559 35.787 22.559 58.817 0 16.178-1.958 30.497-5.853 42.966-3.9 12.471-8.941 22.457-15.125 29.979-6.191 7.521-13.901 13.85-23.131 18.986-9.232 5.14-18.182 8.85-26.84 11.136-8.662 2.286-18.415 4.004-29.263 5.146 9.894 8.562 14.842 22.077 14.842 40.539v60.237c0 3.422 1.19 6.279 3.572 8.562 2.379 2.279 6.136 2.95 11.276 1.995 44.163-14.653 80.185-41.062 108.068-79.226 27.88-38.161 41.825-81.126 41.825-128.906-.01-39.771-9.818-76.454-29.414-110.049z"></path></g></svg><span style="padding-left:8px;">Edit on GitHub</span></div></a>');
      });
    </script>
    <script async defer src="https://buttons.github.io/buttons.js"></script>
  </head>
  <body class="base-grid col-sidebar">

    <div id="blocker"></div>

    <noscript>For full functionality of this site it is necessary to enable JavaScript. Here are the <a href="https://www.enable-javascript.com/"> instructions how to enable JavaScript in your web browser</a>.</noscript>
    <header role="banner">
  <div id="banner" class="notice" aria-label="announcement">
  <!--
	<p>Consider <a href="/membership">becoming a Member</a> of the OWASP Foundation. It's affordable and your contributions make a difference.</p>
  -->
 
	<p>Please support the OWASP mission to improve sofware security through open source initiatives and community education. <a href="https://owasp.org/donate/">Donate Now!</a></p>
	
	<a href="#" id="close-banner" aria-label="close announcement">
          <i class="fa fa-times"></i>
       </a>	  
</div>

<style>
  #banner img {
    max-width: 30em;
  }

  @media (max-width: 1131px) {
    #banner img{
      max-width: 30em;
    }
	}

@media (max-width: 800px) {
	#banner img{
      max-width: 20em;
    }
}

@media (max-width: 600px) {
	#banner img{
      max-width: 20em;
    }
}

@media (max-width: 450px) {
	#banner img{
      max-width: 250px;
  }
}
</style>

  <div class="header-wrapper" aria-label="main navigation">
    <nav class="alt-nav">
      <a href="#" class="menu-toggler" aria-hidden="true">
        <i class="fa fa-bars"></i>
      </a>
      <a href="/" class="alt-logo" aria-label="go to homepage">
          <img src="/assets/images/logo.png" alt="OWASP logo">
      </a>
      <div id="overlay" class="remove-el">

      </div>
      <!-- jekyll menu stuff -->
    </nav>
    
    <nav class="top-nav" role="navigation" aria-label="primary navigation">
      <a href="/" class="desktop-logo" aria-label="go to homepage">
        <img src="/assets/images/logo.png" alt="">
      </a>
      <!-- jekyll menu stuff -->
      
      <div class="interactive-wrapper">
        <form role="search" method="get" action="/search">   
          <div class='search-div'>
            <input id="searchString" name="searchString" class="search-bar" type="search" placeholder="Search OWASP.org" required="true">
            <button id="search-button" type="submit" class="fa fa-search">
                <!--<span id="search-icon" tabindex="0"><i class="fa fa-search"></i></span>-->
            </button>
          </div>  
        </form>
        <div class="nav-button" aria-label="donate to or join OWASP">
        
          <a href="/donate?reponame=www-chapter-ankara&title=C-Based+Toolchain+Hardening" class="cta-button green">Donate</a>
          <a href="/membership" class="cta-button">Join</a>
        </div>
      </div>
    </nav>
    <div id='disclaimer-container'>
<div id="disclaimer">
    <p>This website uses cookies to analyze our traffic and only share that information with our analytics partners.</p><a class="disclaimerOK">Accept</a>
</div>
<div id="close-disclaimer">x</div>
</div>
  </div>
  



<script type="text/javascript">
  $(function(){
      
      url = $(location).attr('href');
      if(url.includes('www2'))
      {
        url = url.replace(/www2./, '');
        $(location).attr('href',url);
        return;
      }
    // this works to get data from a json file NOT in data
      $.getJSON("https://owasp.org/www--site-theme/assets/sitedata/menus.json", function(data) {
         var listr = "<ul aria-label='header menu'>";
         
         var mlistr = "<ul class='mobile-menu hide-el' role='navigation' aria-label='mobile primary navigation'>";

          mlistr += "<li><a href='#' class='menu-toggler' aria-hidden='true'><i class='fa fa-times'></i></a></li>";
          mlistr += "<li>";
          mlistr += "<form role='search' method='get' action='/search'>";   
          mlistr += "<div class='search-div'>";
          mlistr += "<input id='searchString' aria-label='search input' name='searchString' class='search-bar' type='search' placeholder='Search OWASP.org' required='true'>";
          mlistr += "<button id='search-button' aria-label='search button' type='submit' class='fa fa-search' style='padding-left: 8px;'></button></div></form>";
          mlistr += "</li>";
          $.each(data.menus, function (ndx, menu){
              listr += "<li><a href='" + menu.url + "'>" + menu.title + "</a>";

              if(!menu.items)
              {
                  mlistr += "<li><a href='" + menu.url + "'>" + menu.title + "</a>";
              }
              
              if(menu.items){
                  listr += "<ul class='dropdown-menu'>";
                  mlistr += "<button class='accordion'>" + menu.title + "</button>";
                  mlistr += "<div class='panel'>";
                  mlistr += "<ul>";
                $.each(menu.items, function(ndx, item){
                
                  if(item.separator)
                  {
                      listr += "<li class='separator'>";
                      mlistr += "<li class='separator'>";
                  }
                  else
                  {
                      listr += "<li>";
                      mlistr += "<li>";
                  }
                  listr += "<a href='" + item.url + "'";
                  mlistr += "<a href='" + item.url + "'";
                  if(item.opentab)
                  {
                    listr += " target='_blank' rel='noopener noreferrer'";
                    mlistr += " target='_blank' rel='noopener noreferrer'";
                  }

                  listr += ">" + item.title + "</a></li>";
                  mlistr += ">" + item.title + "</a></li>";
                });
                listr += "</ul>";
                mlistr += "</ul>";
                mlistr += "</div>"
              }
              
              listr += "</li>";
              mlistr += "</li>";
          });
          listr += "</ul>";
          mlistr += "<li><a href='/donate'>MAKE A DONATION</a></li>";
          mlistr += "<li><a href='/membership'>BECOME A MEMBER</a></li>";
          mlistr += "<li><a href='/sitemap'>SITEMAP</a></li>";
          mlistr += "</ul>";
          
          $('.desktop-logo').after(listr);
          $('#overlay').after(mlistr);

          $(".accordion").click(function () {
              $(this).toggleClass("active");
              if($(this).next('.panel').css('display') == 'block'){
                $(this).next('.panel').css('display', 'none');
              }
              else {
                $(this).next('.panel').css('display', 'block');
              }
            });
            $(".menu-toggler").click(function() {
              $(".mobile-menu").toggleClass('hide-el');
            });
      });
    });
  </script>
</header>


    <main role="main">
      <div class="main-wrapper document">
        
  
  
  
  
  
  
  




                




    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    
        
        
        <div id="main" class="page-body tab" role="tabpanel" aria-labelledby="main-link" tabindex="0">
          <div class="doc-title">cheat sheets</div>
          <h1 class="page-title">C-Based Toolchain Hardening</h1>
          
          <nav role="navigation" aria-label="navigate page">
              <ol>
              
                
                <li class='page previous'><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Bean_Validation_Cheat_Sheet"><span style="font-size: 3em; color: lightgray; vertical-align:middle;">
                    <i class="fas fa-angle-left"></i>
                  </span>Bean Validation Cheat Sheet</a></li>
              
              
                
                <li class='page next'><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/C-Based_Toolchain_Hardening_Cheat_Sheet">C-Based Toolchain Hardening Cheat Sheet<span style="font-size: 3em; color: lightgray; vertical-align:middle;">
                    <i class="fas fa-angle-right"></i>
                  </span></a></li>
              
              </ol>
          </nav>
          
          <section id='div-main' class='page-body tab'>
          <h1 id="introduction">Introduction</h1>

<p>C-Based Toolchain Hardening is a treatment of project settings that will help you deliver reliable and secure code when using C, C++ and Objective C languages in a number of development environments. This article will examine Microsoft and GCC toolchains for the C, C++ and Objective C languages. It will guide you through the steps you should take to create executables with firmer defensive postures and increased integration with the available platform security. Effectively configuring the toolchain also means your project will enjoy a number of benefits during development, including enhanced warnings and static analysis, and self-debugging code.</p>

<p>There are four areas to be examined when hardening the toolchain: configuration, preprocessor, compiler, and linker. Nearly all areas are overlooked or neglected when setting up a project. The neglect appears to be pandemic, and it applies to nearly all projects including Auto-configured projects, Makefile-based, Eclipse-based, Visual Studio-based, and Xcode-based. Its important to address the gaps at configuration and build time because its difficult to impossible to <a href="http://sourceware.org/ml/binutils/2012-03/msg00309.html">add hardening on a distributed executable after the fact</a> on some platforms.</p>

<p>This is a prescriptive article, and it will not debate semantics or speculate on behavior. Some information, such as the C/C++ committee’s motivation and pedigree for <a href="https://groups.google.com/a/isocpp.org/forum/?fromgroups=#!topic/std-discussion/ak8e1mzBhGs"><code class="language-plaintext highlighter-rouge">program diagnostics</code>, <code class="language-plaintext highlighter-rouge">NDEBUG</code>, <code class="language-plaintext highlighter-rouge">assert</code>, and <code class="language-plaintext highlighter-rouge">abort()</code></a>, appears to be lost like a tale in the Lord of the Rings. As such, the article will specify semantics (for example, the philosophy of ‘debug’ and ‘release’ build configurations), assign behaviors (for example, what an assert should do in a ‘debug’ and ‘release’ build configurations), and present a position. If you find the posture is too aggressive, then you should back off as required to suite your taste.</p>

<p>A secure toolchain is not a silver bullet. It is one piece of an overall strategy in the engineering process to help ensure success. It will compliment existing processes such as static analysis, dynamic analysis, secure coding, negative test suites, and the like. Tools such as Valgrind and Helgrind will still be needed. And a project will still require solid designs and architectures.</p>

<p>The OWASP <a href="http://code.google.com/p/owasp-esapi-cplusplus/source">ESAPI C++</a> project eats its own dog food. Many of the examples you will see in this article come directly from the ESAPI C++ project.</p>

<p>Finally, a Cheat Sheet is available for those who desire a terse treatment of the material. Please visit <a href="/cheatsheets/C-Based_Toolchain_Hardening_Cheat_Sheet.html">C-Based Toolchain Hardening Cheat Sheet</a> for the abbreviated version.</p>

<h1 id="wisdom">Wisdom</h1>

<p>Code <strong>must</strong> be correct. It <strong>should</strong> be secure. It <strong>can</strong> be efficient.</p>

<p><a href="http://en.wikipedia.org/wiki/Jon_Bentley">Dr. Jon Bentley</a>: <em>“If it doesn’t have to be correct, I can make it as fast as you’d like it to be”</em>.</p>

<p><a href="http://en.wikipedia.org/wiki/Gary_McGraw">Dr. Gary McGraw</a>: <em>“Thou shalt not rely solely on security features and functions to build secure software as security is an emergent property of the entire system and thus relies on building and integrating all parts properly”</em>.</p>

<h1 id="configuration">Configuration</h1>

<p>Configuration is the first opportunity to configure your project for success. Not only do you have to configure your project to meet reliability and security goals, you must also configure integrated libraries properly. You typically have has three choices. First, you can use auto-configuration utilities if on Linux or Unix. Second, you can write a makefile by hand. This is predominant on Linux, Mac OS X, and Unix, but it applies to Windows as well. Finally, you can use an integrated development environment or IDE.</p>

<h2 id="build-configurations">Build Configurations</h2>

<p>At this stage in the process, you should concentrate on configuring for two builds: Debug and Release. Debug will be used for development and include full instrumentation. Release will be configured for production. The difference between the two settings is usually <em>optimization level</em> and <em>debug level</em>. A third build configuration is Test, and its usually a special case of Release.</p>

<p>For debug and release builds, the settings are typically diametrically opposed. Debug configurations have no optimizations and full debug information; while Release builds have optimizations and minimal to moderate debug information. In addition, debug code has full assertions and additional library integration, such as mudflaps and malloc guards such as <code class="language-plaintext highlighter-rouge">dmalloc</code>.</p>

<p>The Test configuration is often a Release configuration that makes everything public for testing and builds a test harness. For example, all member functions public (C++ class) and all interfaces (library or shared object) should be made available for testing. Many Object Oriented purist oppose testing private interfaces, but this is not about object oriented-ness. This (<em>q.v.</em>) is about building reliable and secure software.</p>

<p><a href="http://gcc.gnu.org/gcc-4.8/changes.html">GCC 4.8</a> introduced an optimization of <code class="language-plaintext highlighter-rouge">-Og</code>. Note that it is only an optimization, and still requires a customary debug level via <code class="language-plaintext highlighter-rouge">-g</code>.</p>

<h3 id="debug-builds">Debug Builds</h3>

<p>Debug builds are where developers spend most of their time when vetting problems, so this build should concentrate forces and tools or be a ‘force multiplier’. Though many do not realize, debug code is more highly valued than release code because its adorned with additional instrumentation. The debug instrumentation will cause a program to become nearly “self-debugging”, and help you catch mistakes such as bad parameters, failed API calls, and memory problems.</p>

<p>Self-debugging code reduces your time during trouble shooting and debugging. Reducing time under the debugger means you have more time for development and feature requests. If code is checked in without debug instrumentation, it should be fixed by adding instrumentation or rejected.</p>

<p>For GCC, optimizations and debug symbolication are controlled through two switches: <code class="language-plaintext highlighter-rouge">-O</code> and <code class="language-plaintext highlighter-rouge">-g</code>. You should use the following as part of your <code class="language-plaintext highlighter-rouge">CFLAGS</code> and <code class="language-plaintext highlighter-rouge">CXXFLAGS</code> for a minimal debug session:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-O0 -g3 -ggdb
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">-O0</code> turns off optimizations and <code class="language-plaintext highlighter-rouge">-g3</code> ensures maximum debug information is available. You may need to use <code class="language-plaintext highlighter-rouge">-O1</code> so some analysis is performed. Otherwise, your debug build will be missing a number of warnings not present in release builds. <code class="language-plaintext highlighter-rouge">-g3</code> ensures maximum debugging information is available for the debug session, including symbolic constants and <code class="language-plaintext highlighter-rouge">#defines</code>. <code class="language-plaintext highlighter-rouge">-ggdb</code> includes extensions to help with a debug session under GDB. For completeness, Jan Krachtovil stated <code class="language-plaintext highlighter-rouge">-ggdb</code> currently has no effect in a private email.</p>

<p>Release builds should also consider the configuration pair of <code class="language-plaintext highlighter-rouge">-mfunction-return=thunk</code> and <code class="language-plaintext highlighter-rouge">-mindirect-branch=thunk</code>. These are the “Reptoline” fix which is an indirect branch used to thwart speculative execution CPU vulnerabilities such as Spectre and Meltdown. The CPU cannot tell what code to <code class="language-plaintext highlighter-rouge">speculatively</code> execute because it is an indirect (as opposed to a direct) branch. This is an extra layer of indirection, like calling a pointer through a pointer.</p>

<p>Debug build should also define <code class="language-plaintext highlighter-rouge">DEBUG</code>, and ensure <code class="language-plaintext highlighter-rouge">NDEBUG</code> is not defined. <code class="language-plaintext highlighter-rouge">NDEBUG</code> removes “program diagnostics”; and has undesirable behavior and side effects which discussed below in more detail. The defines should be present for all code, and not just the program. You use it for all code (your program and included libraries) because you need to know how they fail too (remember, you take the bug report - not the third party library).</p>

<p>In addition, you should use other relevant flags, such as <code class="language-plaintext highlighter-rouge">-fno-omit-frame-pointer</code>. Ensuring a frame pointer exists makes it easier to decode stack traces. Since debug builds are not shipped, its OK to leave symbols in the executable. Programs with debug information do not suffer performance hits. See, for example, <a href="http://gcc.gnu.org/ml/gcc-help/2005-03/msg00032.html">How does the gcc -g option affect performance?</a></p>

<p>Finally, you should ensure your project includes additional diagnostic libraries, such as <code class="language-plaintext highlighter-rouge">dmalloc</code> and <a href="http://code.google.com/p/address-sanitizer/">Address Sanitizer</a>. A comparison of some memory checking tools can be found at <a href="http://code.google.com/p/address-sanitizer/wiki/ComparisonOfMemoryTools">Comparison Of Memory Tools</a>. If you don’t include additional diagnostics in debug builds, then you should start using them sinces its OK to find errors you are not looking for.</p>

<h3 id="release-builds">Release Builds</h3>

<p>Release builds are what your customer receives. They are meant to be run on production hardware and servers, and they should be reliable, secure, and efficient. A stable release build is the product of the hard work and effort during development.</p>

<p>For release builds, you should use the following as part of <code class="language-plaintext highlighter-rouge">CFLAGS</code> and <code class="language-plaintext highlighter-rouge">CXXFLAGS</code> for release builds:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-On -g2
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">-O</code><em><code class="language-plaintext highlighter-rouge">n</code></em> sets optimizations for speed or size (for example, <code class="language-plaintext highlighter-rouge">-Os</code> or <code class="language-plaintext highlighter-rouge">-O2</code>), and <code class="language-plaintext highlighter-rouge">-g2</code> ensure debugging information is created.</p>

<p>Debugging information should be stripped and retained in case of symbolication for a crash report from the field. While not desired, debug information can be left in place without a performance penalty. See <em><a href="http://gcc.gnu.org/ml/gcc-help/2005-03/msg00032.html">How does the gcc -g option affect performance?</a></em> for details.</p>

<p>Release builds should also define <code class="language-plaintext highlighter-rouge">NDEBUG</code>, and ensure <code class="language-plaintext highlighter-rouge">DEBUG</code> is not defined. The time for debugging and diagnostics is over, so users get production code with full optimizations, no “programming diagnostics”, and other efficiencies. If you can’t optimize or your are performing excessive logging, it usually means the program is not ready for production.</p>

<p>If you have been relying on an <code class="language-plaintext highlighter-rouge">assert</code> and then a subsequent <code class="language-plaintext highlighter-rouge">abort()</code>, you have been abusing “program diagnostics” since it has no place in production code. If you want a memory dump, create one so users don’t have to worry about secrets and other sensitive information being written to the filesystem and emailed in plain text.</p>

<p>For Windows, you would use <code class="language-plaintext highlighter-rouge">/Od</code> for debug builds; and <code class="language-plaintext highlighter-rouge">/Ox</code>, <code class="language-plaintext highlighter-rouge">/O2</code> or <code class="language-plaintext highlighter-rouge">/Os</code> for release builds. See Microsoft’s <a href="http://msdn.microsoft.com/en-us/library/k1ack8f1.aspx">/O Options (Optimize Code)</a> for details.</p>

<h3 id="test-builds">Test Builds</h3>

<p>Test builds are used to provide heuristic validation by way of positive and negative test suites. Under a test configuration, all interfaces are tested to ensure they perform to specification and satisfaction. “Satisfaction” is subjective, but it should include no crashing and no trashing of your memory arena, even when faced with negative tests.</p>

<p>Because all interfaces are tested (and not just the public ones), your <code class="language-plaintext highlighter-rouge">CFLAGS</code> and <code class="language-plaintext highlighter-rouge">CXXFLAGS</code> should include:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-Dprotected=public -Dprivate=public
</code></pre></div></div>

<p>You should also change <code class="language-plaintext highlighter-rouge">__attribute__</code> <code class="language-plaintext highlighter-rouge">((visibility</code> <code class="language-plaintext highlighter-rouge">("hidden")))</code> to <code class="language-plaintext highlighter-rouge">__attribute__</code> <code class="language-plaintext highlighter-rouge">((visibility</code> <code class="language-plaintext highlighter-rouge">("default")))</code>.</p>

<p>Nearly everyone gets a positive test right, so no more needs to be said. The negative self tests are much more interesting, and you should concentrate on trying to make your program fail so you can verify its fails gracefully. Remember, a bad guy is not going to be courteous when he attempts to cause your program to fail. And its your project that takes egg on the face by way of a bug report or guest appearance on <a href="http://www.grok.org.uk/full-disclosure/">Full Disclosure</a> or <a href="http://www.securityfocus.com/archive">Bugtraq</a> - not <code class="language-plaintext highlighter-rouge">&lt;some library&gt;</code> you included.</p>

<h2 id="auto-tools">Auto Tools</h2>

<p>Auto configuration tools are popular on many Linux and Unix based systems, and the tools include <em>Autoconf</em>, <em>Automake</em>, <em>config</em>, and <em>Configure</em>. The tools work together to produce project files from scripts and template files. After the process completes, your project should be setup and ready to be made with <code class="language-plaintext highlighter-rouge">make</code>.</p>

<p>When using auto configuration tools, there are a few files of interest worth mentioning. The files are part of the auto tools chain and include <code class="language-plaintext highlighter-rouge">m4</code> and the various <code class="language-plaintext highlighter-rouge">*.in</code>, <code class="language-plaintext highlighter-rouge">*.ac</code> (autoconf), and <code class="language-plaintext highlighter-rouge">*.am</code> (automake) files. At times, you will have to open them, or the resulting makefiles, to tune the “stock” configuration.</p>

<p>There are three downsides to the command line configuration tools in the toolchain: (1) they often ignore user requests, (2) they cannot create configurations, and (3) security is often not a goal.</p>

<p>To demonstrate the first issue, confider your project with the following: <code class="language-plaintext highlighter-rouge">configure</code> <code class="language-plaintext highlighter-rouge">CFLAGS="-Wall</code> <code class="language-plaintext highlighter-rouge">-fPIE"</code> <code class="language-plaintext highlighter-rouge">CXXFLAGS="-Wall</code> <code class="language-plaintext highlighter-rouge">-fPIE"</code> <code class="language-plaintext highlighter-rouge">LDFLAGS="-pie"</code>. You will probably find the auto tools ignored your request, which means the command below will not produce expected results. As a work around, you will have to open an <code class="language-plaintext highlighter-rouge">m4</code> scripts, <code class="language-plaintext highlighter-rouge">Makefile.in</code> or <code class="language-plaintext highlighter-rouge">Makefile.am</code> and fix the configuration.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>configure <span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">"-Wall -Wextra -Wconversion -fPIE -Wno-unused-parameter
    -Wformat=2 -Wformat-security -fstack-protector-all -Wstrict-overflow"</span>
    <span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">"-pie -z,noexecstack -z,noexecheap -z,relro -z,now"</span>
</code></pre></div></div>

<p>For the second point, you will probably be disappointed to learn <a href="https://lists.gnu.org/archive/html/automake/2012-12/msg00019.html">Automake does not support the concept of configurations</a>. Its not entirely Autoconf’s or Automake’s fault - <em>Make</em> and its inability to detect changes is the underlying problem. Specifically, <em>Make</em> only <a href="http://pubs.opengroup.org/onlinepubs/009695399/utilities/make.html">checks modification times of prerequisites and targets</a>, and does not check things like <code class="language-plaintext highlighter-rouge">CFLAGS</code> and <code class="language-plaintext highlighter-rouge">CXXFLAGS</code>. The net effect is you will not receive expected results when you issue <code class="language-plaintext highlighter-rouge">make</code> <code class="language-plaintext highlighter-rouge">debug</code> and then <code class="language-plaintext highlighter-rouge">make</code> <code class="language-plaintext highlighter-rouge">test</code> or <code class="language-plaintext highlighter-rouge">make</code> <code class="language-plaintext highlighter-rouge">release</code>.</p>

<p>Finally, you will probably be disappointed to learn tools such as Autoconf and Automake miss many security related opportunities and ship insecure out of the box. There are a number of compiler switches and linker flags that improve the defensive posture of a program, but they are not ‘on’ by default. Tools like Autoconf - which are supposed to handle this situation - often provides setting to serve the lowest of all denominators.</p>

<p>A recent discussion on the Automake mailing list illuminates the issue: <em><a href="https://lists.gnu.org/archive/html/autoconf/2012-12/msg00038.html">Enabling compiler warning flags</a></em>. Attempts to improve default configurations were met with resistance and no action was taken. The resistance is often of the form, “<code class="language-plaintext highlighter-rouge">&lt;some useful warning&gt; also produces false positives</code>” or “<code class="language-plaintext highlighter-rouge">&lt;some obscure platform&gt; does not support &lt;established security feature&gt;</code>”. Its noteworthy that David Wheeler, the author of <em><a href="http://www.dwheeler.com/secure-programs/">Secure Programming for Linux and Unix HOWTO</a></em>, was one of the folks trying to improve the posture.</p>

<h2 id="makefiles">Makefiles</h2>

<p>Make is one of the earliest build systems dating back to the 1970s. Its available on Linux, Mac OS X and Unix, so you will frequently encounter projects using it. Unfortunately, Make has a number of short comings (<em><a href="http://aegis.sourceforge.net/auug97.pdf">Recursive Make Considered Harmful</a></em> and <em><a href="http://www.conifersystems.com/whitepapers/gnu-make/">What’s Wrong With GNU make?</a></em>), and can cause some discomfort. Despite issues with Make, ESAPI C++ uses Make primarily for three reasons: first, its omnipresent; second, its easier to manage than the Auto Tools family; and third, <code class="language-plaintext highlighter-rouge">libtool</code> was out of the question.</p>

<p>Consider what happens when you: (1) type <code class="language-plaintext highlighter-rouge">make</code> <code class="language-plaintext highlighter-rouge">debug</code>, and then type <code class="language-plaintext highlighter-rouge">make</code> <code class="language-plaintext highlighter-rouge">release</code>. Each build would require different <code class="language-plaintext highlighter-rouge">CFLAGS</code> due to optimizations and level of debug support. In your makefile, you would extract the relevant target and set <code class="language-plaintext highlighter-rouge">CFLAGS</code> and <code class="language-plaintext highlighter-rouge">CXXFLAGS</code> similar to below (taken from <a href="http://code.google.com/p/owasp-esapi-cplusplus/source/browse/trunk/Makefile">ESAPI C++ Makefile</a>):</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Makefile
DEBUG_GOALS = $(filter $(MAKECMDGOALS), debug)
ifneq ($(DEBUG_GOALS),)
    WANT_DEBUG := 1
    WANT_TEST := 0
    WANT_RELEASE := 0
endif
…

ifeq ($(WANT_DEBUG),1)
    ESAPI_CFLAGS += -DDEBUG=1 -UNDEBUG -g3 -ggdb -O0
    ESAPI_CXXFLAGS += -DDEBUG=1 -UNDEBUG -g3 -ggdb -O0
endif

ifeq ($(WANT_RELEASE),1)
    ESAPI_CFLAGS += -DNDEBUG=1 -UDEBUG -g -O2
    ESAPI_CXXFLAGS += -DNDEBUG=1 -UDEBUG -g -O2
endif

ifeq ($(WANT_TEST),1)
    ESAPI_CFLAGS += -DESAPI_NO_ASSERT=1 -g2 -ggdb -O2 -Dprivate=public 
                                                      -Dprotected=public
    ESAPI_CXXFLAGS += -DESAPI_NO_ASSERT=1 -g2 -ggdb -O2 -Dprivate=public 
                                                        -Dprotected=public
endif
…

# Merge ESAPI flags with user supplied flags. We perform the extra step to ensure
# user options follow our options, which should give user option's a preference.
override CFLAGS := $(ESAPI_CFLAGS) $(CFLAGS)
override CXXFLAGS := $(ESAPI_CXXFLAGS) $(CXXFLAGS)
override LDFLAGS := $(ESAPI_LDFLAGS) $(LDFLAGS)
…
</code></pre></div></div>

<p>Make will first build the program in a debug configuration for a session under the debugger using a rule similar to:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>%.cpp:%.o:
        $(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $&lt; -o $@
</code></pre></div></div>

<p>When you want the release build, Make will do nothing because it considers everything up to date despite the fact <code class="language-plaintext highlighter-rouge">CFLAGS</code> and <code class="language-plaintext highlighter-rouge">CXXFLAGS</code> have changed. Hence, your program will actually be in a debug configuration and risk a <code class="language-plaintext highlighter-rouge">SIGABRT</code> at runtime because debug instrumentation is present (recall <code class="language-plaintext highlighter-rouge">assert</code> calls <code class="language-plaintext highlighter-rouge">abort()</code> when <code class="language-plaintext highlighter-rouge">NDEBUG</code> is <strong>not</strong> defined). In essence, you have DoS’d yourself due to <code class="language-plaintext highlighter-rouge">make</code>.</p>

<p>In addition, many projects do not honor the user’s command line. ESAPI C++ does its best to ensure a user’s flags are honored via <code class="language-plaintext highlighter-rouge">override</code> as shown above, but other projects do not. For example, consider a project that should be built with Position Independent Executable (PIE or ASLR) enabled and data execution prevention (DEP) enabled. Dismissing user settings combined with insecure out of the box settings (and not picking them up during auto-setup or auto-configure) means a program built with the following will likely have neither defense:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>make <span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">"-fPIE"</span> <span class="nv">CXXFLAGS</span><span class="o">=</span><span class="s2">"-fPIE"</span> <span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">"-pie -z,noexecstack, -z,noexecheap"</span>
</code></pre></div></div>

<p>Defenses such as ASLR and DEP are especially important on Linux because <a href="http://linux.die.net/man/5/elf">Data Execution - not Prevention - is the norm</a>.</p>

<h2 id="integration">Integration</h2>

<p>Project level integration presents opportunities to harden your program or library with domain specific knowledge. For example, if the platform supports Position Independent Executables (PIE or ASLR) and data execution prevention (DEP), then you should integrate with it. The consequences of not doing so could result in exploitation. As a case in point, see KingCope’s 0-days for MySQL in December, 2012 (CVE-2012-5579 and CVE-2012-5612, among others). Integration with platform security would have neutered a number of the 0-days.</p>

<p>You also have the opportunity to include helpful libraries that are not need for business logic support. For example, if you are working on a platform with <a href="http://dmalloc.com">DMalloc</a> or <a href="http://code.google.com/p/address-sanitizer/">Address Sanitizer</a>, you should probably use it in your debug builds. For Ubuntu, DMalloc available from the package manager and can be installed with <code class="language-plaintext highlighter-rouge">sudo</code> <code class="language-plaintext highlighter-rouge">apt-get</code> <code class="language-plaintext highlighter-rouge">install</code> <code class="language-plaintext highlighter-rouge">libdmalloc5</code>. For Apple platforms, its available as a scheme option. Address Sanitizer is available in <a href="http://gcc.gnu.org/gcc-4.8/changes.html">GCC 4.8 and above</a> for many platforms.</p>

<p>In addition, project level integration is an opportunity to harden third party libraries you chose to include. Because you chose to include them, you and your users are responsible for them. If you or your users endure a <code class="language-plaintext highlighter-rouge">SP800-53</code> audit, third party libraries will be in scope because the supply chain is included (specifically, item SA-12, Supply Chain Protection). The audits are not limited to those in the US Federal arena - financial institutions perform reviews too. A perfect example of violating this guidance is <a href="http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2012-1525">CVE-2012-1525</a>, which was due to <a href="http://www.agarri.fr/blog/index.html">Adobe’s inclusion of a defective Sablotron library</a>.</p>

<p>Another example is including OpenSSL. You know (1) <a href="http://www.schneier.com/paper-ssl-revised.pdf">SSLv2 is insecure</a>, (2) <a href="https://blog.qualys.com/ssllabs/2014/10/15/ssl-3-is-dead-killed-by-the-poodle-attack">SSLv3 is insecure</a>, and (3) <a href="http://arstechnica.com/security/2012/09/crime-hijacks-https-sessions/">compression is insecure</a> (among others). In addition, suppose you don’t use hardware and engines, and only allow static linking. Given the knowledge and specifications, you would configure the OpenSSL library as follows:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>Configure darwin64-x86_64-cc <span class="nt">-no-hw</span> <span class="nt">-no-engine</span> <span class="nt">-no-comp</span> <span class="nt">-no-shared</span> 
    <span class="nt">-no-dso</span> <span class="nt">-no-ssl2</span> <span class="nt">-no-ssl3</span> <span class="nt">--openssldir</span><span class="o">=</span>…
</code></pre></div></div>

<p><em>Note Well</em>: you might want engines, especially on Ivy Bridge microarchitectures (3rd generation Intel Core i5 and i7 processors). To have OpenSSL use the processor’s random number generator (via the of <code class="language-plaintext highlighter-rouge">rdrand</code> instruction), you will need to call OpenSSL’s <code class="language-plaintext highlighter-rouge">ENGINE_load_rdrand()</code> function and then <code class="language-plaintext highlighter-rouge">ENGINE_set_default</code> with <code class="language-plaintext highlighter-rouge">ENGINE_METHOD_RAND</code>. See <a href="https://wiki.openssl.org/index.php/Random_Numbers">OpenSSL’s Random Numbers</a> for details.</p>

<p>If you configure without the switches, then you will likely have vulnerable code/libraries and risk failing an audit. If the program is a remote server, then the following command will reveal if compression is active on the channel:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"GET / HTTP1.0"</span> | openssl s_client <span class="nt">-connect</span> &lt;nowiki&gt;example.com:443&lt;/nowiki&gt;
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">nm</code> or <code class="language-plaintext highlighter-rouge">openssl</code> <code class="language-plaintext highlighter-rouge">s_client</code> will show that compression is enabled in the client. In fact, any symbol within the <code class="language-plaintext highlighter-rouge">OPENSSL_NO_COMP</code> preprocessor macro will bear witness since <code class="language-plaintext highlighter-rouge">-no-comp</code> is translated into a <code class="language-plaintext highlighter-rouge">CFLAGS</code> define.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>nm /usr/local/ssl/iphoneos/lib/libcrypto.a 2&gt;/dev/null | egrep <span class="nt">-i</span> <span class="s2">"(COMP_CTX_new|COMP_CTX_free)"</span>
0000000000000110 T COMP_CTX_free
0000000000000000 T COMP_CTX_new
</code></pre></div></div>

<p>Even more egregious is the answer given to auditors who specifically ask about configurations and protocols: “we don’t use weak/wounded/broken ciphers” or “we follow best practices.” The use of compression tells the auditor that you are using wounded protocol in an insecure configuration and you don’t follow best practices. That will likely set off alarm bells, and ensure the auditor dives deeper on more items.</p>

<h1 id="preprocessor">Preprocessor</h1>

<p>The preprocessor is crucial to setting up a project for success. The C committee provided one macro - <code class="language-plaintext highlighter-rouge">NDEBUG</code> - and the macro can be used to derive a number of configurations and drive engineering processes. Unfortunately, the committee also left many related items to chance, which has resulted in programmers abusing builtin facilities. This section will help you set up you projects to integrate well with other projects and ensure reliability and security.</p>

<p>There are three topics to discuss when hardening the preprocessor. The first is well defined configurations which produce well defined behaviors, the second is useful behavior from assert, and the third is proper use of macros when integrating vendor code and third party libraries.</p>

<h2 id="configurations">Configurations</h2>

<p>To remove ambiguity, you should recognize two configurations: Release and Debug. Release is for production code on live servers, and its behavior is requested via the C/C++ <code class="language-plaintext highlighter-rouge">NDEBUG</code> macro. Its also the only macro observed by the C and C++ Committees and Posix. Diametrically opposed to release is Debug. While there is a compelling argument for <code class="language-plaintext highlighter-rouge">!defined(NDEBUG)</code>, you should have an explicit macro for the configuration and that macro should be <code class="language-plaintext highlighter-rouge">DEBUG</code>. This is because vendors and outside libraries use <code class="language-plaintext highlighter-rouge">DEBUG</code> (or similar) macro for their configuration. For example, Carnegie Mellon’s Mach kernel uses <code class="language-plaintext highlighter-rouge">DEBUG</code>, Microsoft’s CRT uses <a href="http://msdn.microsoft.com/en-us/library/ww5t02fa%28v=vs.71%29.aspx"><code class="language-plaintext highlighter-rouge">_DEBUG</code></a>, and Wind River Workbench uses <code class="language-plaintext highlighter-rouge">DEBUG_MODE</code>.</p>

<p>In addition to <code class="language-plaintext highlighter-rouge">NDEBUG</code> (Release) and <code class="language-plaintext highlighter-rouge">DEBUG</code> (Debug), you have two additional cross products: both are defined or neither are defined. Defining both should be an error, and defining neither should default to a release configuration. Below is from <a href="http://code.google.com/p/owasp-esapi-cplusplus/source/browse/trunk/esapi/EsapiCommon.h">ESAPI C++ EsapiCommon.h</a>, which is the configuration file used by all source files:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Only one or the other, but not both</span>
<span class="cp">#if (defined(DEBUG) || defined(_DEBUG)) &amp;&amp; (defined(NDEBUG) 
</span>                                           <span class="o">||</span> <span class="n">defined</span><span class="p">(</span><span class="n">_NDEBUG</span><span class="p">))</span>
<span class="cp"># error Both DEBUG and NDEBUG are defined.
#endif
</span>
<span class="c1">// The only time we switch to debug is when asked. </span>
<span class="c1">// NDEBUG or {nothing} results</span>
<span class="c1">// in release build (fewer surprises at runtime).</span>
<span class="cp">#if defined(DEBUG) || defined(_DEBUG)
# define ESAPI_BUILD_DEBUG 1
#else
# define ESAPI_BUILD_RELEASE 1
#endif
</span></code></pre></div></div>

<p>When <code class="language-plaintext highlighter-rouge">DEBUG</code> is in effect, your code should receive full debug instrumentation, including the full force of assertions.</p>

<h2 id="assert">ASSERT</h2>

<p>Asserts will help you create self-debugging code by helping you find the point of first failure quickly and easily. Asserts should be used throughout your program, including parameter validation, return value checking and program state. The <code class="language-plaintext highlighter-rouge">assert</code> will silently guard your code through its lifetime. It will always be there, even when not debugging a specific component of a module. If you have thorough code coverage, you will spend less time debugging and more time developing because programs will debug themselves.</p>

<p>To use asserts effectively, you should assert everything. That includes parameters upon entering a function, return values from function calls, and any program state. Everywhere you place an <code class="language-plaintext highlighter-rouge">if</code> statement for validation or checking, you should have an assert. Everywhere you have an <code class="language-plaintext highlighter-rouge">assert</code> for validation or checking, you should have an <code class="language-plaintext highlighter-rouge">if</code> statement. They go hand-in-hand.</p>

<p>If you are still using <code class="language-plaintext highlighter-rouge">printf</code>’s, then you have an opportunity for improvement. In the time it takes for you to write a <code class="language-plaintext highlighter-rouge">printf</code> or <code class="language-plaintext highlighter-rouge">NSLog</code> statement, you could have written an <code class="language-plaintext highlighter-rouge">assert</code>. Unlike the <code class="language-plaintext highlighter-rouge">printf</code> or <code class="language-plaintext highlighter-rouge">NSLog</code> which are often removed when no longer needed, the <code class="language-plaintext highlighter-rouge">assert</code> stays active forever. Remember, this is all about finding the point of first failure quickly so you can spend your time doing other things.</p>

<p>There is one problem with using asserts - <a href="http://pubs.opengroup.org/onlinepubs/009604499/functions/assert.html">Posix states <code class="language-plaintext highlighter-rouge">assert</code> should call <code class="language-plaintext highlighter-rouge">abort()</code></a> if <code class="language-plaintext highlighter-rouge">NDEBUG</code> is <strong>not</strong> defined. When debugging, <code class="language-plaintext highlighter-rouge">NDEBUG</code> will never be defined since you want the “program diagnostics” (quote from the Posix description). The behavior makes <code class="language-plaintext highlighter-rouge">assert</code> and its accompanying <code class="language-plaintext highlighter-rouge">abort()</code> completely useless for development. The result of “program diagnostics” calling <code class="language-plaintext highlighter-rouge">abort()</code> due to standard C/C++ behavior is disuse - developers simply don’t use them. Its incredibly bad for the development community because self-debugging programs can help eradicate so many stability problems.</p>

<p>Since self-debugging programs are so powerful, you will have to have to supply your own assert and signal handler with improved behavior. Your assert will exchange auto-aborting behavior for auto-debugging behavior. The auto-debugging facility will ensure the debugger snaps when a problem is detected, and you will find the point of first failure quickly and easily.</p>

<p>ESAPI C++ supplies its own assert with the behavior described above. In the code below, <code class="language-plaintext highlighter-rouge">ASSERT</code> raises <code class="language-plaintext highlighter-rouge">SIGTRAP</code> when in effect or it evaluates to <code class="language-plaintext highlighter-rouge">void</code> in other cases.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// A debug assert which should be sprinkled liberally. </span>
<span class="c1">// This assert fires and then continues rather</span>
<span class="c1">// than calling abort(). Useful when examining negative </span>
<span class="c1">// test cases from the command line.</span>
<span class="cp">#if (defined(ESAPI_BUILD_DEBUG) &amp;&amp; defined(ESAPI_OS_STARNIX))
#  define ESAPI_ASSERT1(exp) {                                    \
    if(!(exp)) {                                                  \
        std::ostringstream oss;                                     \
        oss &lt;&lt; "Assertion failed: " &lt;&lt; (char*)(__FILE__) &lt;&lt; "("     \
            &lt;&lt; (int)__LINE__ &lt;&lt; "): " &lt;&lt; (char*)(__func__)          \
            &lt;&lt; std::endl;                                           \
        std::cerr &lt;&lt; oss.str();                                     \
        raise(SIGTRAP);                                             \
    }                                                             \
    }
#  define ESAPI_ASSERT2(exp, msg) {                               \
    if(!(exp)) {                                                  \
        std::ostringstream oss;                                     \
        oss &lt;&lt; "Assertion failed: " &lt;&lt; (char*)(__FILE__) &lt;&lt; "("     \
            &lt;&lt; (int)__LINE__ &lt;&lt; "): " &lt;&lt; (char*)(__func__)          \
            &lt;&lt; ": \"" &lt;&lt; (msg) &lt;&lt; "\"" &lt;&lt; std::endl;                \
        std::cerr &lt;&lt; oss.str();                                     \
        raise(SIGTRAP);                                             \
    }                                                             \
    }
#elif (defined(ESAPI_BUILD_DEBUG) &amp;&amp; defined(ESAPI_OS_WINDOWS))
#  define ESAPI_ASSERT1(exp)      assert(exp)
#  define ESAPI_ASSERT2(exp, msg) assert(exp)
#else
#  define ESAPI_ASSERT1(exp)      ((void)(exp))
#  define ESAPI_ASSERT2(exp, msg) ((void)(exp))
#endif
</span>
<span class="cp">#if !defined(ASSERT)
#  define ASSERT(exp)     ESAPI_ASSERT1(exp)
#endif
</span></code></pre></div></div>

<p>At program startup, a <code class="language-plaintext highlighter-rouge">SIGTRAP</code> handler will be installed if one is not provided by another component:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">struct</span> <span class="n">DebugTrapHandler</span>
    <span class="p">{</span>
      <span class="n">DebugTrapHandler</span><span class="p">()</span>
      <span class="p">{</span>
        <span class="k">struct</span> <span class="n">sigaction</span> <span class="n">new_handler</span><span class="p">,</span> <span class="n">old_handler</span><span class="p">;</span>

        <span class="k">do</span>
          <span class="p">{</span>
            <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

            <span class="n">ret</span> <span class="o">=</span> <span class="n">sigaction</span> <span class="p">(</span><span class="n">SIGTRAP</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">old_handler</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span> <span class="c1">// Failed</span>

            <span class="c1">// Don't step on another's handler</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">old_handler</span><span class="p">.</span><span class="n">sa_handler</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

            <span class="n">new_handler</span><span class="p">.</span><span class="n">sa_handler</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DebugTrapHandler</span><span class="o">::</span><span class="n">NullHandler</span><span class="p">;</span>
            <span class="n">new_handler</span><span class="p">.</span><span class="n">sa_flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

            <span class="n">ret</span> <span class="o">=</span> <span class="n">sigemptyset</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">new_handler</span><span class="p">.</span><span class="n">sa_mask</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span> <span class="c1">// Failed</span>

            <span class="n">ret</span> <span class="o">=</span> <span class="n">sigaction</span> <span class="p">(</span><span class="n">SIGTRAP</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">new_handler</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span> <span class="c1">// Failed</span>

          <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">static</span> <span class="kt">void</span> <span class="n">NullHandler</span><span class="p">(</span><span class="kt">int</span> <span class="cm">/*unused*/</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="p">};</span>

    <span class="c1">// We specify a relatively low priority, to make sure we run before other CTORs</span>
    <span class="c1">// http://gcc.gnu.org/onlinedocs/gcc/C_002b_002b-Attributes.html#C_002b_002b-Attributes</span>
    <span class="k">static</span> <span class="k">const</span> <span class="n">DebugTrapHandler</span> <span class="n">g_dummyHandler</span> <span class="nf">__attribute__</span> <span class="p">((</span><span class="n">init_priority</span> <span class="p">(</span><span class="mi">110</span><span class="p">)));</span>
</code></pre></div></div>

<p>On a Windows platform, you would call <code class="language-plaintext highlighter-rouge">_set_invalid_parameter_handler</code> (and possibly <code class="language-plaintext highlighter-rouge">set_unexpected</code> or <code class="language-plaintext highlighter-rouge">set_terminate</code>) to install a new handler.</p>

<p>Live hosts running production code should always define <code class="language-plaintext highlighter-rouge">NDEBUG</code> (i.e., release configuration), which means they do not assert or auto-abort. Auto-abortion is not acceptable behavior, and anyone who asks for the behavior is completely abusing the functionality of “program diagnostics”. If a program wants a core dump, then it should create the dump rather than crashing.</p>

<p>For more reading on asserting effectively, please see one of John Robbin’s books, such as <em><a href="https://www.amazon.com/dp/0735608865">Debugging Applications</a></em>. John is a legendary bug slayer in Windows circles, and he will show you how to do nearly everything, from debugging a simple program to bug slaying in multithreaded programs.</p>

<h2 id="additional-macros">Additional Macros</h2>

<p>Additional macros include any macros needed to integrate properly and securely. It includes integrating the program with the platform (for example MFC or Cocoa/CocoaTouch) and libraries (for example, Crypto++ or OpenSSL). It can be a challenge because you have to have proficiency with your platform and all included libraries and frameworks. The list below illustrates the level of detail you will need when integrating.</p>

<p>Though Boost is missing from the list, it appears to lack recommendations, additional debug diagnostics, and a hardening guide. See <em><a href="http://stackoverflow.com/questions/14927033/boost-hardening-guide-preprocessor-macros">BOOST Hardening Guide (Preprocessor Macros)</a></em> for details. In addition, Tim Day points to <em><a href="http://boost.2283326.n4.nabble.com/boost-build-should-we-not-define-SECURE-SCL-0-by-default-for-all-msvc-toolsets-td2654710.html">[boost.build] should we not define _SECURE_SCL=0 by default for all msvc toolsets</a></em> for a recent discussion related to hardening (or lack thereof).</p>

<p>In addition to what you should define, defining some macros and undefining others should trigger a security related defect. For example, <code class="language-plaintext highlighter-rouge">-U_FORTIFY_SOURCES</code> on Linux and <code class="language-plaintext highlighter-rouge">_CRT_SECURE_NO_WARNINGS=1</code>, <code class="language-plaintext highlighter-rouge">_SCL_SECURE_NO_WARNINGS</code>, <code class="language-plaintext highlighter-rouge">_ATL_SECURE_NO_WARNINGS</code> or <code class="language-plaintext highlighter-rouge">STRSAFE_NO_DEPRECATE</code> on Windows.</p>

<p><img src="../assets/C-Based_Toolchain_Hardening_AdditionalPlatformLibraryMacrosTable.png" alt="AdditionalPlatformLibraryMacrosTable" /></p>

<p>a) Be careful with <code class="language-plaintext highlighter-rouge">_GLIBCXX_DEBUG</code> when using pre-compiled libraries such as Boost from a distribution. There are ABI incompatibilities, and the result will likely be a crash. You will have to compile Boost with <code class="language-plaintext highlighter-rouge">_GLIBCXX_DEBUG</code> or omit <code class="language-plaintext highlighter-rouge">_GLIBCXX_DEBUG</code>.</p>

<p>b) See <a href="http://gcc.gnu.org/onlinedocs/libstdc++/manual/concept_checking.html">Chapter 5, Diagnostics</a> of the libstdc++ manual for details.</p>

<p>c) SQLite secure deletion zeroizes memory on destruction. Define as required, and always define in US Federal since zeroization is required for FIPS 140-2, Level 1.</p>

<p>d) <em>N</em> is 0644 by default, which means everyone has some access.</p>

<p>e) Force temporary tables into memory (no unencrypted data to disk).</p>

<h1 id="compiler-and-linker">Compiler and Linker</h1>

<p>Compiler writers provide a rich set of warnings from the analysis of code during compilation. Both GCC and Visual Studio have static analysis capabilities to help find mistakes early in the development process. The built in static analysis capabilities of GCC and Visual Studio are usually sufficient to ensure proper API usage and catch a number of mistakes such as using an uninitialized variable or comparing a negative signed int and a positive unsigned int.</p>

<p>As a concrete example, (and for those not familiar with C/C++ promotion rules), a warning will be issued if a signed integer is promoted to an unsigned integer and then compared because a side effect is <code class="language-plaintext highlighter-rouge">-1</code> <code class="language-plaintext highlighter-rouge">&gt;</code> <code class="language-plaintext highlighter-rouge">1</code> after promotion! GCC and Visual Studio will not currently catch, for example, SQL injections and other tainted data usage. For that, you will need a tool designed to perform data flow analysis or taint analysis.</p>

<p>Some in the development community resist static analysis or refute its results. For example, when static analysis warned the Linux kernel’s <code class="language-plaintext highlighter-rouge">sys_prctl</code> was comparing an unsigned value against less than zero, Jesper Juhl offered a patch to clean up the code. Linus Torvalds howled “No, you don’t do this… GCC is crap” (referring to compiling with warnings). For the full discussion, see <em><a href="http://linux.derkeiler.com/Mailing-Lists/Kernel/2006-11/msg08325.html">[PATCH] Don’t compare unsigned variable for &lt;0 in sys_prctl()</a></em> from the Linux Kernel mailing list.</p>

<p>The following sections will detail steps for three platforms. First is a typical GNU Linux based distribution offering GCC and Binutils, second is Clang and Xcode, and third is modern Windows platforms.</p>

<h2 id="distribution-hardening">Distribution Hardening</h2>

<p>Before discussing GCC and Binutils, it would be a good time to point out some of the defenses discussed below are all ready present in a distribution. Unfortunately, its design by committee, so what is present is usually only a mild variation of what is available (this way, everyone is mildly offended). For those who are purely worried about performance, you might be surprised to learn you have already taken the small performance hint without even knowing.</p>

<p>Linux and BSD distributions often apply some hardening without intervention via <em><a href="http://gcc.gnu.org/onlinedocs/gcc/Spec-Files.html">GCC Spec Files</a></em>. If you are using Debian, Ubuntu, Linux Mint and family, see <em><a href="http://wiki.debian.org/Hardening">Debian Hardening</a></em>. For Red Hat and Fedora systems, see <em><a href="http://lists.fedoraproject.org/pipermail/devel-announce/2011-August/000821.html">New hardened build support (coming) in F16</a></em>. Gentoo users should visit <em><a href="http://www.gentoo.org/proj/en/hardened/">Hardened Gentoo</a></em>.</p>

<p>You can see the settings being used by a distribution via <code class="language-plaintext highlighter-rouge">gcc</code> <code class="language-plaintext highlighter-rouge">-dumpspecs</code>. From Linux Mint 12 below, <code class="language-plaintext highlighter-rouge">-fstack-protector</code> (but not -fstack-protector-all) is used by default.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gcc <span class="nt">-dumpspecs</span>
…
<span class="k">*</span>link_ssp: %<span class="o">{</span>fstack-protector:<span class="o">}</span>

<span class="k">*</span>ssp_default: %<span class="o">{!</span>fno-stack-protector:%<span class="o">{!</span>fstack-protector-all: 
              %<span class="o">{!</span>ffreestanding:%<span class="o">{!</span>nostdlib:-fstack-protector<span class="o">}}}}</span>
…
</code></pre></div></div>

<p>The “SSP” above stands for Stack Smashing Protector. SSP is a reimplementation of Hiroaki Etoh’s work on IBM Pro Police Stack Detector. See Hiroaki Etoh’s patch <em><a href="http://gcc.gnu.org/ml/gcc-patches/2001-06/msg01753.html">gcc stack-smashing protector</a></em> and IBM’s <em><a href="https://pdfs.semanticscholar.org/9d92/fa9eaa6ca12888d303deffe8bc392b85c09f.pdf">GCC extension for protecting applications from stack-smashing attacks</a></em> for details.</p>

<h2 id="gccbinutils">GCC/Binutils</h2>

<p>GCC (the compiler collection) and Binutils (the assemblers, linkers, and other tools) are separate projects that work together to produce a final executable. Both the compiler and linker offer options to help you write safer and more secure code. The linker will produce code which takes advantage of platform security features offered by the kernel and PaX, such as no-exec stacks and heaps (NX) and Position Independent Executable (PIE).</p>

<p>The table below offers a set of compiler options to build your program. Static analysis warnings help catch mistakes early, while the linker options harden the executable at runtime. In the table below, “GCC” should be loosely taken as “non-ancient distributions.” While the GCC team considers 4.2 ancient, you will still encounter it on Apple and BSD platforms due to changes in GPL licensing around 2007. Refer to <em><a href="http://gcc.gnu.org/onlinedocs/gcc/Option-Summary.html">GCC Option Summary</a></em>, <em><a href="http://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html">Options to Request or Suppress Warnings</a></em> and <em><a href="http://sourceware.org/binutils/docs-2.21/ld/Options.html">Binutils (LD) Command Line Options</a></em> for usage details.</p>

<p>Noteworthy of special mention are <code class="language-plaintext highlighter-rouge">-fno-strict-overflow</code> and <code class="language-plaintext highlighter-rouge">-fwrapv</code>ₐ. The flags ensure the compiler does not remove statements that result in overflow or wrap. If your program only runs correctly using the flags, it is likely violating C/C++ rules on overflow and illegal. If the program is illegal due to overflow or wrap checking, you should consider using <a href="http://code.google.com/p/safe-iop/">safe-iop</a> for C or David LeBlanc’s <a href="http://safeint.codeplex.com">SafeInt</a> in C++.</p>

<p>For a project compiled and linked with hardened settings, some of those settings can be verified with the <a href="http://www.trapkit.de/tools/checksec.html">Checksec</a> tool written by Tobias Klein. The <code class="language-plaintext highlighter-rouge">checksec.sh</code> script is designed to test standard Linux OS and PaX security features being used by an application. See the <a href="http://www.trapkit.de/tools/checksec.html">Trapkit</a> web page for details.</p>

<p>GCC C Warning Options table:</p>

<p><img src="../assets/C-Based_Toolchain_Hardening_GCCCWarningOptionsTable.png" alt="GCCCWarningOptionsTable" /></p>

<ul>
  <li><a href="https://github.com/google/sanitizers">AddressSanitizer</a></li>
  <li><a href="https://code.google.com/archive/p/data-race-test/wikis/ThreadSanitizer.wiki">ThreadSanitizer</a></li>
</ul>

<p>a) Unlike Clang and -Weverything, GCC does not provide a switch to truly enable all warnings.
b) -fstack-protector guards functions with high risk objects such as C strings, while -fstack-protector-all guards all objects.</p>

<p>Additional C++ warnings which can be used include the following in Table 3. See <em><a href="http://gcc.gnu.org/onlinedocs/gcc/C_002b_002b-Dialect-Options.html">GCC’s Options Controlling C++ Dialect</a></em> for additional options and details.</p>

<p>GCC C++ Warning Options table:</p>

<p><img src="../assets/C-Based_Toolchain_Hardening_GCCCPPWarningOptionsTable.png" alt="GCCCPPWarningOptionsTable" /></p>

<p><a href="http://www.aristeia.com/books.html">Effective C++, Second Edition book</a>.</p>

<p>And additional Objective C warnings which are often useful include the following. See <em><a href="https://gcc.gnu.org/onlinedocs/gcc-4.6.0/gcc/Objective_002dC-and-Objective_002dC_002b_002b-Dialect-Options.html">Options Controlling Objective-C and Objective-C++ Dialects</a></em> for additional options and details.</p>

<p>GCC Objective C Warning Options table:</p>

<p><img src="../assets/C-Based_Toolchain_Hardening_GCCObjectiveCWarningOptionsTable.png" alt="GCCObjectiveCWarningOptionsTable" /></p>

<p>The use of aggressive warnings will produce spurious noise. The noise is a tradeoff - you can learn of potential problems at the cost of wading through some chaff. The following will help reduces spurious noise from the warning system:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">-Wno-unused-parameter</code> (GCC)</li>
  <li><code class="language-plaintext highlighter-rouge">-Wno-type-limits</code> (GCC 4.3)</li>
  <li><code class="language-plaintext highlighter-rouge">-Wno-tautological-compare</code> (Clang)</li>
</ul>

<p>Finally, a simple version based Makefile example is shown below. This is different than feature based makefile produced by auto tools (which will test for a particular feature and then define a symbol or configure a template file). Not all platforms use all options and flags. To address the issue you can pursue one of two strategies. First, you can ship with a weakened posture by servicing the lowest common denominator; or you can ship with everything in force. In the latter case, those who don’t have a feature available will edit the makefile to accommodate their installation.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">CXX</span><span class="o">=</span>g++
EGREP <span class="o">=</span> egrep
…

GCC_COMPILER <span class="o">=</span> <span class="si">$(</span>shell <span class="si">$(</span>CXX<span class="si">)</span> <span class="nt">-v</span> 2&gt;&amp;1 | <span class="si">$(</span>EGREP<span class="si">)</span> <span class="nt">-i</span> <span class="nt">-c</span> <span class="s1">'^gcc version'</span><span class="si">)</span>
GCC41_OR_LATER <span class="o">=</span> <span class="si">$(</span>shell <span class="si">$(</span>CXX<span class="si">)</span> <span class="nt">-v</span> 2&gt;&amp;1 | <span class="si">$(</span>EGREP<span class="si">)</span> <span class="nt">-i</span> <span class="nt">-c</span> <span class="s1">'^gcc version (4\.[1-9]|[5-9])'</span><span class="si">)</span>
…

GNU_LD210_OR_LATER <span class="o">=</span> <span class="si">$(</span>shell <span class="si">$(</span>LD<span class="si">)</span> <span class="nt">-v</span> 2&gt;&amp;1 | <span class="si">$(</span>EGREP<span class="si">)</span> <span class="nt">-i</span> <span class="nt">-c</span> <span class="s1">'^gnu ld .* (2\.1[0-9]|2\.[2-9])'</span><span class="si">)</span>
GNU_LD214_OR_LATER <span class="o">=</span> <span class="si">$(</span>shell <span class="si">$(</span>LD<span class="si">)</span> <span class="nt">-v</span> 2&gt;&amp;1 | <span class="si">$(</span>EGREP<span class="si">)</span> <span class="nt">-i</span> <span class="nt">-c</span> <span class="s1">'^gnu ld .* (2\.1[4-9]|2\.[2-9])'</span><span class="si">)</span>
…

ifeq <span class="o">(</span><span class="si">$(</span>GCC_COMPILER<span class="si">)</span>,1<span class="o">)</span>
    MY_CC_FLAGS +<span class="o">=</span> <span class="nt">-Wall</span> <span class="nt">-Wextra</span> <span class="nt">-Wconversion</span>
    MY_CC_FLAGS +<span class="o">=</span> <span class="nt">-Wformat</span><span class="o">=</span>2 <span class="nt">-Wformat-security</span>
    MY_CC_FLAGS +<span class="o">=</span> <span class="nt">-Wno-unused-parameter</span>
endif

ifeq <span class="o">(</span><span class="si">$(</span>GCC41_OR_LATER<span class="si">)</span>,1<span class="o">)</span>
    MY_CC_FLAGS +<span class="o">=</span> <span class="nt">-fstack-protector-all</span>
endif

ifeq <span class="o">(</span><span class="si">$(</span>GCC42_OR_LATER<span class="si">)</span>,1<span class="o">)</span>
    MY_CC_FLAGS +<span class="o">=</span> <span class="nt">-Wstrict-overflow</span>
endif

ifeq <span class="o">(</span><span class="si">$(</span>GCC43_OR_LATER<span class="si">)</span>,1<span class="o">)</span>
    MY_CC_FLAGS +<span class="o">=</span> <span class="nt">-Wtrampolines</span>
endif

ifeq <span class="o">(</span><span class="si">$(</span>GNU_LD210_OR_LATER<span class="si">)</span>,1<span class="o">)</span>
    MY_LD_FLAGS +<span class="o">=</span> <span class="nt">-z</span>,nodlopen <span class="nt">-z</span>,nodump
endif

ifeq <span class="o">(</span><span class="si">$(</span>GNU_LD214_OR_LATER<span class="si">)</span>,1<span class="o">)</span>
    MY_LD_FLAGS +<span class="o">=</span> <span class="nt">-z</span>,noexecstack <span class="nt">-z</span>,noexecheap
endif

ifeq <span class="o">(</span><span class="si">$(</span>GNU_LD215_OR_LATER<span class="si">)</span>,1<span class="o">)</span>
    MY_LD_FLAGS +<span class="o">=</span> <span class="nt">-z</span>,relro <span class="nt">-z</span>,now
endif

ifeq <span class="o">(</span><span class="si">$(</span>GNU_LD216_OR_LATER<span class="si">)</span>,1<span class="o">)</span>
    MY_CC_FLAGS +<span class="o">=</span> <span class="nt">-fPIE</span>
    MY_LD_FLAGS +<span class="o">=</span> <span class="nt">-pie</span>
endif

<span class="c"># Use 'override' to honor the user's command line</span>
override CFLAGS :<span class="o">=</span> <span class="si">$(</span>MY_CC_FLAGS<span class="si">)</span> <span class="si">$(</span>CFLAGS<span class="si">)</span>
override CXXFLAGS :<span class="o">=</span> <span class="si">$(</span>MY_CC_FLAGS<span class="si">)</span> <span class="si">$(</span>CXXFLAGS<span class="si">)</span>
override LDFLAGS :<span class="o">=</span> <span class="si">$(</span>MY_LD_FLAGS<span class="si">)</span> <span class="si">$(</span>LDFLAGS<span class="si">)</span>
…
</code></pre></div></div>

<h2 id="clangxcode">Clang/Xcode</h2>

<p><a href="http://clang.llvm.org">Clang</a> and <a href="http://llvm.org">LLVM</a> have been aggressively developed since Apple lost its GPL compiler back in 2007 (due to Tivoization which resulted in GPLv3). Since that time, a number of developers and Goggle have joined the effort. While Clang will consume most (all?) GCC/Binutil flags and switches, the project supports a number of its own options, including a static analyzer. In addition, Clang is relatively easy to build with additional diagnostics, such as Dr. John Regher and Peng Li’s <a href="http://embed.cs.utah.edu/ioc/">Integer Overflow Checker (IOC)</a>.</p>

<p>IOC is incredibly useful, and has found bugs in a number of projects, from the Linux Kernel (<code class="language-plaintext highlighter-rouge">include/linux/bitops.h</code>, still unfixed), SQLite, PHP, Firefox (many still unfixed), LLVM, and Python. Future version of Clang (Clang 3.3 and above) will allow you to enable the checks out of the box with <code class="language-plaintext highlighter-rouge">-fsanitize=integer</code> and <code class="language-plaintext highlighter-rouge">-fsanitize=shift</code>.</p>

<p>Clang options can be found at <a href="http://clang.llvm.org/docs/UsersManual.html">Clang Compiler User’s Manual</a>. Clang does include an option to turn on all warnings - <code class="language-plaintext highlighter-rouge">-Weverything</code>. Use it with care but use it regularly since you will get back a lot of noise and issues you missed. For example, add <code class="language-plaintext highlighter-rouge">-Weverything</code> for production builds and make non-spurious issues a quality gate. Under Xcode, simply add <code class="language-plaintext highlighter-rouge">-Weverything</code> to <code class="language-plaintext highlighter-rouge">CFLAGS</code> and <code class="language-plaintext highlighter-rouge">CXXFLAGS</code>.</p>

<p>In addition to compiler warnings, both static analysis and additional security checks can be performed. Reading on Clang’s static analysis capabilities can be found at <a href="http://clang-analyzer.llvm.org">Clang Static Analyzer</a>. Figure 1 below shows some of the security checks utilized by Xcode.</p>

<p><img src="../assets/C-Based_Toolchain_Hardening_XCode1.png" alt="XCode1" /></p>

<h2 id="visual-studio">Visual Studio</h2>

<p>Visual Studio offers a convenient Integrated Development Environment (IDE) for managing solutions and their settings. the section called “Visual Studio Options” discusses option which should be used with Visual Studio, and the section called “Project Properties” demonstrates incorporating those options into a solution’s project.</p>

<p>The table below lists the compiler and linker switches which should be used under Visual Studio. Refer to Howard and LeBlanc’s Writing Secure Code (Microsoft Press) for a detailed discussion; or <em><a href="http://msdn.microsoft.com/en-us/magazine/cc337897.aspx">Protecting Your Code with Visual C++ Defenses</a></em> in Security Briefs by Michael Howard. In the table below, “Visual Studio” refers to nearly all versions of the development environment, including Visual Studio 5.0 and 6.0.</p>

<p>For a project compiled and linked with hardened settings, those settings can be verified with BinScope. BinScope is a verification tool from Microsoft that analyzes binaries to ensure that they have been built in compliance with Microsoft’s Security Development Lifecycle (SDLC) requirements and recommendations. See the <em><a href="https://www.microsoft.com/en-us/download/details.aspx?id=44995">BinScope Binary Analyzer</a></em> download page for details.</p>

<p><img src="../assets/C-Based_Toolchain_Hardening_VStudioWarningOptionsTable.png" alt="VStudioWarningOptionsTable" /></p>

<p>a) See Jon Sturgeon’s discussion of the switch at <em><a href="https://blogs.msdn.com/b/vcblog/archive/2010/12/14/off-by-default-compiler-warnings-in-visual-c.aspx">Off By Default Compiler Warnings in Visual C++</a></em>.</p>

<p>a) When using /GS, there are a number of circumstances which affect the inclusion of a security cookie. For example, the guard is not used if there is no buffer in the stack frame, optimizations are disabled, or the function is declared naked or contains inline assembly.</p>

<p>b) <code class="language-plaintext highlighter-rouge">#pragma</code> <code class="language-plaintext highlighter-rouge">strict_gs_check(on)</code> should be used sparingly, but is recommend in high risk situations, such as when a source file parses input from the internet.</p>

<h2 id="warn-suppression">Warn Suppression</h2>

<p>From the tables above, a lot of warnings have been enabled to help detect possible programming mistakes. The potential mistakes are detected via compiler which carries around a lot of contextual information during its code analysis phase. At times, you will receive spurious warnings because the compiler is not <em>that</em> smart. Its understandable and even a good thing (how would you like to be out of a job because a program writes its own programs?). At times you will have to learn how to work with the compiler’s warning system to suppress warnings. Notice what was not said: turn off the warnings.</p>

<p>Suppressing warnings placates the compiler for spurious noise so you can get to the issues that matter (you are separating the wheat from the chaff). This section will offer some hints and point out some potential minefields. First is an unused parameter (for example, <code class="language-plaintext highlighter-rouge">argc</code> or <code class="language-plaintext highlighter-rouge">argv</code>). Suppressing unused parameter warnings is especially helpful for C++ and interface programming, where parameters are often unused. For this warning, simply define an “UNUSED” macro and warp the parameter:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define UNUSED_PARAMETER(x) ((void)x)
</span><span class="err">…</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="n">UNUSED_PARAMETER</span><span class="p">(</span><span class="n">argc</span><span class="p">);</span>
    <span class="n">UNUSED_PARAMETER</span><span class="p">(</span><span class="n">argv</span><span class="p">);</span>
    <span class="err">…</span>
<span class="p">}</span>
</code></pre></div></div>

<p>A potential minefield lies near “comparing unsigned and signed” values, and <code class="language-plaintext highlighter-rouge">-Wconversion</code> will catch it for you. This is because C/C++ promotion rules state the signed value will be promoted to an unsigned value and then compared. That means <code class="language-plaintext highlighter-rouge">-1</code> <code class="language-plaintext highlighter-rouge">&gt;</code> <code class="language-plaintext highlighter-rouge">1</code> after promotion! To fix this, you cannot blindly cast - you must first range test the value:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">GetX</span><span class="p">();</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">GetY</span><span class="p">();</span>

<span class="n">ASSERT</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">throw</span> <span class="nf">runtime_error</span><span class="p">(</span><span class="s">"WTF??? X is negative."</span><span class="p">);</span>

<span class="k">if</span><span class="p">(</span><span class="n">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"x is greater than y"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="k">else</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"x is not greater than y"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</code></pre></div></div>

<p>Notice the code above will debug itself - you don’t need to set a breakpoint to see if there is a problem with <code class="language-plaintext highlighter-rouge">x</code>. Just run the program and wait for it to tell you there is a problem. If there is a problem, the program will snap the debugger (and more importantly, not call a useless <code class="language-plaintext highlighter-rouge">abort()</code> as specified by Posix). It beats the snot out of <code class="language-plaintext highlighter-rouge">printf</code> that are removed when no longer needed or pollute outputs.</p>

<p>Another conversion problem you will encounter conversion between types, and <code class="language-plaintext highlighter-rouge">-Wconversion</code> will also catch it for you. The following will always have an opportunity to fail, and should light up like a Christmas tree:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">addr</span><span class="p">;</span>
<span class="err">…</span>

<span class="n">addr</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]));</span>
</code></pre></div></div>

<p>The following would probably serve you much better. Notice <code class="language-plaintext highlighter-rouge">atoi</code> and fiends are not used because they can silently fail. In addition, the code is instrumented so you don’t need to waste a lot of time debugging potential problems:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">cstr</span> <span class="o">=</span> <span class="n">GetPortString</span><span class="p">();</span>

<span class="n">ASSERT</span><span class="p">(</span><span class="n">cstr</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">cstr</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">))</span>
    <span class="n">throw</span> <span class="nf">runtime_error</span><span class="p">(</span><span class="s">"WTF??? Port string is not valid."</span><span class="p">);</span>

<span class="n">istringstream</span> <span class="nf">iss</span><span class="p">(</span><span class="n">cstr</span><span class="p">);</span>
<span class="kt">long</span> <span class="kt">long</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">iss</span> <span class="o">&gt;&gt;</span> <span class="n">t</span><span class="p">;</span>

<span class="n">ASSERT</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">iss</span><span class="p">.</span><span class="n">fail</span><span class="p">()));</span>
<span class="k">if</span><span class="p">(</span><span class="n">iss</span><span class="p">.</span><span class="n">fail</span><span class="p">())</span>
    <span class="n">throw</span> <span class="nf">runtime_error</span><span class="p">(</span><span class="s">"WTF??? Failed to read port."</span><span class="p">);</span>

<span class="c1">// Should this be a port above the reserved range ([0-1024] on Unix)?</span>
<span class="n">ASSERT</span><span class="p">(</span><span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">throw</span> <span class="nf">runtime_error</span><span class="p">(</span><span class="s">"WTF??? Port is too small"</span><span class="p">);</span>

<span class="n">ASSERT</span><span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="n">static_cast</span><span class="o">&lt;</span><span class="kt">long</span> <span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">()));</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="n">static_cast</span><span class="o">&lt;</span><span class="kt">long</span> <span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">())))</span>
    <span class="n">throw</span> <span class="nf">runtime_error</span><span class="p">(</span><span class="s">"WTF??? Port is too large"</span><span class="p">);</span>

<span class="c1">// OK to use port</span>
<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">port</span> <span class="o">=</span> <span class="n">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
<span class="err">…</span>
</code></pre></div></div>

<p>Again, notice the code above will debug itself - you don’t need to set a breakpoint to see if there is a problem with <code class="language-plaintext highlighter-rouge">port</code>. This code will continue checking conditions, years after being instrumented (assuming to wrote code to read a config file early in the project). There’s no need to remove the <code class="language-plaintext highlighter-rouge">ASSERT</code>s as with <code class="language-plaintext highlighter-rouge">printf</code> since they are silent guardians.</p>

<p>Another useful suppression trick is too avoid ignoring return values. Not only is it useful to suppress the warning, its required for correct code. For example, <code class="language-plaintext highlighter-rouge">snprint</code> will alert you to truncations through its return value. You should not make them silent truncations by ignoring the warning or casting to <code class="language-plaintext highlighter-rouge">void</code>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">char</span> <span class="n">path</span><span class="p">[</span><span class="n">PATH_MAX</span><span class="p">];</span>
<span class="err">…</span>

<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="s">"%s/%s"</span><span class="p">,</span> <span class="n">GetDirectory</span><span class="p">(),</span> <span class="n">GetObjectName</span><span class="p">());</span>
<span class="n">ASSERT</span><span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="n">ASSERT</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">ret</span> <span class="o">&gt;=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">path</span><span class="p">)));</span>

<span class="k">if</span><span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="n">ret</span> <span class="o">&gt;=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
    <span class="n">throw</span> <span class="nf">runtime_error</span><span class="p">(</span><span class="s">"WTF??? Unable to build full object name"</span><span class="p">);</span>

<span class="c1">// OK to use path</span>
<span class="err">…</span>
</code></pre></div></div>

<p>The problem is pandemic, and not just boring user land programs. Projects which offer high integrity code, such as SELinux, suffer silent truncations. The following is from an approved SELinux patch even though a comment was made that it suffered silent truncations in its <code class="language-plaintext highlighter-rouge">security_compute_create_name</code> function from <code class="language-plaintext highlighter-rouge">compute_create.c</code>.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">12</span>  <span class="kt">int</span> <span class="n">security_compute_create_raw</span><span class="p">(</span><span class="n">security_context_t</span> <span class="n">scon</span><span class="p">,</span>
<span class="mi">13</span>                                  <span class="n">security_context_t</span> <span class="n">tcon</span><span class="p">,</span>
<span class="mi">14</span>                                  <span class="n">security_class_t</span>   <span class="n">tclass</span><span class="p">,</span>
<span class="mi">15</span>                                  <span class="n">security_context_t</span> <span class="o">*</span> <span class="n">newcon</span><span class="p">)</span>
<span class="mi">16</span>  <span class="p">{</span>
<span class="mi">17</span>    <span class="kt">char</span> <span class="n">path</span><span class="p">[</span><span class="n">PATH_MAX</span><span class="p">];</span>
<span class="mi">18</span>    <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
<span class="mi">19</span>    <span class="kt">size_t</span> <span class="n">size</span><span class="p">;</span>
<span class="mi">20</span>    <span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="n">ret</span><span class="p">;</span>
<span class="mi">21</span>
<span class="mi">22</span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">selinux_mnt</span><span class="p">)</span> <span class="p">{</span>
<span class="mi">23</span>      <span class="n">errno</span> <span class="o">=</span> <span class="n">ENOENT</span><span class="p">;</span>
<span class="mi">24</span>      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="mi">25</span>    <span class="p">}</span>
<span class="mi">26</span>
<span class="mi">27</span>    <span class="n">snprintf</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">path</span><span class="p">,</span> <span class="s">"%s/create"</span><span class="p">,</span> <span class="n">selinux_mnt</span><span class="p">);</span>
<span class="mi">28</span>    <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="p">);</span>
</code></pre></div></div>

<p>Unlike other examples, the above code will not debug itself, and you will have to set breakpoints and trace calls to determine the point of first failure. (And the code above gambles that the truncated file does not exist or is not under an adversary’s control by blindly performing the <code class="language-plaintext highlighter-rouge">open</code>).</p>

<h1 id="runtime">Runtime</h1>

<p>The previous sections concentrated on setting up your project for success. This section will examine additional hints for running with increased diagnostics and defenses. Not all platforms are created equal - GNU Linux is difficult to impossible to <a href="http://sourceware.org/ml/binutils/2012-03/msg00309.html">add hardening to a program after compiling and static linking</a>; while Windows allows post-build hardening through a download. Remember, the goal is to find the point of first failure quickly so you can improve the reliability and security of the code.</p>

<h2 id="xcode">Xcode</h2>

<p>Xcode offers additional <a href="http://developer.apple.com/library/mac/#recipes/xcode_help-scheme_editor/Articles/SchemeDiagnostics.html">Application Diagnostics</a> that can help find memory errors and object use problems. Schemes can be managed through <em>Products</em> menu item, <em>Scheme</em> submenu item, and then <em>Edit</em>. From the editor, navigate to the <em>Diagnostics</em> tab. In the figure below, four additional instruments are enabled for the debugging cycle: Scribble guards, Edge guards, Malloc guards, and Zombies.</p>

<p><img src="../assets/C-Based_Toolchain_Hardening_XCode2.png" alt="XCode2" /></p>

<p>There is one caveat with using some of the guards: Apple only provides them for the simulator, and not a device. In the past, the guards were available for both devices and simulators.</p>

<h3 id="windows">Windows</h3>

<p>Visual Studio offers a number of debugging aides for use during development. The aides are called <a href="http://msdn.microsoft.com/en-us/library/d21c150d.aspx">Managed Debugging Assistants (MDAs)</a>. You can find the MDAs on the <em>Debug</em> menu, then <em>Exceptions</em> submenu. MDAs allow you to tune your debugging experience by, for example, filter exceptions for which the debugger should snap. For more details, see Stephen Toub’s <em><a href="http://msdn.microsoft.com/en-us/magazine/cc163606.aspx">Let The CLR Find Bugs For You With Managed Debugging Assistants</a></em>.</p>

<p><img src="../assets/C-Based_Toolchain_Hardening_Windows1.png" alt="Windows1" /></p>

<p>Finally, for runtime hardening, Microsoft has a helpful tool called EMET. EMET is the <a href="http://support.microsoft.com/kb/2458544">Enhanced Mitigation Experience Toolkit</a>, and allows you to apply runtime hardening to an executable which was built without. Its very useful for utilities and other programs that were built without an SDLC.</p>

<p><img src="../assets/C-Based_Toolchain_Hardening_Windows2.png" alt="Windows2" /></p>

          </section>
          

          
          
          
          
          
          
          

          <nav role="navigation" aria-label="navigate page">
            <ol>
            
            
              <li class='page previous'><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Bean_Validation_Cheat_Sheet"><span style="font-size: 3em; color: lightgray; vertical-align:middle;">
                  <i class="fas fa-angle-left"></i>
                </span>Bean Validation Cheat Sheet</a></li>
            
            
            
              <li class='page next'><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/C-Based_Toolchain_Hardening_Cheat_Sheet">C-Based Toolchain Hardening Cheat Sheet<span style="font-size: 3em; color: lightgray; vertical-align:middle;">
                  <i class="fas fa-angle-right"></i>
                </span></a></li>
            
            </ol>
        </nav>
       </div>
       <hr>
       <div class="repo">
       </div>

          <div class="github-buttons">
    <a class="github-button" href="https://github.com/owasp/www-chapter-ankara/subscription" data-icon="octicon-eye" data-size="large" data-show-count="true" aria-label="Watch on GitHub">Watch</a>
    <a class="github-button" href="https://github.com/owasp/www-chapter-ankara" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star on GitHub">Star</a>
 </div>

          <div class="sidebar" role="complementary">
    

    
    
       



  
  <div class='owasp-sidebar-top'>
    <strong>The OWASP<sup>&reg;</sup> Foundation</strong> works to improve the security of software through its community-led open source software projects, 
     hundreds of chapters worldwide, tens of thousands of members, and by hosting local and global conferences.
</div>


  
  
  
<ul>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/AJAX_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">AJAX Security 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Abuse_Case_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Abuse Case 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Access_Control_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Access Control 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Attack_Surface_Analysis_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Attack Surface Analysis 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Authentication_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Authentication 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Authorization_Testing_Automation.html">
<span style="font-size:smaller;text-decoration:none;">Authorization Testing Automation
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Bean_Validation_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Bean Validation 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/C-Based_Toolchain_Hardening.html">
<span style="font-size:normal;text-decoration:none;font-weight: bold;">C-Based Toolchain Hardening
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/C-Based_Toolchain_Hardening_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">C-Based Toolchain Hardening 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Choosing_and_Using_Security_Questions_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Choosing and Using Security Questions 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Clickjacking Defense 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Content_Security_Policy_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Content Security Policy 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Credential_Stuffing_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Credential Stuffing Prevention 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Cross-Site Request Forgery Prevention 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Cross Site Scripting Prevention 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Cryptographic Storage 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/DOM_based_XSS_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">DOM based XSS Prevention 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Denial_of_Service_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Denial of Service 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Deserialization_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Deserialization 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Docker_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Docker Security 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/DotNet_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">DotNet Security 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Error_Handling_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Error Handling 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Forgot_Password_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Forgot Password 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/HTML5_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">HTML5 Security 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/HTTP_Strict_Transport_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">HTTP Strict Transport Security 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Injection_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Injection Prevention 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Injection_Prevention_Cheat_Sheet_in_Java.html">
<span style="font-size:smaller;text-decoration:none;">Injection Prevention  in Java
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Input_Validation_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Input Validation 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Insecure_Direct_Object_Reference_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Insecure Direct Object Reference Prevention 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/JAAS_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">JAAS 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/JSON_Web_Token_Cheat_Sheet_for_Java.html">
<span style="font-size:smaller;text-decoration:none;">JSON Web Token  for Java
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Key_Management_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Key Management 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/LDAP_Injection_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">LDAP Injection Prevention 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Logging_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Logging 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Mass_Assignment_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Mass Assignment 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Microservices_based_Security_Arch_Doc_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Microservices based Security Arch Doc 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Multifactor_Authentication_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Multifactor Authentication 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Nodejs_security_cheat_sheet.html">
<span style="font-size:smaller;text-decoration:none;">Nodejs security cheat sheet
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">OS Command Injection Defense 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/PHP_Configuration_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">PHP Configuration 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Password_Storage_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Password Storage 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Pinning_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Pinning 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Protect_FileUpload_Against_Malicious_File.html">
<span style="font-size:smaller;text-decoration:none;">Protect FileUpload Against Malicious File
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Query_Parameterization_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Query Parameterization 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/REST_Assessment_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">REST Assessment 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/REST_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">REST Security 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Ruby_on_Rails_Cheatsheet.html">
<span style="font-size:smaller;text-decoration:none;">Ruby on Rails 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/SAML_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">SAML Security 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">SQL Injection Prevention 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Securing_Cascading_Style_Sheets_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Securing Cascading Style Sheets 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Server Side Request Forgery Prevention 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Session_Management_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Session Management 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/TLS_Cipher_String_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">TLS Cipher String 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Third_Party_Javascript_Management_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Third Party Javascript Management 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Threat_Modeling_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Threat Modeling 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Transaction_Authorization_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Transaction Authorization 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Transport_Layer_Protection_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Transport Layer Protection 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Unvalidated Redirects and Forwards 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/User_Privacy_Protection_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">User Privacy Protection 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Virtual_Patching_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Virtual Patching 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Vulnerability_Disclosure_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Vulnerability Disclosure 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Vulnerable_Dependency_Management_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Vulnerable Dependency Management 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/Web_Service_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">Web Service Security 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">XML External Entity Prevention 
</span></a></li>

<li><a href="https://github.com/pages/owaspankara/www-chapter-ankara/cheatsheets/XML_Security_Cheat_Sheet.html">
<span style="font-size:smaller;text-decoration:none;">XML Security 
</span></a></li>

</ul>

  
  
  

  <div class='owasp-sidebar-bottom'>
<h3>Upcoming Global Events</h3>
   <ul>
      <!--
      <li><a href="https://appsecdays.org/?utm_source=owasp-web&utm_medium=right-col&utm_campaign=www-chapter-ankara" target="_blank" rel="noopener">Virtual AppSec Days, Summer</a></li>
      <li><a href="https://sf.globalappsec.org/?utm_source=owasp-web&utm_medium=right-col&utm_campaign=www-chapter-ankara" target="_blank" rel="noopener">Global AppSec SF October 19th-23rd</a></li>
     <li><a href="https://dublin.globalappsec.org/?utm_source=owasp-web&utm_medium=right-col&utm_campaign=www-chapter-ankara" target="_blank" rel="noopener">Global AppSec Dublin February 15-19th, 2021</a></li>
     -->
   </ul>
</div>


  <!--<div>
    <h3>OWASP News & Opinions</h3>
    <ul>
    	
    </ul>	
  </div>-->
</div>

      </div>
    </main>
    <footer>
  
  <section class="member">

  <script type="text/javascript">
    var members = [];
    $(function() {
      
      corp_members = YAML.load('https://owasp.org/assets/sitedata/corp_members.yml');
      $.each(corp_members, function (index) {
        members.push(this);
        });
        var randomIndexUsed = [];
        var counter = 0;
        var numberOfImages = 9;
        if(members.length > 0)
        {
          var htmlstring = "";
          while (counter < numberOfImages)
          {
              var randomIndex;
              var img;

              randomIndex = Math.floor(Math.random() * members.length);

              if (randomIndexUsed.indexOf(randomIndex) == "-1")
              {
                  counter++;
                  htmlstring += '<a href="'+ members[randomIndex]["url"] + '" class="member-logo" rel="sponsored noopener noreferrer" target="_blank" onclick="handleOutboundLinkClicks(event);"><img src="https://owasp.org' + members[randomIndex]["image"] + '" alt="image"/></a>';
                  
                  randomIndexUsed.push(randomIndex);
              }
          }

          $("#corp_member_div").html(htmlstring);
         
          var randi = Math.floor(Math.random() * members.length);
          htmlstring = '<h2>Spotlight: ' + members[randi]["name"] + '</h2>';
          htmlstring += '<a href="'+ members[randi]["url"] + '" rel="sponsored nopener noreferrer" target="_blank" onclick="handleOutboundLinkClicks(event);"><img src="https://owasp.org' + members[randi]["image"] + '" alt="image" /></a>';
          htmlstring += '<p>' + members[randi]["description"] + '</p>';
          $(".member-spotlight").html(htmlstring);
        }
    });
  </script>
  <div class="member-wrapper">
    <section class="member-spotlight">
    </section>
    <section class="member-list">
      <h2>Corporate Supporters</h2>
      <div id="corp_member_div">
      </div>
      <div class="member-cta">
        <a class="callout-link" href="/supporters">Become a corporate supporter</a>
      </div>
    </section>
  </div>
</section>

  
  <section class="footer-wrapper">
    <section class="social">
<a href="https://owasp-slack.herokuapp.com" aria-label="slack group" target="_blank" rel="noopener noreferrer"><i class="fa fa-lg fa-slack"></i></a>
<a href="https://www.facebook.com/OWASPFoundation" aria-label="facebook group" target="_blank" rel="noopener noreferrer"><i class="fa fa-lg fa-facebook-square"></i></a>
<a href="https://twitter.com/owasp" aria-label="twitter account" target="_blank" rel="noopener noreferrer"><i class="fa fa-lg fa-twitter"></i></a>
<a href="https://www.linkedin.com/company/owasp/" aria-label="linkedin account" target="_blank" rel="noopener noreferrer"><i class="fa fa-lg fa-linkedin"></i></a>
<a href="https://www.youtube.com/user/OWASPGLOBAL" aria-label="youtube account" target="_blank" rel="noopener noreferrer"><i class="fa fa-lg fa-youtube-square"></i></a>
</section>
    <nav class="bot-nav" role="navigation" aria-label="secondary navigation">
      <ul>
        <li><a href="/">HOME</a></li>
        <li><a href="/projects/">PROJECTS</a></li>
        <li><a href="/chapters/">CHAPTERS</a></li>
        <li><a href="/events/">EVENTS</a></li>
        <li><a href="/about/">ABOUT</a></li>
        <li><a href="/www-policy/operational/privacy">PRIVACY</a></li>
        <li><a href="/sitemap/">SITEMAP</a></li>
        <li><a href="/contact/">CONTACT</a></li>
      </ul>
    </nav>
    <p class="disclaimer">
        OWASP, Open Web Application Security Project, and Global AppSec are registered trademarks and AppSec Days, AppSec California, AppSec Cali, SnowFROC, LASCON, and the OWASP logo are trademarks of the OWASP Foundation, Inc. Unless otherwise specified, all content on the site is Creative Commons Attribution-ShareAlike v4.0 and provided without warranty of service or accuracy. For more information, please refer to our <a href="/www-policy/operational/general-disclaimer.html">General Disclaimer</a>. OWASP does not endorse or recommend commercial products or services, allowing our community to remain vendor neutral with the collective wisdom of the best minds in software security worldwide. Copyright 2020, OWASP Foundation, Inc.      
    </p>
  </section>
</footer>

  </body>
</html>


